
<!DOCTYPE html>
<html lang="zh-CN">


<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#202020"/>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
  
  
    <meta name="keywords" content="固定台,温州S2号线,站选区广播," />
  

  
    <meta name="description" content="小天的小窝，记录学习笔记和走过的点点滴滴！" />
  
  
  <link rel="icon" type="image/x-icon" href="/logo.png">
  <title>温州S2号线固定台站选区广播调试记录 [ 小天的小窝 ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
    
      <link rel="stylesheet" href="/css/xoxo.css">
    
  
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="小天的小窝" type="application/atom+xml">
</head>


<body>
  <div class="nav-container">
    <nav class="home-menu pure-menu pure-menu-horizontal">
  <a class="pure-menu-heading" href="/">
    <img class="avatar" src="/static/avatar/avatar.png">
    <span class="title">小天的小窝</span>
  </a>

  <ul class="pure-menu-list clearfix">
      
          
            <li class="pure-menu-item"><a href="/" class="pure-menu-link">首页</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/archives" class="pure-menu-link">归档</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/tags" class="pure-menu-link">标签</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/search" class="pure-menu-link">搜索</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/about" class="pure-menu-link">关于</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/atom.xml" class="pure-menu-link">订阅</a></li>
          
      
  </ul>
   
</nav>
  </div>

  <div class="container" id="content-outer">
    <div class="inner" id="content-inner">
      <div class="post-container">
  <article class="post" id="post">
    <header class="post-header text-center">
      <h1 class="title">
        温州S2号线固定台站选区广播调试记录
      </h1>
      <span>
        
        <time class="time" datetime="2022-10-10T10:27:00.000Z">
        2022-10-10
      </time>
        
      </span>
      <span class="slash">/</span>
      <span class="post-meta">
      <span class="post-tags">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9B%BA%E5%AE%9A%E5%8F%B0/" rel="tag">固定台</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF/" rel="tag">温州S2号线</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD/" rel="tag">站选区广播</a></li></ul>
      </span>
    </span>
      <span class="slash">/</span>
      <span class="read">
      <span id="busuanzi_value_page_pv"></span> 点击
    </span>
      <span class="slash">/</span>
      <span class="read">阅读耗时 136 分钟</span>
    </header>

    <div class="post-content">
      <h1 id="20221010-1750温州S2号线固定台站选区广播调试记录"><a href="#20221010-1750温州S2号线固定台站选区广播调试记录" class="headerlink" title="20221010_1750温州S2号线固定台站选区广播调试记录"></a>20221010_1750温州S2号线固定台站选区广播调试记录</h1><p>[TOC]</p>
<h2 id="一、描述"><a href="#一、描述" class="headerlink" title="一、描述"></a>一、描述</h2><h3 id="1-1-前言"><a href="#1-1-前言" class="headerlink" title="1.1.前言"></a>1.1.前言</h3><p>by daizelai on 2022&#x2F;10&#x2F;10 18:27<br>温州S2号线固定台APP站选区广播调试对接记录。</p>
<span id="more"></span>

<h3 id="1-2-对接文档"><a href="#1-2-对接文档" class="headerlink" title="1.2.对接文档"></a>1.2.对接文档</h3><p><a href="./file/PA-PIS%E9%9F%B3%E8%A7%86%E9%A2%91%E7%BB%9F%E4%B8%80%E4%BF%A1%E6%81%AF%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3%E5%8D%8F%E8%AE%AE202000228%EF%BC%8818%E5%8F%B7%E7%BA%BF%E4%B8%93%E7%94%A8%E6%97%A0%E7%BA%BF%E7%B3%BB%E7%BB%9F%EF%BC%89.docx">PA-PIS音视频统一信息服务系统接口协议202000228（18号线专用无线系统）</a></p>
<h3 id="1-3-调试记录"><a href="#1-3-调试记录" class="headerlink" title="1.3.调试记录"></a>1.3.调试记录</h3><table>
<thead>
<tr>
<th align="center">时间</th>
<th align="center">已方调试</th>
<th align="left">对方调试</th>
<th align="center">修改</th>
<th align="center">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="center">2022&#x2F;10&#x2F;10</td>
<td align="center">daizelai&#x2F;jiangfuqiang</td>
<td align="left">林汐&#x2F;武林过客</td>
<td align="center">+86号码问题</td>
<td align="center">已修改</td>
</tr>
<tr>
<td align="center">2022&#x2F;10&#x2F;10</td>
<td align="center">daizelai&#x2F;jiangfuqiang</td>
<td align="left">林汐&#x2F;武林过客</td>
<td align="center">广播密码问题，123修改为1234</td>
<td align="center">已修改</td>
</tr>
<tr>
<td align="center">2022&#x2F;10&#x2F;10</td>
<td align="center">daizelai&#x2F;jiangfuqiang</td>
<td align="left">林汐&#x2F;武林过客</td>
<td align="center">广播账号问题，192.168.99.1修改为user</td>
<td align="center">已修改</td>
</tr>
<tr>
<td align="center">2022&#x2F;10&#x2F;10</td>
<td align="center">daizelai&#x2F;jiangfuqiang</td>
<td align="left">林汐&#x2F;武林过客</td>
<td align="center">广播账号问题，对方写死的1修改为user</td>
<td align="center">已修改</td>
</tr>
<tr>
<td align="center">2022&#x2F;10&#x2F;10</td>
<td align="center">daizelai&#x2F;jiangfuqiang</td>
<td align="left">林汐&#x2F;武林过客</td>
<td align="center">对方广播服务器问题，重启后http接口已通</td>
<td align="center">已修改</td>
</tr>
<tr>
<td align="center">2022&#x2F;10&#x2F;11</td>
<td align="center">daizelai&#x2F;jiangfuqiang</td>
<td align="left">林汐&#x2F;武林过客</td>
<td align="center">已获取appid和token。但start_mic时解析失败，初步确定为api过来的格式不对</td>
<td align="center">已修改</td>
</tr>
<tr>
<td align="center">2022&#x2F;10&#x2F;11</td>
<td align="center">daizelai&#x2F;jiangfuqiang</td>
<td align="left">林汐&#x2F;武林过客</td>
<td align="center">app解析start_mic报文也有问题，出到V1.1.4版本明天测试</td>
<td align="center">已修改&#x3D;</td>
</tr>
<tr>
<td align="center">2022&#x2F;10&#x2F;12</td>
<td align="center">daizelai&#x2F;jiangfuqiang</td>
<td align="left">林汐&#x2F;武林过客</td>
<td align="center">广播服务器stop_mic问题，对方不是DELETE，而是用的POST，后对方修改成DELETE搞定</td>
<td align="center">已修改</td>
</tr>
<tr>
<td align="center">2022&#x2F;10&#x2F;12</td>
<td align="center">daizelai&#x2F;jiangfuqiang</td>
<td align="left">林汐&#x2F;武林过客</td>
<td align="center">广播服务器区域问题，已出新版本</td>
<td align="center">已修改</td>
</tr>
<tr>
<td align="center">2022&#x2F;10&#x2F;12</td>
<td align="center">daizelai&#x2F;jiangfuqiang</td>
<td align="left">林汐&#x2F;武林过客</td>
<td align="center">广播服务器问题调试初步完成，广播正常</td>
<td align="center">已修改</td>
</tr>
<tr>
<td align="center">2022&#x2F;10&#x2F;13</td>
<td align="center">daizelai&#x2F;jiangfuqiang</td>
<td align="left">林汐&#x2F;武林过客</td>
<td align="center">广播服务器区域问题，已出新版本1.2.4测试，广播正常</td>
<td align="center">已修改</td>
</tr>
</tbody></table>
<h2 id="二、实验室广播环境"><a href="#二、实验室广播环境" class="headerlink" title="二、实验室广播环境"></a>二、实验室广播环境</h2><h3 id="2-1-各服务环境"><a href="#2-1-各服务环境" class="headerlink" title="2.1.各服务环境"></a>2.1.各服务环境</h3><p>笔记本windows10运行广播wzs2_staton.jar<br>笔记本PA广播地址：192.168.3.13<br>笔记本PA广播端口：8086</p>
<p>DIS服务器地址：192.168.13.177&#x2F;192.0.1.121</p>
<p>主机地址：192.168.42.131&#x2F;192.168.3.12</p>
<p>终端地址：192.168.42.130</p>
<h2 id="三、站区广播配置"><a href="#三、站区广播配置" class="headerlink" title="三、站区广播配置"></a>三、站区广播配置</h2><h3 id="3-1-调度配置"><a href="#3-1-调度配置" class="headerlink" title="3.1.调度配置"></a>3.1.调度配置</h3><p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_dc_2022-10-10_141803.png" alt="配置区域广播组"></p>
<p>因为DC配置区域广播组失败，这里直接手动在dis_wz2数据库中配置区域广播组。</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_dis_config_db_2022-10-10_142133.png" alt="dis直接配置区域广播组"></p>
<p>当然dc中的群里管理处，需要看到这个上行或下行广播组，是要包含这个固定台账号的</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_dc_2022-10-10_141814.png" alt="群组用户查看"></p>
<h3 id="3-2-固定台配置"><a href="#3-2-固定台配置" class="headerlink" title="3.2.固定台配置"></a>3.2.固定台配置</h3><p>固定台开局配置之PA服务地址：192.168.42.131<br>固定台开局配置之PA服务端口：8086</p>
<p>固定台通过向主机发送http访<code>http://192.168.42.131:8086</code>这个地址，主机发现这个端口就会重定向到广播服务器<code>192.168.3.13</code>。</p>
<blockquote>
<p>查看APP是否获取得区域广播组的配置</p>
</blockquote>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_app_2022-10-10_141500.png" alt="查看APP是否获取得区域广播组的配置"></p>
<h3 id="3-3-固定台主机配置"><a href="#3-3-固定台主机配置" class="headerlink" title="3.3.固定台主机配置"></a>3.3.固定台主机配置</h3><p>固定台主机需要配置重定向功能，温州S2号线车载主机查看重定向。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">root@TA30-72:/sbin# pwd</span><br><span class="line">/sbin</span><br><span class="line">root@TA30-72:/sbin# cat e110forwardbroaudio </span><br><span class="line">#def config</span><br><span class="line">e110ip=&quot;192.0.4.66&quot;</span><br><span class="line">ta30ip_e=&quot;192.0.4.67&quot;</span><br><span class="line">broaudioip=&quot;172.17.7.23&quot;</span><br><span class="line">ta30ip_b=&quot;172.17.7.108&quot;</span><br><span class="line">broaudioPort=&quot;8086&quot;</span><br><span class="line">#############################################################</span><br><span class="line"># nvram key list</span><br><span class="line"># cfg_app_ip </span><br><span class="line"># ipv4_0_ip_address </span><br><span class="line"># cfg_app_broaudio </span><br><span class="line"># ipv4_ip_broaudio</span><br><span class="line"># ipv4_mask_broaudio</span><br><span class="line"># cfg_app_broaudioPort</span><br><span class="line">############################################################</span><br><span class="line">#get cfg from uci</span><br><span class="line">e110ip=`uci get ta30.config.cfg_app_ip`</span><br><span class="line">ta30ip_e=`uci get network.lan.ipaddr`</span><br><span class="line">broaudioip=`uci get ip_redirect.config.cfg_app_broaudio`</span><br><span class="line">ta30ip_b=`uci get ip_redirect.config.cfg_ipv4_ip_broaudio`</span><br><span class="line">broaudioPort=`uci get ip_redirect.config.cfg_app_broaudioPort`</span><br><span class="line">#config to system</span><br><span class="line">#echo &quot;iptables -t nat -A PREROUTING -s $e110ip -d $ta30ip_e -p tcp --dport $broaudioPort -j DNAT --to-destination $broaudioip&quot;</span><br><span class="line">iptables -t nat -F</span><br><span class="line">iptables -t nat -A PREROUTING -s $e110ip -d $ta30ip_e -p tcp --dport $broaudioPort -j DNAT --to-destination $broaudioip</span><br><span class="line">iptables -t nat -A POSTROUTING -s $e110ip -d $broaudioip -p tcp --dport $broaudioPort -j SNAT --to-source $ta30ip_b</span><br><span class="line">iptables -t nat -A PREROUTING -s $broaudioip -d $ta30ip_b -p tcp --sport $broaudioPort -j DNAT --to-destination $e110ip</span><br><span class="line">iptables -t nat -A POSTROUTING -s $broaudioip -d $e110ip -p tcp --sport $broaudioPort -j SNAT --to-source $ta30ip_e</span><br><span class="line">ifconfig br-lan:2 promisc</span><br><span class="line"></span><br><span class="line">#show config</span><br><span class="line">iptables -t nat -vnL</span><br><span class="line">root@TA30-72:/sbin# iptables -t nat -vnL</span><br><span class="line">Chain PREROUTING (policy ACCEPT 19642 packets, 3225K bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line">   18  1080 DNAT       tcp  --  *      *       192.168.42.130       192.168.42.131      tcp dpt:8086 to:192.168.3.13 </span><br><span class="line">    0     0 DNAT       tcp  --  *      *       192.168.3.13         192.168.3.12        tcp spt:8086 to:192.168.42.130 </span><br><span class="line"></span><br><span class="line">Chain INPUT (policy ACCEPT 1156 packets, 74610 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 1250 packets, 84936 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line"></span><br><span class="line">Chain POSTROUTING (policy ACCEPT 1334 packets, 92385 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line">   18  1080 SNAT       tcp  --  *      *       192.168.42.130       192.168.3.13        tcp dpt:8086 to:192.168.3.12 </span><br><span class="line">    0     0 SNAT       tcp  --  *      *       192.168.3.13         192.168.42.130      tcp spt:8086 to:192.168.42.131 </span><br><span class="line">root@TA30-72:/sbin#</span><br></pre></td></tr></table></figure>

<h2 id="四、站选区广播现场调试"><a href="#四、站选区广播现场调试" class="headerlink" title="四、站选区广播现场调试"></a>四、站选区广播现场调试</h2><h3 id="4-1-固定台站点名称问题"><a href="#4-1-固定台站点名称问题" class="headerlink" title="4.1.固定台站点名称问题"></a>4.1.固定台站点名称问题</h3><blockquote>
<p>问题1，固定台左上角只显示站点ID了，应该显示站点名称<br>问题2，PA状态栏连接状态不对。</p>
</blockquote>
<p>13：41，温州S2号线APP，温州S2号线固定台站选区广播模拟器放到153网盘上了。<br>路径：\10.1.1.154\00-网络u盘\地铁集群二开项目\版本\APP\温州S2\FX\站选区模拟器\wzs2_station_broadcast_v0.0.2_dev.jar</p>
<p>14:11, 温州S2号线APP，产口四部，1【PA还没配置   上面图标显示都是绿的】2【站名显示的是数字，10应该为永兴站】。<br>14：26, 温州S2号线APP，产口四部郑文杰提出来的温州S2号线APP与DBA接口GetStatusRsp，少了很多字段。</p>
<p>15：27，温州S2号线APP，修复了上面《1【PA还没配置   上面图标显示都是绿的】2【站名显示的是数字，10应该为永兴站】》两个BUG。</p>
<hr>
<p>15：39，温州S2号线APP，产品四部群里给蒋富旨发了一个温州固定台临时版本FX400-APK-3.0.1-V1.0.5–release-20221009.apk</p>
<p>蒋富强<code>v1.0.5</code>临时版本</p>
<p>1.固定台首页站点临时显示中文名称。</p>
<p>2.PA连接状态显示修改正常。</p>
<hr>
<p>15：45，温州S2号线APP，临时版本TX300-APK-2.0.1-V1.0.5–release-20221009.apk发产品四部群里。</p>
<h3 id="4-2-固定台浏览器访问广播模拟器接口"><a href="#4-2-固定台浏览器访问广播模拟器接口" class="headerlink" title="4.2.固定台浏览器访问广播模拟器接口"></a>4.2.固定台浏览器访问广播模拟器接口</h3><p>17:04, 温州S2号线固定台APP站区广播：</p>
<p>pa在浏览器中访问，pa默认是ping不通的。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.42.131:8086/api/pa/zones">固定台站选区广播模拟访问http://192.168.42.131:8086/api/pa/zones</a></p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_pa_bo_tong_2022-10-09_170016.png" alt="pa在浏览器中访问"></p>
<p><strong>注意：</strong> 这里是在固定台的浏览器访问的，访问地址192.168.42.131:8086地址是固定台的主机地址+广播接口服务器的端口</p>
<p>18：46，温州S2号线固定台APP:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_base.constant</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 默认需要配置:</span></span><br><span class="line"><span class="comment"> * Config.APP_TYPE是车载台还是固定台;</span></span><br><span class="line"><span class="comment"> * APP_MODE当前APP模式是DMO直通模式,还是集群模式;</span></span><br><span class="line"><span class="comment"> * AppConstant.kt-APP_CONFIG_ID: 这个是表ID的值,默认为1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">object Config &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * PA站选区广播</span></span><br><span class="line"><span class="comment">     * PA服务器地址</span></span><br><span class="line"><span class="comment">     * PA服务器端口，18=8086，wzs2=10049</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">PA_ADDRESS</span> <span class="operator">=</span> <span class="string">&quot;10.60.3.8&quot;</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">PA_PORT</span> <span class="operator">=</span> <span class="number">10049</span></span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改温州S2号线固定台APP站区广播申请APPID的名称和号码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_base.repository</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PA管理器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/07/29 11:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaRepository</span> &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取APPID</span></span><br><span class="line"><span class="comment">     * 每个第三方向平台申请，平台通过后即可使用，第三方申请的 appid 如在 15 天内 未使用(没有接口访问记录)，则需要再次申请。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/07/28 14:48</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Synchronized</span></span><br><span class="line">    suspend fun <span class="title function_">getAppID</span><span class="params">()</span>: Boolean &#123;</span><br><span class="line">-        <span class="type">val</span> <span class="variable">authName</span> <span class="operator">=</span> SPUtils.getValue(PaApiCode.AUTH_NAME.resultCode, <span class="string">&quot;lte&quot;</span>)</span><br><span class="line">+        <span class="type">val</span> <span class="variable">authName</span> <span class="operator">=</span> SPUtils.getValue(PaApiCode.AUTH_NAME.resultCode, <span class="string">&quot;192.168.99.1&quot;</span>)</span><br><span class="line">-        <span class="type">val</span> <span class="variable">userNum</span> <span class="operator">=</span> SPUtils.getValue(PaApiCode.USER_NUM.resultCode, <span class="number">123</span>)</span><br><span class="line">+        <span class="type">val</span> <span class="variable">userNum</span> <span class="operator">=</span> SPUtils.getValue(PaApiCode.USER_NUM.resultCode, <span class="number">1234</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (authName == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            LogUtils.getInstance().e(TAG, <span class="string">&quot;getAppID() - authName=$authName, userNum=$userNum&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">val</span> <span class="variable">appid</span> <span class="operator">=</span> SPUtils.getValue(PaApiCode.APP_ID.resultCode, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="type">val</span> <span class="variable">appidTime</span> <span class="operator">=</span> SPUtils.getValue(PaApiCode.APP_ID_TIMEOUT.resultCode, <span class="number">0L</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (appid == <span class="string">&quot;&quot;</span> || (SystemClock.elapsedRealtime() - appidTime) &gt; AppConstant.APP_ID_TIMEOUT) &#123;</span><br><span class="line">                <span class="comment">// 如果已过期，需要重新获取一下appid</span></span><br><span class="line">                <span class="type">val</span> <span class="variable">param</span> <span class="operator">=</span> HttpManager.INSTANCE.getJsonBody(PaAppIDData(authName, userNum))</span><br><span class="line">                <span class="keyword">var</span> data: PaAppIDRespData = HttpManager.INSTANCE.mApi.getAppid(param)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (data.code == BaseConstant.PaDataCode.SUCCESS.resultCode) &#123;</span><br><span class="line">                    <span class="comment">// 如果获取成功</span></span><br><span class="line">                    SPUtils.putValue(PaApiCode.APP_ID.resultCode, data.regappid)</span><br><span class="line">                    SPUtils.putValue(</span><br><span class="line">                        PaApiCode.APP_ID_TIMEOUT.resultCode,</span><br><span class="line">                        SystemClock.elapsedRealtime()</span><br><span class="line">                    )</span><br><span class="line">                    <span class="literal">true</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 获取APPID失败</span></span><br><span class="line">                    LogUtils.getInstance().e(</span><br><span class="line">                        TAG,</span><br><span class="line">                        <span class="string">&quot;getAppID() - Failed to get appid, code=$&#123;data.code&#125;, message=$&#123;data.message&#125;&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                    <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                LogUtils.getInstance().d(TAG, <span class="string">&quot;getAppID() - appid not expired, appid=$appid&quot;</span>)</span><br><span class="line">                <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">            LogUtils.getInstance().e(TAG, <span class="string">&quot;getAppID() - Exception - e=$&#123;e.message&#125;&quot;</span>)</span><br><span class="line">            <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、站选区广播现场对接调试"><a href="#五、站选区广播现场对接调试" class="headerlink" title="五、站选区广播现场对接调试"></a>五、站选区广播现场对接调试</h2><h3 id="5-1-实验室站区广播调试之-86问题"><a href="#5-1-实验室站区广播调试之-86问题" class="headerlink" title="5.1.实验室站区广播调试之+86问题"></a>5.1.实验室站区广播调试之+86问题</h3><p>15：30，站区广播通话问题，因为通话号码带86，而从DIS获取的广播组列表是没有+86的。</p>
<p>下面是温州现场app的发起站区广播时的logcat日志。</p>
<p>因为呼叫通话界面中的号码是866027331，获取的DIS广播组号码是6027331，判断相等就不行了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">10-10 15:46:54.910  4494  4494 D MainActivity: onReceive: new request mBroadCastReceiver, intent?.action=com.gbcom.action.ACTION_FX_STATION_BRD_ZONE_START_TASK</span><br><span class="line">10-10 15:46:54.910  4494  4494 D MainActivity: onReceive: 站选区广播开始 start</span><br><span class="line">10-10 15:46:54.910  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbb---start</span><br><span class="line">10-10 15:46:54.910  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbbb---start----number=866027331</span><br><span class="line">10-10 15:46:54.910  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---number=866027331</span><br><span class="line">10-10 15:46:54.910  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list1=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]</span><br><span class="line">10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]</span><br><span class="line">10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]</span><br><span class="line">10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]</span><br><span class="line">10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]</span><br><span class="line">10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]</span><br><span class="line">10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list4=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]</span><br><span class="line">10-10 15:46:54.912  4494  4494 D APP_LogUtils.kt: [(LogUtils.kt:45).d()] stationBrdZone - mZoneIDs.isEmpty()=[]</span><br></pre></td></tr></table></figure>

<p>继上面的日志最后一行，APP在判断的时候，从DIS拿到的沙城站上行站台广播组是6027331，而当前手台呼叫上行站台广播组的号码是866027331。这两个不相等，所以没有拿到mZoneIDs数据，然后根本就没有进入广播接口。</p>
<p>这里修改APP代码，判断的时候，加入86或+86前缀。</p>
<p>路径：com.gbcom.library_base.constant.Config.kt</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_base.constant</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 默认需要配置:</span></span><br><span class="line"><span class="comment"> * Config.APP_TYPE是车载台还是固定台;</span></span><br><span class="line"><span class="comment"> * APP_MODE当前APP模式是DMO直通模式,还是集群模式;</span></span><br><span class="line"><span class="comment"> * AppConstant.kt-APP_CONFIG_ID: 这个是表ID的值,默认为1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">object Config &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通话组号码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">val</span> <span class="variable">CALL_NUMBER_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;86&quot;</span></span><br><span class="line">    <span class="type">val</span> <span class="variable">CALL_NUMBER_PREFIX_SYMBOL</span> <span class="operator">=</span> <span class="string">&quot;+$&#123;CALL_NUMBER_PREFIX&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用<br>路径：com.gbcom.library_main.mvvm.view.MainActivity.kt</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_main.mvvm.view</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * APP首页</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> daizelai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/02/01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Route(path = ARouterConstant.PATH_MAIN)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : BaseActivity(R.layout.activity_main),</span><br><span class="line">    CoroutineScope by <span class="title function_">MainScope</span><span class="params">()</span> &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 站选区广播开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/08/03 17:13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> fun <span class="title function_">paStartMic</span><span class="params">(number: String)</span> &#123;</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---number=$number&quot;</span>)</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list1=$&#123;AppConstant.STATION_ZONE_BRO_LIST&#125;&quot;</span>)</span><br><span class="line">        <span class="comment">// 3.如果站选区广播列表不为空的话，则对站选区广播对应的区域发起广播</span></span><br><span class="line">        <span class="comment">// 4.获取到站选区广播区域</span></span><br><span class="line">        <span class="type">var</span> <span class="variable">mZoneIDs</span> <span class="operator">=</span> mutableListOf&lt;Int&gt;()</span><br><span class="line">        <span class="keyword">for</span> (item in AppConstant.STATION_ZONE_BRO_LIST) &#123;</span><br><span class="line">            Log.d(TAG, <span class="string">&quot;paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--$&#123;Config.CALL_NUMBER_PREFIX&#125;$&#123;item.groupID&#125;, $&#123;Config.CALL_NUMBER_PREFIX_SYMBOL&#125;$&#123;item.groupID&#125; ---AppConstant.station_zone_bro_list2=$&#123;AppConstant.STATION_ZONE_BRO_LIST&#125;&quot;</span>)</span><br><span class="line">-            <span class="keyword">if</span> (item.groupID == number) &#123;</span><br><span class="line">+            <span class="keyword">if</span> (<span class="string">&quot;$&#123;Config.CALL_NUMBER_PREFIX&#125;$&#123;item.groupID&#125;&quot;</span> == number || <span class="string">&quot;$&#123;Config.CALL_NUMBER_PREFIX_SYMBOL&#125;$&#123;item.groupID&#125;&quot;</span> == number) &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">&quot;paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list3=$&#123;AppConstant.STATION_ZONE_BRO_LIST&#125;&quot;</span>)</span><br><span class="line">                mZoneIDs.add(item.zoneID)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-站区广播调试之端口问题"><a href="#5-2-站区广播调试之端口问题" class="headerlink" title="5.2.站区广播调试之端口问题"></a>5.2.站区广播调试之端口问题</h3><p>一开始访问的端口就是有问题的，然后昨天2022&#x2F;10&#x2F;09把8086修改为10049，今天访问广播接口还是失败，这是<a href="./file/wzs2_app_station_bro_logcat_pa2.log">完整app的logcat日志，看510行</a>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">10-10 16:03:42.791  5148  5245 W System.err: java.net.ConnectException: Failed to connect to /192.168.42.131:10049</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:270)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.RealConnection.connect(RealConnection.kt:176)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findConnection(ExchangeFinder.kt:236)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findHealthyConnection(ExchangeFinder.kt:109)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.find(ExchangeFinder.kt:77)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.Transmitter.newExchange$okhttp(Transmitter.kt:162)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.kt:35)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.kt:82)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.kt:84)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)</span><br><span class="line">10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.kt:71)</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.logging.HttpLoggingInterceptor.intercept(HttpLoggingInterceptor.kt:150)</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.RealCall.getResponseWithInterceptorChain(RealCall.kt:184)</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:136)</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: 	at java.lang.Thread.run(Thread.java:761)</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: Caused by: java.net.ConnectException: Connection refused</span><br><span class="line">10-10 16:03:42.793  5148  5245 W System.err: 	at java.net.PlainSocketImpl.socketConnect(Native Method)</span><br><span class="line">10-10 16:03:42.794  5148  5245 W System.err: 	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:334)</span><br><span class="line">10-10 16:03:42.794  5148  5245 W System.err: 	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:196)</span><br><span class="line">10-10 16:03:42.794  5148  5245 W System.err: 	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:178)</span><br><span class="line">10-10 16:03:42.794  5148  5245 W System.err: 	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:356)</span><br><span class="line">10-10 16:03:42.794  5148  5245 W System.err: 	at java.net.Socket.connect(Socket.java:605)</span><br><span class="line">10-10 16:03:42.794  5148  5245 W System.err: 	at okhttp3.internal.platform.AndroidPlatform.connectSocket(AndroidPlatform.kt:58)</span><br><span class="line">10-10 16:03:42.794  5148  5245 W System.err: 	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:268)</span><br><span class="line">10-10 16:03:42.794  5148  5245 W System.err: 	... 24 more</span><br></pre></td></tr></table></figure>

<p>16:47，再次修改10049为10000<br>路径：com.gbcom.library_base.constant.Config.kt</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_base.constant</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 默认需要配置:</span></span><br><span class="line"><span class="comment"> * Config.APP_TYPE是车载台还是固定台;</span></span><br><span class="line"><span class="comment"> * APP_MODE当前APP模式是DMO直通模式,还是集群模式;</span></span><br><span class="line"><span class="comment"> * AppConstant.kt-APP_CONFIG_ID: 这个是表ID的值,默认为1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">object Config &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * PA站选区广播</span></span><br><span class="line"><span class="comment">     * PA服务器地址</span></span><br><span class="line"><span class="comment">     * PA服务器端口，18=8086，wzs2=10049, wzs2=10000</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">PA_ADDRESS</span> <span class="operator">=</span> <span class="string">&quot;10.60.3.8&quot;</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">PA_PORT</span> <span class="operator">=</span> <span class="number">10000</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">PA_AUTH_NAME</span> <span class="operator">=</span> <span class="string">&quot;user&quot;</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">PA_USER_NUM</span> <span class="operator">=</span> <span class="number">1234</span></span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后面发现，这里的用户名称也不是<code>lte</code>，而是<code>user</code>，下面是后面温州S2号线广播厂家研发<code>武林过客</code>发来的配置。</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_api_config_20221010180326.jpg" alt="温州S2号线站选区广播接口配置参数"></p>
<p>16：50，温州S2号线APP：站区广播，蒋富强发起站区广播通话，还是不行，蒋富强在主机上抓包，固定台终端发10000到主机正常，主机发10000到广播服务器，对端直接RST拒绝了，还要需要查。</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_app_station_bro_tcp_error1_2022-10-10_161245.png" alt="站区广播通话异常"></p>
<p>16：53，温州S2号线APP：站区广播，蒋富强发起站区广播通话，广播研发“武林过客”抓包查看。</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_app_station_bro_tcp_error2_2022-10-10_163206.png" alt="站区广播通话广播端口1000失败"></p>
<h3 id="5-3-站区广播调试之TCP接口初步正常"><a href="#5-3-站区广播调试之TCP接口初步正常" class="headerlink" title="5.3.站区广播调试之TCP接口初步正常"></a>5.3.站区广播调试之TCP接口初步正常</h3><p>16:56，实验室正常的站区广播抓包</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_app_station_bro_gbcom_success_20221010165538.png" alt="实验室站区广播通话正常"></p>
<p>17：19，温州现场站区广播的接口通了，对方<code>重启了现场设备，估计是修改了什么配置之类的</code>。</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_app_station_bro_success_2022-10-10_172017.png" alt="接口通了"></p>
<p><a href="./file/20221010_wzs2_station_bro_failure_pa4eth1.pcap">本次抓包通了抓包pcap下载</a></p>
<p>2022&#x2F;10&#x2F;10 17:48第二次通通话抓包。</p>
<p>用户名和编号不存在</p>
<p><a href="./file/20221010_wzs2_station_bro_failre_pa10.log">站区广播失败之用户名和编号不存在 日志文件下载</a></p>
<p>下面是用户名和编号不存在的日志片段</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_failure_reason1_20221010174753.jpg" alt="用户名和编号不存在"></p>
<p><a href="./file/20221010_wzs2_station_bro_failre_master_eth1.pcap">站区广播失败之用户名和编号不存在 抓包pcap文件下载</a></p>
<p>下面是用户名和编号不存在的抓包分析片段</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/20221010_wzs2_station_bro_failre_master_eth1_2022-10-10_175522.png" alt="站区广播失败之用户名和编号不存在抓包分析"></p>
<h3 id="5-4-站区广播对接之新站调试"><a href="#5-4-站区广播对接之新站调试" class="headerlink" title="5.4.站区广播对接之新站调试"></a>5.4.站区广播对接之新站调试</h3><p>今天蒋富强继续使用昨天我发的v1.0.9固定台版本测试车站站区广播，首次测试结果是http连接异常的，如下日志片断。</p>
<p><a href="./file/wzs2_station_bro_test_pa11_20221011_1350.log">本次日志下载 下载</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">10-11 13:50:08.274  2706  3650 W System.err: java.net.ConnectException: Failed to connect to /192.168.42.131:10000</span><br><span class="line">10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:270)</span><br><span class="line">10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.RealConnection.connect(RealConnection.kt:176)</span><br><span class="line">10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findConnection(ExchangeFinder.kt:236)</span><br><span class="line">10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findHealthyConnection(ExchangeFinder.kt:109)</span><br><span class="line">10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.find(ExchangeFinder.kt:77)</span><br><span class="line">10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.Transmitter.newExchange$okhttp(Transmitter.k</span><br></pre></td></tr></table></figure>

<p>紧接着蒋富强又测试了一次，http访问是正常的，但是还是提示<code>用户不存在,请检查用户名和用户编号</code>。</p>
<p><a href="./file/wzs2_staton_bro_pa12_20221011_1439.log">wzs2_staton_bro_pa12_20221011_1439.log 下载</a></p>
<p>下面是日志片段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">10-11 14:06:15.120  2706  2706 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list3=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=天河站上行站台广播组, groupID=6027332), StationBrdZone(zoneID=35002, zoneName=天河站下行站台广播组, groupID=6027352), StationBrdZone(zoneID=35003, zoneName=天河站动态重组组, groupID=6027513)]</span><br><span class="line">10-11 14:06:15.120  2706  2706 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--866027513, +866027513 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=天河站上行站台广播组, groupID=6027332), StationBrdZone(zoneID=35002, zoneName=天河站下行站台广播组, groupID=6027352), StationBrdZone(zoneID=35003, zoneName=天河站动态重组组, groupID=6027513)]</span><br><span class="line">10-11 14:06:15.121  2706  2706 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---mZoneIDs=[35002], ---AppConstant.station_zone_bro_list4=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=天河站上行站台广播组, groupID=6027332), StationBrdZone(zoneID=35002, zoneName=天河站下行站台广播组, groupID=6027352), StationBrdZone(zoneID=35003, zoneName=天河站动态重组组, groupID=6027513)]</span><br><span class="line">10-11 14:06:15.121  2706  2706 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---2222</span><br><span class="line">10-11 14:06:15.121  2706  2706 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa -------3333</span><br><span class="line">10-11 14:06:15.126  2706  4076 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa------44444</span><br><span class="line">10-11 14:06:15.174  2706  4076 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [PaRepository] getAppID() - Failed to get appid, code=500, message=用户不存在,请检查用户名和用户编号</span><br><span class="line">10-11 14:06:15.175  2706  4076 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---555555--false</span><br><span class="line">......</span><br><span class="line">10-11 14:06:15.186  2706  2827 D TAG     : 2,initFile: /custom/metro/log/2022-10-11/app3.log, logFile.length=144878, getCurrentFileName()=app3.log, writeFileName=/custom/metro/log/2022-10-11/app3.log</span><br><span class="line">10-11 14:06:15.187  2706  2827 D LogWriteUtil.class=LogFileHandlerThread.class: 8,initFile: logFile=/custom/metro/log/2022-10-11/app3.log, logFile.length=144878</span><br><span class="line">10-11 14:06:15.206  2706  2706 D IndexFragment: initView: applyFxData() - ats=[StationAts(createTime=1665468375, trainGroupNumber=212, serviceNumber=000, trainCrewNumber=000, trainPosition=1, trainRunningPosition=1, railName=T1212, stationID=012, terminalStationID=000, destinationID=000, identityID=+866022012)]</span><br><span class="line">10-11 14:06:15.233  2706  4007 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [PaRepository] getToken() - Failed to get token, code=500, message=appid或者时间戳错误</span><br><span class="line">10-11 14:06:15.234  2706  4007 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---666666666666666--</span><br></pre></td></tr></table></figure>

<p><a href="./file/wzs2_staton_bro_master_pa12eth1.pcap">wzs2_staton_bro_master_pa12eth1.pcap 下载</a></p>
<p>通过看抓包文件分析可以看到，http访问是没问题的。</p>
<blockquote>
<p>第三次调试</p>
</blockquote>
<p><a href="./wzs2_staton_bro_pa13_20221011.log">终端pa13.log 下载</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">10-11 14:29:54.214  4965  5037 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa------44444</span><br><span class="line">10-11 14:29:54.222  4965  5037 D PaRepository: getAppID: authName=user, userNum=1234, appid=, appidTime=0</span><br><span class="line">10-11 14:29:54.284  4965  5037 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [PaRepository] getAppID() - Failed to get appid, authName=user, userNum=1234, appid=, code=500, message=用户不存在,请检查用户名和用户编号</span><br><span class="line">10-11 14:29:54.285  4965  5037 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---555555--false</span><br></pre></td></tr></table></figure>

<p><a href="./file/wzs2_station_bro_master_pa13eth1.pcap">主机pa13eth1.pcap 下载</a></p>
<p>微信沟通记录</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_return_user_error_2022-10-11_144640.png" alt="微信沟通记录"></p>
<blockquote>
<p>第四次调试</p>
</blockquote>
<p><a href="./file/wzs2_station_bro_return_user_error_app_pa14_20221011.log">终端pa14.log 下载</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">10-11 14:42:05.553  4965  5057 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa------44444</span><br><span class="line">10-11 14:42:05.555  4965  5057 D PaRepository: getAppID: authName=user, userNum=1234, appid=, appidTime=0</span><br><span class="line">10-11 14:42:05.592  4965  5057 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [PaRepository] getAppID() - Failed to get appid, authName=user, userNum=1234, appid=, code=500, message=用户不存在,请检查用户名和用户编号</span><br><span class="line">10-11 14:42:05.592  4965  5057 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---555555--false</span><br></pre></td></tr></table></figure>

<p><a href="./file/wzs2_station_bro_return_user_error_master_pa14eth1_20221011.pcap">主机pa14eth1.pcap 下载</a></p>
<p>请求appid携带的参数</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_getappid_return_500_2022-10-11_150206.png" alt="请求appid携带的参数"></p>
<p>报文分析还是提示用户名和用户编号不一致</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_master_pa14_eth1_2022-10-11_145059.png" alt="报文分析还是提示用户名和用户编号不一致"></p>
<p>微信沟通记录</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_wechat2_2022-10-11_150420.png" alt="微信沟通记录"></p>
<p><a href="./file/wzs2_station_bro_edit_retry_pa16_20221011_1513.log">pa16.log 下载</a></p>
<p>继续测试</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_test_2022-10-11_152141.png" alt="微信沟通"></p>
<p><a href="./file/wzs2_station_bro_teset_pa17_20221011_1521.log">测试pa17.log 下载</a></p>
<p>下面是pa17.log日志片段，可以看到，是解析json数据失败了，报了<code>Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $</code>错误。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">10-11 15:21:39.609  4965  6381 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---666666666666666--</span><br><span class="line">10-11 15:21:39.657  4965  6381 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---aaaaa--</span><br><span class="line">10-11 15:21:39.658  4965  6381 W System.err: com.google.gson.JsonSyntaxException: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $</span><br><span class="line">10-11 15:21:39.658  4965  6381 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:226)</span><br><span class="line">10-11 15:21:39.658  4965  6381 W System.err: 	at retrofit2.converter.gson.GsonResponseBodyConverter.convert(GsonResponseBodyConverter.java:40)</span><br><span class="line">10-11 15:21:39.658  4965  6381 W System.err: 	at retrofit2.converter.gson.GsonResponseBodyConverter.convert(GsonResponseBodyConverter.java:27)</span><br><span class="line">10-11 15:21:39.658  4965  6381 W System.err: 	at retrofit2.OkHttpCall.parseResponse(OkHttpCall.java:243)</span><br><span class="line">10-11 15:21:39.659  4965  6381 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:153)</span><br><span class="line">10-11 15:21:39.659  4965  6381 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)</span><br><span class="line">10-11 15:21:39.660  4965  6381 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)</span><br><span class="line">10-11 15:21:39.660  4965  6381 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)</span><br><span class="line">10-11 15:21:39.660  4965  6381 W System.err: 	at java.lang.Thread.run(Thread.java:761)</span><br><span class="line">10-11 15:21:39.660  4965  6381 W System.err: Caused by: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $</span><br><span class="line">10-11 15:21:39.660  4965  6381 W System.err: 	at com.google.gson.stream.JsonReader.beginObject(JsonReader.java:385)</span><br><span class="line">10-11 15:21:39.660  4965  6381 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:215)</span><br><span class="line">10-11 15:21:39.660  4965  6381 W System.err: 	... 8 more</span><br><span class="line">10-11 15:21:39.661  4965  6381 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] paStartMic() Exception - zone_ids=[35001], e=java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $</span><br><span class="line">10-11 15:21:39.662  4965  6381 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---bbbbb--</span><br></pre></td></tr></table></figure>

<p>再去主机抓包看一下</p>
<p>接口start_mic成功返回，<a href="./file/wzs2_staton_bro_start_mic_pacp_master_pa19eth1_20221011.pcap">主机pa19eth1.pcap 下载</a>，但是解析失败，这是<a href="./file/wzs2_station_bro_app_log_pa19_20221011.log">终端pa19.log 下载</a>。</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_pa19_eth1_pacp_2022-10-11_094825.png" alt="接口start_mic成功返回，主机pa19eth1.pcap"></p>
<p>因为APP没有添加http的日志打印，所以又修改了个版本v1.1.1，再次发广播。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日志拦截器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> fun <span class="title function_">initLogInterceptor</span><span class="params">()</span>: HttpLoggingInterceptor &#123;</span><br><span class="line">        Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;initLogInterceptor: aaaaaaaaaaaaaaaaaaa&quot;</span>)</span><br><span class="line"><span class="comment">//        if (!BuildConfig.DEBUG) &#123;   //生产环境不打日志</span></span><br><span class="line"><span class="comment">//            Log.d(&quot;TAG&quot;, &quot;initLogInterceptor: bbbbbb&quot;)</span></span><br><span class="line"><span class="comment">//            return HttpLoggingInterceptor()</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;initLogInterceptor: ccccccc&quot;</span>)</span><br><span class="line">        <span class="type">val</span> <span class="variable">interceptor</span> <span class="operator">=</span> HttpLoggingInterceptor(object : HttpLoggingInterceptor.Logger &#123;</span><br><span class="line">            override fun <span class="title function_">log</span><span class="params">(message: String)</span> &#123;</span><br><span class="line">                Log.i(<span class="string">&quot;Retrofit_network&quot;</span>, message)</span><br><span class="line">+                Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;log: message=$message&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        interceptor.level = HttpLoggingInterceptor.Level.BODY</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> interceptor</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><a href="./file/wzs2_station_bro_receive_start_mic_json_error20221011.log">终端pa20.log</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">10-11 16:09:46.458  3867  4007 I Retrofit_network: --&gt; POST http://192.168.42.131:10000/api/pa/start_mic</span><br><span class="line">10-11 16:09:46.459  3867  4007 D TAG     : log: message=--&gt; POST http://192.168.42.131:10000/api/pa/start_mic</span><br><span class="line">10-11 16:09:46.459  3867  4007 I Retrofit_network: Content-Type: application/json; charset=utf-8</span><br><span class="line">10-11 16:09:46.460  3867  4007 D TAG     : log: message=Content-Type: application/json; charset=utf-8</span><br><span class="line">10-11 16:09:46.460  3867  4007 I Retrofit_network: Content-Length: 20</span><br><span class="line">10-11 16:09:46.460  3867  4007 D TAG     : log: message=Content-Length: 20</span><br><span class="line">10-11 16:09:46.461  3867  4007 I Retrofit_network: </span><br><span class="line">10-11 16:09:46.461  3867  4007 D TAG     : log: message=</span><br><span class="line">10-11 16:09:46.461  3867  4007 I Retrofit_network: &#123;&quot;zone_ids&quot;:[35001]&#125;</span><br><span class="line">10-11 16:09:46.461  3867  4007 D TAG     : log: message=&#123;&quot;zone_ids&quot;:[35001]&#125;</span><br><span class="line">10-11 16:09:46.462  3867  4007 I Retrofit_network: --&gt; END POST (20-byte body)</span><br><span class="line">10-11 16:09:46.462  3867  4007 D TAG     : log: message=--&gt; END POST (20-byte body)</span><br><span class="line">10-11 16:09:46.498  3867  4007 I Retrofit_network: &lt;-- 200 OK http://192.168.42.131:10000/api/pa/start_mic (35ms)</span><br><span class="line">10-11 16:09:46.498  3867  4007 D TAG     : log: message=&lt;-- 200 OK http://192.168.42.131:10000/api/pa/start_mic (35ms)</span><br><span class="line">10-11 16:09:46.498  3867  4007 I Retrofit_network: Content-Length: 100</span><br><span class="line">10-11 16:09:46.498  3867  4007 D TAG     : log: message=Content-Length: 100</span><br><span class="line">10-11 16:09:46.498  3867  4007 I Retrofit_network: Content-Type: text/plain</span><br><span class="line">10-11 16:09:46.498  3867  4007 D TAG     : log: message=Content-Type: text/plain</span><br><span class="line">10-11 16:09:46.498  3867  4007 I Retrofit_network: Keep-Alive: timeout=5, max=5</span><br><span class="line">10-11 16:09:46.498  3867  4007 D TAG     : log: message=Keep-Alive: timeout=5, max=5</span><br><span class="line">10-11 16:09:46.500  3867  4007 I Retrofit_network: </span><br><span class="line">10-11 16:09:46.501  3867  4007 D TAG     : log: message=</span><br><span class="line">10-11 16:09:46.501  3867  4007 I Retrofit_network: [</span><br><span class="line">10-11 16:09:46.501  3867  4007 I Retrofit_network:     &#123;</span><br><span class="line">10-11 16:09:46.501  3867  4007 I Retrofit_network:         &quot;id&quot;: 35001,</span><br><span class="line">10-11 16:09:46.501  3867  4007 I Retrofit_network:         &quot;reason&quot;: &quot;广播呼叫成功&quot;,</span><br><span class="line">10-11 16:09:46.501  3867  4007 I Retrofit_network:         &quot;result&quot;: true</span><br><span class="line">10-11 16:09:46.501  3867  4007 I Retrofit_network:     &#125;</span><br><span class="line">10-11 16:09:46.501  3867  4007 I Retrofit_network: ]</span><br><span class="line">10-11 16:09:46.501  3867  4007 D TAG     : log: message=[</span><br><span class="line">10-11 16:09:46.501  3867  4007 D TAG     :     &#123;</span><br><span class="line">10-11 16:09:46.501  3867  4007 D TAG     :         &quot;id&quot;: 35001,</span><br><span class="line">10-11 16:09:46.501  3867  4007 D TAG     :         &quot;reason&quot;: &quot;广播呼叫成功&quot;,</span><br><span class="line">10-11 16:09:46.501  3867  4007 D TAG     :         &quot;result&quot;: true</span><br><span class="line">10-11 16:09:46.501  3867  4007 D TAG     :     &#125;</span><br><span class="line">10-11 16:09:46.501  3867  4007 D TAG     : ]</span><br><span class="line">10-11 16:09:46.501  3867  4007 I Retrofit_network: &lt;-- END HTTP (100-byte body)</span><br><span class="line">10-11 16:09:46.501  3867  4007 D TAG     : log: message=&lt;-- END HTTP (100-byte body)</span><br><span class="line">10-11 16:09:46.508  3867  3961 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---aaaaa--</span><br></pre></td></tr></table></figure>

<p>再次修改了代码，其实本次修改的代码是没用的，这个<code>getJsonBody()</code>是去广播API接口服务器请求数据的时候带过去的，不是对方response的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_base.utils</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 枚举单例模式; 包括 初始化 Retrofit, OkHttpClient, 添加请求Token, 请求日志打印.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/07/28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">class</span> HttpManager &#123;</span><br><span class="line">    ......</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日志拦截器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> fun <span class="title function_">initLogInterceptor</span><span class="params">()</span>: HttpLoggingInterceptor &#123;</span><br><span class="line">        Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;initLogInterceptor: aaaaaaaaaaaaaaaaaaa&quot;</span>)</span><br><span class="line"><span class="comment">//        if (!BuildConfig.DEBUG) &#123;   //生产环境不打日志</span></span><br><span class="line"><span class="comment">//            Log.d(&quot;TAG&quot;, &quot;initLogInterceptor: bbbbbb&quot;)</span></span><br><span class="line"><span class="comment">//            return HttpLoggingInterceptor()</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;initLogInterceptor: ccccccc&quot;</span>)</span><br><span class="line">        <span class="type">val</span> <span class="variable">interceptor</span> <span class="operator">=</span> HttpLoggingInterceptor(object : HttpLoggingInterceptor.Logger &#123;</span><br><span class="line">            override fun <span class="title function_">log</span><span class="params">(message: String)</span> &#123;</span><br><span class="line">                Log.i(<span class="string">&quot;Retrofit_network&quot;</span>, message)</span><br><span class="line">                Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;log: message=$message&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        interceptor.level = HttpLoggingInterceptor.Level.BODY</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> interceptor</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求数据转 Json 形式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    open fun <span class="title function_">getJsonBody</span><span class="params">(data: Any)</span>: RequestBody &#123;</span><br><span class="line">+        Log.d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;getJsonBody: data=$data&quot;</span>)</span><br><span class="line">        <span class="type">val</span> <span class="variable">strEntity</span> <span class="operator">=</span> Gson().toJson(data)</span><br><span class="line">        <span class="keyword">return</span> strEntity.toRequestBody(mMediaTypeJson)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="./file/wzs2_station_bro_receive_start_mic_json_error_pa22_20221011_1953.log">pa22.log</a></p>
<p>下面是<code>pa22.log</code>的日志片段，可以看到里面报了一个这个错误<code>java.lang.IllegalStateException: Expected BEGIN_ARRAY but was NUMBER at line 4 column 16 path $.result</code>，下面找到问题所在了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">10-11 16:58:56.622  5501  5662 I Retrofit_network: --&gt; POST http://192.168.42.131:10000/api/pa/start_mic</span><br><span class="line">10-11 16:58:56.623  5501  5662 D TAG     : log: message=--&gt; POST http://192.168.42.131:10000/api/pa/start_mic</span><br><span class="line">10-11 16:58:56.623  5501  5662 I Retrofit_network: Content-Type: application/json; charset=utf-8</span><br><span class="line">10-11 16:58:56.624  5501  5662 D TAG     : log: message=Content-Type: application/json; charset=utf-8</span><br><span class="line">10-11 16:58:56.624  5501  5662 I Retrofit_network: Content-Length: 20</span><br><span class="line">10-11 16:58:56.624  5501  5662 D TAG     : log: message=Content-Length: 20</span><br><span class="line">10-11 16:58:56.624  5501  5662 I Retrofit_network: </span><br><span class="line">10-11 16:58:56.624  5501  5662 D TAG     : log: message=</span><br><span class="line">10-11 16:58:56.625  5501  5662 I Retrofit_network: &#123;&quot;zone_ids&quot;:[35001]&#125;</span><br><span class="line">10-11 16:58:56.625  5501  5662 D TAG     : log: message=&#123;&quot;zone_ids&quot;:[35001]&#125;</span><br><span class="line">10-11 16:58:56.626  5501  5662 I Retrofit_network: --&gt; END POST (20-byte body)</span><br><span class="line">10-11 16:58:56.626  5501  5662 D TAG     : log: message=--&gt; END POST (20-byte body)</span><br><span class="line">10-11 16:58:56.628  5501  5501 D IndexFragment: initView: applyFxData() - ats=[StationAts(createTime=1665478736, trainGroupNumber=212, serviceNumber=000, trainCrewNumber=000, trainPosition=1, trainRunningPosition=1, railName=T1212, stationID=012, terminalStationID=000, destinationID=000, identityID=+866022012)]</span><br><span class="line">10-11 16:58:56.658  5501  5662 I Retrofit_network: &lt;-- 200 OK http://192.168.42.131:10000/api/pa/start_mic (32ms)</span><br><span class="line">10-11 16:58:56.658  5501  5662 D TAG     : log: message=&lt;-- 200 OK http://192.168.42.131:10000/api/pa/start_mic (32ms)</span><br><span class="line">10-11 16:58:56.658  5501  5662 I Retrofit_network: Content-Length: 141</span><br><span class="line">10-11 16:58:56.658  5501  5662 D TAG     : log: message=Content-Length: 141</span><br><span class="line">10-11 16:58:56.658  5501  5662 I Retrofit_network: Content-Type: text/plain</span><br><span class="line">10-11 16:58:56.658  5501  5662 D TAG     : log: message=Content-Type: text/plain</span><br><span class="line">10-11 16:58:56.658  5501  5662 I Retrofit_network: Keep-Alive: timeout=5, max=5</span><br><span class="line">10-11 16:58:56.658  5501  5662 D TAG     : log: message=Keep-Alive: timeout=5, max=5</span><br><span class="line">10-11 16:58:56.659  5501  5662 I Retrofit_network: </span><br><span class="line">10-11 16:58:56.659  5501  5662 D TAG     : log: message=</span><br><span class="line">10-11 16:58:56.660  5501  5662 I Retrofit_network: &#123;</span><br><span class="line">10-11 16:58:56.660  5501  5662 I Retrofit_network:     &quot;code&quot;: 500,</span><br><span class="line">10-11 16:58:56.660  5501  5662 I Retrofit_network:     &quot;message&quot;: &quot;token已经过期,请重新申请!&quot;,</span><br><span class="line">10-11 16:58:56.660  5501  5662 I Retrofit_network:     &quot;result&quot;: 0,</span><br><span class="line">10-11 16:58:56.660  5501  5662 I Retrofit_network:     &quot;success&quot;: false,</span><br><span class="line">10-11 16:58:56.660  5501  5662 I Retrofit_network:     &quot;timestamp&quot;: 1665478728</span><br><span class="line">10-11 16:58:56.660  5501  5662 I Retrofit_network: &#125;</span><br><span class="line">10-11 16:58:56.660  5501  5662 D TAG     : log: message=&#123;</span><br><span class="line">10-11 16:58:56.660  5501  5662 D TAG     :     &quot;code&quot;: 500,</span><br><span class="line">10-11 16:58:56.660  5501  5662 D TAG     :     &quot;message&quot;: &quot;token已经过期,请重新申请!&quot;,</span><br><span class="line">10-11 16:58:56.660  5501  5662 D TAG     :     &quot;result&quot;: 0,</span><br><span class="line">10-11 16:58:56.660  5501  5662 D TAG     :     &quot;success&quot;: false,</span><br><span class="line">10-11 16:58:56.660  5501  5662 D TAG     :     &quot;timestamp&quot;: 1665478728</span><br><span class="line">10-11 16:58:56.660  5501  5662 D TAG     : &#125;</span><br><span class="line">10-11 16:58:56.660  5501  5662 I Retrofit_network: &lt;-- END HTTP (141-byte body)</span><br><span class="line">10-11 16:58:56.660  5501  5662 D TAG     : log: message=&lt;-- END HTTP (141-byte body)</span><br><span class="line">10-11 16:58:56.665  5501  5501 I APP_LogUtils.kt: [(LogUtils.kt:50).i()] [com.gbcom.library_base.service.LLteService] lte_resp_sys_for_emci_detail - EmciDetail=com.ztegota.system.common.EmciDetail@d13f120</span><br><span class="line">10-11 16:58:56.668  5501  5602 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---aaaaa--</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10-11 16:58:56.668  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-11 16:58:56.668  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 16:58:56.668  5501  5602 W System.err: com.google.gson.JsonSyntaxException: java.lang.IllegalStateException: Expected BEGIN_ARRAY but was NUMBER at line 4 column 16 path $.result</span><br><span class="line">10-11 16:58:56.669  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 1getCurrentFileName: LogWriteUtil.logfile=app.log</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:226)</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at retrofit2.converter.gson.GsonResponseBodyConverter.convert(GsonResponseBodyConverter.java:40)</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at retrofit2.converter.gson.GsonResponseBodyConverter.convert(GsonResponseBodyConverter.java:27)</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at retrofit2.OkHttpCall.parseResponse(OkHttpCall.java:243)</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:153)</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at java.lang.Thread.run(Thread.java:761)</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: Caused by: java.lang.IllegalStateException: Expected BEGIN_ARRAY but was NUMBER at line 4 column 16 path $.result</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at com.google.gson.stream.JsonReader.beginArray(JsonReader.java:350)</span><br><span class="line">10-11 16:58:56.669  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at com.google.gson.internal.bind.CollectionTypeAdapterFactory$Adapter.read(CollectionTypeAdapterFactory.java:80)</span><br><span class="line">10-11 16:58:56.669  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at com.google.gson.internal.bind.CollectionTypeAdapterFactory$Adapter.read(CollectionTypeAdapterFactory.java:61)</span><br><span class="line">10-11 16:58:56.669  5501  5602 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$1.read(ReflectiveTypeAdapterFactory.java:131)</span><br><span class="line">10-11 16:58:56.670  5501  5602 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:222)</span><br><span class="line">10-11 16:58:56.670  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 16:58:56.670  5501  5602 W System.err: 	... 8 more</span><br><span class="line">10-11 16:58:56.670  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=14</span><br><span class="line">10-11 16:58:56.670  5501  5602 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] paStartMic() Exception - zone_ids=[35001], e=java.lang.IllegalStateException: Expected BEGIN_ARRAY but was NUMBER at line 4 column 16 path $.result</span><br></pre></td></tr></table></figure>

<blockquote>
<p>代码修改<br>仔细分析了下API接口文档和日志输出格式，发现对方发来的json格式是有问题的，只是发了一个[{…….}]这种过来，APP代码也需要进行相应的修改。</p>
</blockquote>
<p>广播服务器开始站区广播接口</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_start_mic_return_json_2022-10-11_200144.png" alt="广播服务器开始站区广播接口"></p>
<p>先修改模拟器服务器的返回：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="string">&quot;&#123;\&quot;success\&quot;:true,\n\&quot;code\&quot;:200,\n\&quot;timestamp\&quot;:1731936161,\&quot;message\&quot;:\&quot;ok\&quot;,\&quot;result\&quot;:[&#123;\&quot;id\&quot;:35001,\&quot;result\&quot;:true,\&quot;reason\&quot;:\&quot;广播呼叫成功\&quot;&#125;]&#125;&quot;</span>;</span><br><span class="line">+ <span class="string">&quot;[&#123;\&quot;id\&quot;: 35001,\&quot;reason\&quot;: \&quot;广播呼叫成功\&quot;,\&quot;result\&quot;: true&#125;]&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>先实验室执行一次广播操作，服务器直接返回<code>[&#123;\&quot;id\&quot;: 35001,\&quot;reason\&quot;: \&quot;广播呼叫成功\&quot;,\&quot;result\&quot;: true&#125;]</code>，APP接收服务器并处理数据的时候，也是温州S2现场一样的err问题，因为APP解析数据是按照<code>&#123;\&quot;success\&quot;:true,\n\&quot;code\&quot;:200,\n\&quot;timestamp\&quot;:1731936161,\&quot;message\&quot;:\&quot;ok\&quot;,\&quot;result\&quot;:[&#123;\&quot;id\&quot;:35001,\&quot;result\&quot;:true,\&quot;reason\&quot;:\&quot;广播呼叫成功\&quot;&#125;]&#125;</code>来解析的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">10-11 19:47:03.156 15412 15474 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---666666666666666--</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">10-11 19:47:03.161 15412 15911 I Retrofit_network: --&gt; POST http://192.168.42.55:8086/api/pa/start_mic</span><br><span class="line">10-11 19:47:03.161 15412 15911 D TAG     : 111111--convert: log: message=--&gt; POST http://192.168.42.55:8086/api/pa/start_mic</span><br><span class="line">10-11 19:47:03.161 15412 15911 I Retrofit_network: Content-Type: application/json; charset=utf-8</span><br><span class="line">10-11 19:47:03.161 15412 15911 D TAG     : 111111--convert: log: message=Content-Type: application/json; charset=utf-8</span><br><span class="line">10-11 19:47:03.161 15412 15911 I Retrofit_network: Content-Length: 20</span><br><span class="line">10-11 19:47:03.161 15412 15911 D TAG     : 111111--convert: log: message=Content-Length: 20</span><br><span class="line">10-11 19:47:03.162 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-11 19:47:03.162 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 19:47:03.162 15412 15911 I Retrofit_network: </span><br><span class="line">10-11 19:47:03.162 15412 15911 D TAG     : 111111--convert: log: message=</span><br><span class="line">10-11 19:47:03.162 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 19:47:03.162 15412 15911 I Retrofit_network: &#123;&quot;zone_ids&quot;:[35001]&#125;</span><br><span class="line">10-11 19:47:03.162 15412 15911 D TAG     : 111111--convert: log: message=&#123;&quot;zone_ids&quot;:[35001]&#125;</span><br><span class="line">10-11 19:47:03.162 15412 15911 I Retrofit_network: --&gt; END POST (20-byte body)</span><br><span class="line">10-11 19:47:03.162 15412 15911 D TAG     : 111111--convert: log: message=--&gt; END POST (20-byte body)</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">10-11 19:47:03.179 15412 15911 I Retrofit_network: &lt;-- 200 http://192.168.42.55:8086/api/pa/start_mic (16ms)</span><br><span class="line">10-11 19:47:03.179 15412 15911 D TAG     : 111111--convert: log: message=&lt;-- 200 http://192.168.42.55:8086/api/pa/start_mic (16ms)</span><br><span class="line">10-11 19:47:03.179 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 3getCurrentFileName: logFileName=app63.log</span><br><span class="line">10-11 19:47:03.179 15412 15911 I Retrofit_network: Content-Type: application/json;charset=UTF-8</span><br><span class="line">10-11 19:47:03.179 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1,initFile: getFilePath()=/custom/metro/log/2022-10-11, getCurrentFileName=app63.log</span><br><span class="line">10-11 19:47:03.179 15412 15911 D TAG     : 111111--convert: log: message=Content-Type: application/json;charset=UTF-8</span><br><span class="line">10-11 19:47:03.179 15412 15911 I Retrofit_network: Content-Length: 61</span><br><span class="line">10-11 19:47:03.179 15412 15911 D TAG     : 111111--convert: log: message=Content-Length: 61</span><br><span class="line">10-11 19:47:03.179 15412 15911 I Retrofit_network: Date: Tue, 11 Oct 2022 11:46:02 GMT</span><br><span class="line">10-11 19:47:03.179 15412 15911 D TAG     : 111111--convert: log: message=Date: Tue, 11 Oct 2022 11:46:02 GMT</span><br><span class="line">10-11 19:47:03.180 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-11 19:47:03.180 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 19:47:03.180 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getCurrentFileName: LogWriteUtil.logfile=app.log</span><br><span class="line">10-11 19:47:03.180 15412 15911 I Retrofit_network: </span><br><span class="line">10-11 19:47:03.180 15412 15911 D TAG     : 111111--convert: log: message=</span><br><span class="line">10-11 19:47:03.180 15412 15911 I Retrofit_network: [&#123;&quot;id&quot;: 35001,&quot;reason&quot;: &quot;骞挎挱鍛煎彨鎴愬姛&quot;,&quot;result&quot;: true&#125;]</span><br><span class="line">10-11 19:47:03.181 15412 15911 D TAG     : 111111--convert: log: message=[&#123;&quot;id&quot;: 35001,&quot;reason&quot;: &quot;骞挎挱鍛煎彨鎴愬姛&quot;,&quot;result&quot;: true&#125;]</span><br><span class="line">10-11 19:47:03.181 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-11 19:47:03.181 15412 15911 I Retrofit_network: &lt;-- END HTTP (61-byte body)</span><br><span class="line">10-11 19:47:03.181 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 19:47:03.181 15412 15911 D TAG     : 111111--convert: log: message=&lt;-- END HTTP (61-byte body)</span><br><span class="line">10-11 19:47:03.181 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 19:47:03.181 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=63</span><br><span class="line">10-11 19:47:03.182 15412 15911 D TAG     : 22222222222222222222convert: response=[&#123;&quot;id&quot;: 35001,&quot;reason&quot;: &quot;骞挎挱鍛煎彨鎴愬姛&quot;,&quot;result&quot;: true&#125;]</span><br><span class="line">10-11 19:47:03.182 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-11 19:47:03.182 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 19:47:03.182 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 19:47:03.182 15412 15911 D TAG     : 22222222222222222222convert: response=[&#123;&quot;id&quot;: 35001,&quot;reason&quot;: &quot;骞挎挱鍛煎彨鎴愬姛&quot;,&quot;result&quot;: true&#125;]</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: com.google.gson.JsonSyntaxException: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $</span><br><span class="line">10-11 19:47:03.183 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 3getCurrentFileName: logFileName=app63.log</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:226)</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:47)</span><br><span class="line">10-11 19:47:03.183 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getCurrentFileName: LogWriteUtil.logfile=app.log</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:15)</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: 	at retrofit2.OkHttpCall.parseResponse(OkHttpCall.java:243)</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:153)</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: 	at java.lang.Thread.run(Thread.java:761)</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: Caused by: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $</span><br><span class="line">10-11 19:47:03.183 15412 15911 W System.err: 	at com.google.gson.stream.JsonReader.beginObject(JsonReader.java:385)</span><br><span class="line">10-11 19:47:03.184 15412 15911 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:215)</span><br><span class="line">10-11 19:47:03.184 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-11 19:47:03.184 15412 15911 W System.err: 	... 8 more</span><br><span class="line">10-11 19:47:03.184 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 19:47:03.184 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 19:47:03.184 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=63</span><br><span class="line">10-11 19:47:03.185 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-11 19:47:03.185 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 19:47:03.185 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11</span><br><span class="line">10-11 19:47:03.185 15412 15687 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---aaaaa--</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: com.google.gson.JsonSyntaxException: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:226)</span><br><span class="line">10-11 19:47:03.186 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 3getCurrentFileName: logFileName=app63.log</span><br><span class="line">10-11 19:47:03.186 15412 15431 D TAG     : 2,initFile: /custom/metro/log/2022-10-11/app63.log, logFile.length=0, getCurrentFileName()=app63.log, writeFileName=/custom/metro/log/2022-10-11/app62.log</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: 	at com.google.gson.TypeAdapter.fromJson(TypeAdapter.java:260)</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: 	at com.google.gson.TypeAdapter.fromJson(TypeAdapter.java:273)</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:51)</span><br><span class="line">10-11 19:47:03.186 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 8,initFile: logFile=/custom/metro/log/2022-10-11/app63.log, logFile.length=0</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:15)</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: 	at retrofit2.OkHttpCall.parseResponse(OkHttpCall.java:243)</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:153)</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)</span><br><span class="line">10-11 19:47:03.186 15412 15687 W System.err: 	at java.lang.Thread.run(Thread.java:761)</span><br><span class="line">10-11 19:47:03.187 15412 15687 W System.err: Caused by: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $</span><br><span class="line">10-11 19:47:03.187 15412 15687 W System.err: 	at com.google.gson.stream.JsonReader.beginObject(JsonReader.java:385)</span><br><span class="line">10-11 19:47:03.187 15412 15687 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:215)</span><br><span class="line">10-11 19:47:03.187 15412 15687 W System.err: 	... 10 more</span><br><span class="line">10-11 19:47:03.187 15412 15687 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] paStartMic() Exception - zone_ids=[35001], e=java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $</span><br><span class="line">10-11 19:47:03.188 15412 15687 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---bbbbb--</span><br></pre></td></tr></table></figure>

<p>温州S2号线APP：因为文档中没有外层包装<code>ApiResp.kt</code>，所以直接返回<code>List&lt;StartMicRespData&gt;</code>就可以了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_base.service</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 站选区广播接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/07/28 14:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PaApiService</span> &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发起呼叫站广播</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@POST(&quot;api/pa/start_mic&quot;)</span></span><br><span class="line">-    suspend fun <span class="title function_">startMic</span><span class="params">(<span class="meta">@Body</span> body: RequestBody)</span>: ApiResp&lt;List&lt;StartMicRespData&gt;&gt;</span><br><span class="line">+    suspend fun <span class="title function_">startMic</span><span class="params">(<span class="meta">@Body</span> body: RequestBody)</span>: List&lt;StartMicRespData&gt;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.gbcom.library_main.mvvm.viewmodel</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainViewModel</span>(application: Application) : BaseViewModel(application) &#123;</span><br><span class="line"></span><br><span class="line">    .......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发起站选区广播</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/07/28 14:25</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    fun <span class="title function_">paStartMic</span><span class="params">(list: MutableList&lt;Int&gt;)</span> &#123;</span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">-        <span class="type">val</span> <span class="variable">result</span> <span class="operator">=</span> HttpManager.INSTANCE.mApi.startMic(param).apiData()</span><br><span class="line">+        <span class="type">val</span> <span class="variable">result</span> <span class="operator">=</span> HttpManager.INSTANCE.mApi.startMic(param)</span><br><span class="line"></span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实验室站区广播自测试：</p>
<p>获取到API服务器的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2022-10-11 19:59:33.875 16211-16732/com.gbcom.metrosystem D/TAG: 22222222222222222222convert: response=[&#123;&quot;id&quot;: 35001,&quot;reason&quot;: &quot;广播呼叫成功&quot;,&quot;result&quot;: true&#125;]</span><br><span class="line">2022-10-11 19:59:33.876 16211-16732/com.gbcom.metrosystem D/TAG: 122222222222222222222convert: response=[&#123;&quot;id&quot;: 35001,&quot;reason&quot;: &quot;广播呼叫成功&quot;,&quot;result&quot;: true&#125;]</span><br><span class="line">2022-10-11 19:59:33.877 16211-16732/com.gbcom.metrosystem D/TAG: 322222222222222222222convert:  jsonReader=JsonReader at line 1 column 1 path $, [StartMicRespData(id=35001, result=true, reason=广播呼叫成功)]</span><br><span class="line">2022-10-11 19:59:41.792 16211-16732/com.gbcom.metrosystem D/TAG: 22222222222222222222convert: response=&#123;&quot;success&quot;:true,&quot;code&quot;:200,&quot;timestamp&quot;:1731936161,&quot;message&quot;:&quot;ok&quot;,&quot;result&quot;:&#123;&quot;id&quot;:0,&quot;result&quot;:true,&quot;reason&quot;:&quot;撤销呼叫站广播成功&quot;&#125;&#125;</span><br><span class="line">2022-10-11 19:59:41.793 16211-16732/com.gbcom.metrosystem D/TAG: 122222222222222222222convert: response=&#123;&quot;success&quot;:true,&quot;code&quot;:200,&quot;timestamp&quot;:1731936161,&quot;message&quot;:&quot;ok&quot;,&quot;result&quot;:&#123;&quot;id&quot;:0,&quot;result&quot;:true,&quot;reason&quot;:&quot;撤销呼叫站广播成功&quot;&#125;&#125;</span><br><span class="line">2022-10-11 19:59:41.793 16211-16732/com.gbcom.metrosystem D/TAG: 322222222222222222222convert:  jsonReader=JsonReader at line 1 column 1 path $, ApiResp(success=true, code=200, message=ok, timestamp=1731936161, result=StopMicRespData(result=true, reason=撤销呼叫站广播成功))</span><br></pre></td></tr></table></figure>

<p>下面是APP代码里的后续处一。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">2022-10-11 19:59:33.292 16211-16211/com.gbcom.metrosystem D/BaseApp: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------aaaa000001---receive call</span><br><span class="line">2022-10-11 19:59:33.735 16211-16211/com.gbcom.metrosystem D/CallActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------aaaa00000---start</span><br><span class="line">2022-10-11 19:59:33.735 16211-16211/com.gbcom.metrosystem D/CallActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------aaaa111---start</span><br><span class="line">2022-10-11 19:59:33.735 16211-16211/com.gbcom.metrosystem D/CallActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------aaaa2222---start</span><br><span class="line">2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbb---start</span><br><span class="line">2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbbb---start----number=20000000005</span><br><span class="line">2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---number=20000000005</span><br><span class="line">2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list1=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]</span><br><span class="line">2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--8620000000005, +8620000000005 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]</span><br><span class="line">2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list3=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]</span><br><span class="line">2022-10-11 19:59:33.784 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--866027340, +866027340 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]</span><br><span class="line">2022-10-11 19:59:33.784 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--866027521, +866027521 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]</span><br><span class="line">2022-10-11 19:59:33.784 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---mZoneIDs=[35001], ---AppConstant.station_zone_bro_list4=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]</span><br><span class="line">2022-10-11 19:59:33.784 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---2222</span><br><span class="line">2022-10-11 19:59:33.784 16211-16211/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa -------3333</span><br><span class="line">2022-10-11 19:59:33.795 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa------44444</span><br><span class="line">2022-10-11 19:59:33.797 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---555555--false</span><br><span class="line">2022-10-11 19:59:33.800 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---666666666666666--</span><br><span class="line">2022-10-11 19:59:33.881 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---7777777777777--result=[StartMicRespData(id=35001, result=true, reason=广播呼叫成功)]</span><br><span class="line">2022-10-11 19:59:33.881 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---7777777777777--</span><br><span class="line">2022-10-11 19:59:35.028 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---bbbbb--</span><br></pre></td></tr></table></figure>

<p>可以看到处理数据成功，OK。<br>制作温州S2号线APP V1.1.4版本，明天测试。</p>
<h3 id="5-5-温州S2号线车站站选区广播20221012对接调试"><a href="#5-5-温州S2号线车站站选区广播20221012对接调试" class="headerlink" title="5.5.温州S2号线车站站选区广播20221012对接调试"></a>5.5.温州S2号线车站站选区广播20221012对接调试</h3><h4 id="5-5-1-首次调试没有访问温州S2广播接口的问题"><a href="#5-5-1-首次调试没有访问温州S2广播接口的问题" class="headerlink" title="5.5.1.首次调试没有访问温州S2广播接口的问题"></a>5.5.1.首次调试没有访问温州S2广播接口的问题</h4><p><a href="./file/wzs2_station_bro_app_pa2_20221012_1119.log">终端pa2</a></p>
<p>下面是本次站区广播日志【终端pa2】片段。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">10-12 10:30:56.289  2699  2699 D MainActivity: onReceive: new request mBroadCastReceiver, intent?.action=com.gbcom.action.ACTION_FX_STATION_BRD_ZONE_START_TASK</span><br><span class="line">10-12 10:30:56.289  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-12, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-12 10:30:56.289  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 10:30:56.289  2699  2699 D MainActivity: onReceive: 站选区广播开始 start</span><br><span class="line">10-12 10:30:56.289  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbb---start</span><br><span class="line">10-12 10:30:56.289  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 1getCurrentFileName: LogWriteUtil.logfile=app.log</span><br><span class="line">10-12 10:30:56.289  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbbb---start----number=866027333</span><br><span class="line">10-12 10:30:56.289  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---number=866027333</span><br><span class="line">10-12 10:30:56.289  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list1=[StationBrdZone(zoneID=1, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=2, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35001, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35002, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=35003, zoneName=海城站动态重组组, groupID=6027514)]</span><br><span class="line">10-12 10:30:56.289  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--866027333, +866027333 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=2, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35001, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35002, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=35003, zoneName=海城站动态重组组, groupID=6027514)]</span><br><span class="line">10-12 10:30:56.289  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-12, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-12 10:30:56.289  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 10:30:56.290  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 10:30:56.290  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list3=[StationBrdZone(zoneID=1, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=2, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35001, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35002, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=35003, zoneName=海城站动态重组组, groupID=6027514)]</span><br><span class="line">10-12 10:30:56.290  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--866027353, +866027353 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=2, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35001, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35002, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=35003, zoneName=海城站动态重组组, groupID=6027514)]</span><br><span class="line"></span><br><span class="line">10-12 10:30:56.290  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 10:30:56.290  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---2222</span><br><span class="line">10-12 10:30:56.291  2699  2699 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa -------3333</span><br><span class="line"></span><br><span class="line">10-12 10:30:56.293  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 8,initFile: logFile=/custom/metro/log/2022-10-12/app7.log, logFile.length=1028583</span><br><span class="line">10-12 10:30:56.295  2699  4933 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa------44444</span><br><span class="line">10-12 10:30:56.296  2699  4933 D PaRepository: getAppID: authName=user, userNum=1234, appid=ef08e274512c41d885a755edc7870e9d, appidTime=5984373</span><br><span class="line">10-12 10:30:56.296  2699  4933 D APP_LogUtils.kt: [(LogUtils.kt:45).d()] getAppID() - appid not expired, appid=ef08e274512c41d885a755edc7870e9d</span><br><span class="line">10-12 10:30:56.299  2699  4933 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---555555--false</span><br><span class="line"></span><br><span class="line">10-12 10:30:56.300  2699  4618 D APP_LogUtils.kt: [(LogUtils.kt:45).d()] getToken() - token not expired, token=ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTQ3Mjg5OQ==, tokenTime=5984425</span><br><span class="line">10-12 10:30:56.300  2699  4618 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---666666666666666--</span><br><span class="line"></span><br><span class="line">10-12 10:30:56.310  2699  5400 I Retrofit_network: --&gt; POST http://192.168.42.55:8086/api/pa/start_mic</span><br><span class="line">10-12 10:30:56.310  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-12, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-12 10:30:56.310  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 10:30:56.310  2699  5400 D TAG     : 111111--convert: log: message=--&gt; POST http://192.168.42.55:8086/api/pa/start_mic</span><br><span class="line">10-12 10:30:56.310  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 10:30:56.310  2699  5400 I Retrofit_network: Content-Type: application/json; charset=utf-8</span><br><span class="line">10-12 10:30:56.310  2699  5400 D TAG     : 111111--convert: log: message=Content-Type: application/json; charset=utf-8</span><br><span class="line">10-12 10:30:56.310  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=7</span><br><span class="line">10-12 10:30:56.310  2699  5400 I Retrofit_network: Content-Length: 22</span><br><span class="line">10-12 10:30:56.310  2699  5400 D TAG     : 111111--convert: log: message=Content-Length: 22</span><br><span class="line"></span><br><span class="line">10-12 10:30:56.329  2699  5400 I Retrofit_network: </span><br><span class="line">10-12 10:30:56.329  2699  5400 D TAG     : 111111--convert: log: message=</span><br><span class="line">10-12 10:30:56.329  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=7</span><br><span class="line">10-12 10:30:56.329  2699  5400 I Retrofit_network: &#123;&quot;zone_ids&quot;:[1,35002]&#125;</span><br><span class="line">10-12 10:30:56.329  2699  5400 D TAG     : 111111--convert: log: message=&#123;&quot;zone_ids&quot;:[1,35002]&#125;</span><br><span class="line">10-12 10:30:56.330  2699  5400 I Retrofit_network: --&gt; END POST (22-byte body)</span><br><span class="line">10-12 10:30:56.330  2699  5400 D TAG     : 111111--convert: log: message=--&gt; END POST (22-byte body)</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">10-12 10:30:58.439  2699  5361 I APP_LogUtils.kt: [(LogUtils.kt:50).i()] [MainViewModel] GotaSystem SDK:V2.13 2021-04-20, Host Soft Version:GM655+V1.0.6.8B02, Host Hard Version:GM655MB_C, Host Build Time:2021年 12月 28日 星期二 16:23:13 CST;</span><br><span class="line"></span><br><span class="line">10-12 10:30:59.338   671   671 I cnss-daemon: RTM_NEWNEIGH message received: 28</span><br><span class="line">10-12 10:30:59.338   671   671 E cnss-daemon: Stale or unreachable neighbors, ndm state: 32</span><br><span class="line">10-12 10:30:59.341  2699  5400 I Retrofit_network: &lt;-- HTTP FAILED: java.net.NoRouteToHostException: No route to host</span><br><span class="line">10-12 10:30:59.342  2699  5400 D TAG     : 111111--convert: log: message=&lt;-- HTTP FAILED: java.net.NoRouteToHostException: No route to host</span><br><span class="line">10-12 10:30:59.343  2699  4618 W System.err: java.net.NoRouteToHostException: No route to host</span><br><span class="line">10-12 10:30:59.344  2699  4618 W System.err: 	at java.net.PlainSocketImpl.socketConnect(Native Method)</span><br><span class="line">10-12 10:30:59.344  2699  4618 W System.err: 	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:334)</span><br><span class="line">10-12 10:30:59.344  2699  4618 W System.err: 	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:196)</span><br><span class="line">10-12 10:30:59.344  2699  4618 W System.err: 	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:178)</span><br><span class="line">10-12 10:30:59.344  2699  4618 W System.err: 	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:356)</span><br><span class="line">10-12 10:30:59.345  2699  4618 W System.err: 	at java.net.Socket.connect(Socket.java:605)</span><br><span class="line">10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.platform.AndroidPlatform.connectSocket(AndroidPlatform.kt:58)</span><br><span class="line">10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:268)</span><br><span class="line">10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.RealConnection.connect(RealConnection.kt:176)</span><br><span class="line">10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findConnection(ExchangeFinder.kt:236)</span><br><span class="line">10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findHealthyConnection(ExchangeFinder.kt:109)</span><br><span class="line">10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.find(ExchangeFinder.kt:77)</span><br><span class="line">10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.Transmitter.newExchange$okhttp(Transmitter.kt:162)</span><br><span class="line">10-12 10:30:59.346  2699  4618 W System.err: 	at okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.kt:35)</span><br><span class="line">10-12 10:30:59.346  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)</span><br><span class="line">10-12 10:30:59.346  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)</span><br><span class="line">10-12 10:30:59.346  2699  4618 W System.err: 	at okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.kt:82)</span><br><span class="line">10-12 10:30:59.346  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)</span><br><span class="line">10-12 10:30:59.347  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)</span><br><span class="line">10-12 10:30:59.348  2699  4618 W System.err: 	at okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.kt:84)</span><br><span class="line">10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)</span><br><span class="line">10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.kt:71)</span><br><span class="line">10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)</span><br><span class="line">10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)</span><br><span class="line">10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.logging.HttpLoggingInterceptor.intercept(HttpLoggingInterceptor.kt:215)</span><br><span class="line">10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)</span><br><span class="line">10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)</span><br><span class="line">10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.RealCall.getResponseWithInterceptorChain(RealCall.kt:184)</span><br><span class="line">10-12 10:30:59.350  2699  4618 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:136)</span><br><span class="line">10-12 10:30:59.350  2699  4618 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)</span><br><span class="line">10-12 10:30:59.350  2699  4618 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)</span><br><span class="line">10-12 10:30:59.351  2699  4618 W System.err: 	at java.lang.Thread.run(Thread.java:761)</span><br><span class="line">10-12 10:30:59.351  2699  4618 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---999999999999--</span><br><span class="line">10-12 10:30:59.353  2699  4618 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] paStartMic() NoRouteToHostException - zone_ids=[1, 35002], e=No route to host</span><br></pre></td></tr></table></figure>

<p><a href="./file/wzs2_station_bro_master_pa1eth1_20221012_1123.pcap">主机pa1eth1.pcap</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_base.utils</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">class</span> HttpManager &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> val retrofit: Retrofit</span><br><span class="line">    val mApi: PaApiService</span><br><span class="line">    <span class="keyword">private</span> val mMediaTypeJson: MediaType?</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">        Log.d(<span class="string">&quot;HttpManager.kt&quot;</span>, <span class="string">&quot;get paAddress: PA_ADDRESS=$&#123;Config.PA_PATH_PREFIX.plus(Config.PA_ADDRESS).plus(&quot;</span>:<span class="string">&quot;).plus(Config.PA_PORT).plus(File.separator)&#125;&quot;</span>)</span><br><span class="line">        retrofit = Retrofit.Builder()</span><br><span class="line">            <span class="comment">//.baseUrl(Config.PA_PATH_PREFIX.plus(Config.PA_ADDRESS).plus(&quot;:&quot;).plus(Config.PA_PORT).plus(File.separator))</span></span><br><span class="line">            .baseUrl(<span class="string">&quot;http://192.168.42.55:8086/&quot;</span>)</span><br><span class="line">            .client(initOkhttpClient())</span><br><span class="line">            <span class="comment">//.addConverterFactory(GsonConverterFactory.create())</span></span><br><span class="line">            .addConverterFactory(HttpManagerDecodeConverterFactory.create())</span><br><span class="line">            .build()</span><br><span class="line">        mApi = retrofit.create(PaApiService::class.java)</span><br><span class="line">        mMediaTypeJson = <span class="string">&quot;application/json; charset=utf-8&quot;</span>.toMediaTypeOrNull()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>V1.1.4：版本有问题，地址写死了。<br>11：28，出V1.1.5，发产品四群里：修改了<code>baseUrl(&quot;http://192.168.42.55:8086/&quot;)</code>为APP正常代码<code>.baseUrl(Config.PA_PATH_PREFIX.plus(Config.PA_ADDRESS).plus(&quot;:&quot;).plus(Config.PA_PORT).plus(File.separator))</code>。</p>
<h4 id="5-5-2-广播区域ID问题"><a href="#5-5-2-广播区域ID问题" class="headerlink" title="5.5.2.广播区域ID问题"></a>5.5.2.广播区域ID问题</h4><p><a href="./file/wzs2_station_bro_app_pa4_20221012_1143.log">终端pa4.log</a></p>
<p>查看日志可以看到，<code>groupID=6027353</code>有两条信息，一个区域ID是1，一个区域ID是35001，另一个下行也有两条记录。</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_staton_bro_brd_zone_error_2022-10-12_113928.png"></p>
<p>日志片段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10-12 11:33:37.209  7494  7494 D MainActivity: init: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-----get zone bro list=[]</span><br><span class="line">10-12 11:33:37.209  7494  7494 D MainActivity: init: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-----get zone bro list2=[StationBrdZone(zoneID=1, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=2, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35001, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35002, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=35003, zoneName=海城站动态重组组, groupID=6027514)]</span><br></pre></td></tr></table></figure>

<p><a href="./file/wzs2_station_bro_master_pa4eth1_20221012_1135.pcap">主机pa4eth1.pcap 下载</a></p>
<p>下面是抓包截图：</p>
<p>发起start_mic的参数</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_staton_bro_brd_zone_error2_2022-10-12_114101.png" alt="发起start_mic的参数"></p>
<p>获取start_mic的响应</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_staton_bro_brd_zone_error3_2022-10-12_114123.png" alt="获取start_mic的响应"></p>
<p>在代码里</p>
<p><a href="./file/wzs2_station_bro_app_log_pa6_202211012.log">终端pa6.log</a></p>
<h4 id="5-5-3-没有stopMic问题"><a href="#5-5-3-没有stopMic问题" class="headerlink" title="5.5.3.没有stopMic问题"></a>5.5.3.没有stopMic问题</h4><p>说没有stop广播，下面是抓取的终端pa7.log]日志</p>
<p><a href="./file/wzs2_station_bro_app_log_pa7_20221012.log">终端pa7.log</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">10-12 14:08:52.318  6346  8007 I Retrofit_network: --&gt; DELETE http://192.168.42.131:10000/api/pa/stop_mic</span><br><span class="line">10-12 14:08:52.319  6346  8007 D TAG     : 111111--convert: log: message=--&gt; DELETE http://192.168.42.131:10000/api/pa/stop_mic</span><br><span class="line">10-12 14:08:52.319  6346  8007 I Retrofit_network: --&gt; END DELETE</span><br><span class="line">10-12 14:08:52.319  6346  8007 D TAG     : 111111--convert: log: message=--&gt; END DELETE</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">10-12 14:08:52.331  6346  8007 I Retrofit_network: &lt;-- 404 Not Found http://192.168.42.131:10000/api/pa/stop_mic (12ms)</span><br><span class="line">10-12 14:08:52.331  6346  8007 D TAG     : 111111--convert: log: message=&lt;-- 404 Not Found http://192.168.42.131:10000/api/pa/stop_mic (12ms)</span><br><span class="line">10-12 14:08:52.331  6346  8007 I Retrofit_network: Content-Length: 0</span><br><span class="line">10-12 14:08:52.331  6346  8007 D TAG     : 111111--convert: log: message=Content-Length: 0</span><br><span class="line">10-12 14:08:52.331  6346  8007 I Retrofit_network: Keep-Alive: timeout=5, max=5</span><br><span class="line">10-12 14:08:52.331  6346  8007 D TAG     : 111111--convert: log: message=Keep-Alive: timeout=5, max=5</span><br><span class="line">10-12 14:08:52.331  6346  8007 I Retrofit_network: &lt;-- END HTTP (0-byte body)</span><br><span class="line">10-12 14:08:52.331  6346  8007 D TAG     : 111111--convert: log: message=&lt;-- END HTTP (0-byte body)</span><br><span class="line">10-12 14:08:52.335  6346  7913 W System.err: retrofit2.HttpException: HTTP 404 Not Found</span><br><span class="line">10-12 14:08:52.335  6346  7913 W System.err: 	at retrofit2.KotlinExtensions$await$2$2.onResponse(KotlinExtensions.kt:53)</span><br><span class="line">10-12 14:08:52.335  6346  7913 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:161)</span><br><span class="line">10-12 14:08:52.335  6346  7913 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)</span><br><span class="line">10-12 14:08:52.335  6346  7913 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)</span><br><span class="line">10-12 14:08:52.335  6346  7913 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)</span><br><span class="line">10-12 14:08:52.335  6346  7913 W System.err: 	at java.lang.Thread.run(Thread.java:761)</span><br><span class="line">10-12 14:08:52.336  6346  7913 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] stopMic() Exception - e=HTTP 404 Not Found</span><br></pre></td></tr></table></figure>

<p>[主机pa7eth.pcap]</p>
<h4 id="5-5-4-广播区域列表错误"><a href="#5-5-4-广播区域列表错误" class="headerlink" title="5.5.4.广播区域列表错误"></a>5.5.4.广播区域列表错误</h4><p>修改从DIS获取的广播列表错误问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_base.dao</span><br><span class="line"></span><br><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">StationBrdZoneDao</span> : BaseDao&lt;StationBrdZone&gt; &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">+    <span class="comment">/**</span></span><br><span class="line"><span class="comment">+     * 根据组获取某一条数据</span></span><br><span class="line"><span class="comment">+     * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment">+     * <span class="doctag">@date</span> 2022/10/12 13:55</span></span><br><span class="line"><span class="comment">+     */</span></span><br><span class="line">+    <span class="meta">@Query(&quot;SELECT * FROM metro_station_brd_zone WHERE group_id = :groupId&quot;)</span></span><br><span class="line">+    fun <span class="title function_">getStationBrdZoneByGroupId</span><span class="params">(groupId: String)</span>: StationBrdZone?</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">+    <span class="comment">/**</span></span><br><span class="line"><span class="comment">+     * 温州S2现场呼叫组号：866027333</span></span><br><span class="line"><span class="comment">+     * 从DIS拿到的广播组列表组号：6027333</span></span><br><span class="line"><span class="comment">+     * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment">+     * <span class="doctag">@date</span> 2022/10/12 13:55</span></span><br><span class="line"><span class="comment">+     */</span></span><br><span class="line">+    <span class="meta">@Query(&quot;DELETE FROM metro_station_brd_zone WHERE group_id = :groupId&quot;)</span></span><br><span class="line">+    fun <span class="title function_">deleteStationBrdZone</span><span class="params">(groupId: String)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-5-5-广播停止不了继续"><a href="#5-5-5-广播停止不了继续" class="headerlink" title="5.5.5.广播停止不了继续"></a>5.5.5.广播停止不了继续</h4><p>广播停止不了</p>
<p>14：47，停止stop_mic添加参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_base.service</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 站选区广播接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/07/28 14:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PaApiService</span> &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 撤销呼叫站广播</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/07/28 17:14</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DELETE(&quot;/api/pa/stop_mic&quot;)</span></span><br><span class="line">-    suspend fun <span class="title function_">stopMic</span><span class="params">()</span>: ApiResp&lt;StopMicRespData&gt;</span><br><span class="line">+    suspend fun <span class="title function_">stopMic</span><span class="params">(<span class="meta">@Body</span> body: RequestBody)</span>: StopMicRespData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>14：54，调用停止广播stopMic的时候随便传递一个参数。</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_stop_mic_failure_2022-10-12_145519.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_main.mvvm.viewmodel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainViewModel</span>(application: Application) : BaseViewModel(application) &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 撤销呼叫站广播</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/07/28 17:18</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    fun <span class="title function_">paStopMic</span><span class="params">()</span> &#123;</span><br><span class="line">        viewModelScope.launch(Dispatchers.IO) &#123;</span><br><span class="line">            <span class="type">val</span> <span class="variable">appIDDeferred</span> <span class="operator">=</span> async &#123;</span><br><span class="line">                PaRepository.getInstance().getAppID()</span><br><span class="line">            &#125;</span><br><span class="line">            appIDDeferred.await()</span><br><span class="line"></span><br><span class="line">            <span class="type">val</span> <span class="variable">appTokenDeferred</span> <span class="operator">=</span> async &#123;</span><br><span class="line">                PaRepository.getInstance().getToken()</span><br><span class="line">            &#125;</span><br><span class="line">            appTokenDeferred.await()</span><br><span class="line"></span><br><span class="line">            <span class="type">val</span> <span class="variable">stopMicDeferred</span> <span class="operator">=</span> async &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">+                    <span class="comment">// 随便传递一个参数                    </span></span><br><span class="line">+                    <span class="type">var</span> <span class="variable">mZoneIDs</span> <span class="operator">=</span> mutableListOf&lt;Int&gt;()</span><br><span class="line">+                    <span class="type">val</span> <span class="variable">param</span> <span class="operator">=</span> HttpManager.INSTANCE.getJsonBody(mapOf(<span class="string">&quot;zone_ids&quot;</span> to mZoneIDs))</span><br><span class="line">-                    <span class="type">val</span> <span class="variable">result</span> <span class="operator">=</span> HttpManager.INSTANCE.mApi.stopMic().result</span><br><span class="line">+                    <span class="type">val</span> <span class="variable">result</span> <span class="operator">=</span> HttpManager.INSTANCE.mApi.stopMic(param)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (result!!.result) &#123;</span><br><span class="line">                        <span class="comment">// 如果为true，则撤销成功</span></span><br><span class="line">                        LogUtils.getInstance().i(TAG, <span class="string">&quot;stopMic() success - result=$result&quot;</span>)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 撤销失败</span></span><br><span class="line">                        LogUtils.getInstance().e(TAG, <span class="string">&quot;stopMic() failure - reason=$&#123;result.reason&#125;&quot;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e: NoRouteToHostException) &#123;</span><br><span class="line">                    e.printStackTrace()</span><br><span class="line">                    LogUtils.getInstance()</span><br><span class="line">                        .e(TAG, <span class="string">&quot;stopMic() NoRouteToHostException - e=$&#123;e.message&#125;&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                    e.printStackTrace()</span><br><span class="line">                    LogUtils.getInstance().e(TAG, <span class="string">&quot;stopMic() Exception - e=$&#123;e.message&#125;&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    Common.prepareBroadcastCallStop()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            stopMicDeferred.await()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发版本到产品四部群里FX400-APK-3.0.1-V1.1.9–release-20221012.apk</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">10-12 15:34:41.522 10359 10456 W System.err: java.lang.IllegalArgumentException: Non-body HTTP method cannot contain @Body.</span><br><span class="line">10-12 15:34:41.522 10359 10456 W System.err:     for method PaApiService.stopMic</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.Utils.methodError(Utils.java:54)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.Utils.methodError(Utils.java:43)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.RequestFactory$Builder.build(RequestFactory.java:213)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.RequestFactory.parseAnnotations(RequestFactory.java:67)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.ServiceMethod.parseAnnotations(ServiceMethod.java:26)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.Retrofit.loadServiceMethod(Retrofit.java:202)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.Retrofit$1.invoke(Retrofit.java:160)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at java.lang.reflect.Proxy.invoke(Proxy.java:813)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at $Proxy2.stopMic(Unknown Source)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at com.gbcom.library_main.mvvm.viewmodel.MainViewModel$paStopMic$1$stopMicDeferred$1.invokeSuspend(MainViewModel.kt:604)</span><br><span class="line">10-12 15:34:41.523 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=31</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at kotlinx.coroutines.DispatchedTask.run(DispatchedTask.kt:106)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:571)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.executeTask(CoroutineScheduler.kt:750)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.runWorker(CoroutineScheduler.kt:678)</span><br><span class="line">10-12 15:34:41.523 10359 10456 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:665)</span><br><span class="line">10-12 15:34:41.524 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-12, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-12 15:34:41.524 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 15:34:41.524 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 15:34:41.524 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: 3getCurrentFileName: logFileName=app31.log</span><br><span class="line">10-12 15:34:41.525 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: 1getCurrentFileName: LogWriteUtil.logfile=app.log</span><br><span class="line">10-12 15:34:41.525 10359 10456 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] stopMic() Exception - e=Non-body HTTP method cannot contain @Body.</span><br><span class="line">10-12 15:34:41.525 10359 10456 E APP_LogUtils.kt:     for method PaApiService.stopMic</span><br></pre></td></tr></table></figure>

<p>16:19,终端<a href="./file/wzs2_station_bro_app_log_stopmic_param_errro_pa10_20221012.log">PA10.log</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">10-12 15:56:43.784 11295 11383 W System.err: java.lang.IllegalArgumentException: Non-body HTTP method cannot contain @Body.</span><br><span class="line">10-12 15:56:43.784 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err:     for method PaApiService.stopMic</span><br><span class="line">10-12 15:56:43.784 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.Utils.methodError(Utils.java:54)</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.Utils.methodError(Utils.java:43)</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.RequestFactory$Builder.build(RequestFactory.java:213)</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.RequestFactory.parseAnnotations(RequestFactory.java:67)</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.ServiceMethod.parseAnnotations(ServiceMethod.java:26)</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.Retrofit.loadServiceMethod(Retrofit.java:202)</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.Retrofit$1.invoke(Retrofit.java:160)</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at java.lang.reflect.Proxy.invoke(Proxy.java:813)</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at $Proxy2.stopMic(Unknown Source)</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at com.gbcom.library_main.mvvm.viewmodel.MainViewModel$paStopMic$1$stopMicDeferred$1.invokeSuspend(MainViewModel.kt:605)</span><br><span class="line">10-12 15:56:43.784 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=33</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)</span><br><span class="line">10-12 15:56:43.784 11295 11383 W System.err: 	at kotlinx.coroutines.DispatchedTask.run(DispatchedTask.kt:106)</span><br><span class="line">10-12 15:56:43.785 11295 11383 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:571)</span><br><span class="line">10-12 15:56:43.785 11295 11383 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.executeTask(CoroutineScheduler.kt:750)</span><br><span class="line">10-12 15:56:43.785 11295 11383 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.runWorker(CoroutineScheduler.kt:678)</span><br><span class="line">10-12 15:56:43.785 11295 11383 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:665)</span><br><span class="line">10-12 15:56:43.785 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-12, LogWriteUtil.logPathDir=/custom/metro/log</span><br><span class="line">10-12 15:56:43.785 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 15:56:43.785 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12</span><br><span class="line">10-12 15:56:43.785 11295 11383 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] stopMic() Exception - e=Non-body HTTP method cannot contain @Body.</span><br><span class="line">10-12 15:56:43.785 11295 11383 E APP_LogUtils.kt:     for method PaApiService.stopMic</span><br></pre></td></tr></table></figure>

<p>修改DELETE请求代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_base.service</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 站选区广播接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/07/28 14:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PaApiService</span> &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 撤销呼叫站广播</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/07/28 17:14</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">-    <span class="meta">@DELETE(&quot;/api/pa/stop_mic&quot;)</span></span><br><span class="line">+    <span class="meta">@HTTP(method = &quot;DELETE&quot;, path = &quot;/api/pa/stop_mic&quot;, hasBody = true)</span></span><br><span class="line">    suspend fun <span class="title function_">stopMic</span><span class="params">(<span class="meta">@Body</span> body: RequestBody)</span>: StopMicRespData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="./file/wzs2_station_bro_stop_mic_have_param_404_pa11_20221012_1639.log">stopmic时携带参数还是404，终端pa11.log</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">10-12 16:28:31.730 12868 12889 D LogWriteUtil.class=LogFileHandlerThread.class: 8,initFile: logFile=/custom/metro/log/2022-10-12/app35.log, logFile.length=0</span><br><span class="line">10-12 16:28:31.732 12868 12994 I Retrofit_network: --&gt; POST http://192.168.42.131:10000/api/system/gettoken</span><br><span class="line">10-12 16:28:31.732 12868 12994 D TAG     : 111111--convert: log: message=--&gt; POST http://192.168.42.131:10000/api/system/gettoken</span><br><span class="line">10-12 16:28:31.732 12868 12994 I Retrofit_network: Content-Type: application/json; charset=utf-8</span><br><span class="line">10-12 16:28:31.733 12868 12994 D TAG     : 111111--convert: log: message=Content-Type: application/json; charset=utf-8</span><br><span class="line">10-12 16:28:31.733 12868 12994 I Retrofit_network: Content-Length: 65</span><br><span class="line">10-12 16:28:31.733 12868 12994 D TAG     : 111111--convert: log: message=Content-Length: 65</span><br><span class="line">10-12 16:28:31.733 12868 12994 I Retrofit_network: </span><br><span class="line">10-12 16:28:31.733 12868 12994 D TAG     : 111111--convert: log: message=</span><br><span class="line">10-12 16:28:31.733 12868 12994 I Retrofit_network: &#123;&quot;appid&quot;:&quot;ef08e274512c41d885a755edc7870e9d&quot;,&quot;timeKey&quot;:1665563311&#125;</span><br><span class="line">10-12 16:28:31.733 12868 12994 D TAG     : 111111--convert: log: message=&#123;&quot;appid&quot;:&quot;ef08e274512c41d885a755edc7870e9d&quot;,&quot;timeKey&quot;:1665563311&#125;</span><br><span class="line">10-12 16:28:31.733 12868 12994 I Retrofit_network: --&gt; END POST (65-byte body)</span><br><span class="line">10-12 16:28:31.733 12868 12994 D TAG     : 111111--convert: log: message=--&gt; END POST (65-byte body)</span><br><span class="line">10-12 16:28:31.736   613 13093 D soundtrigger: audio_extn_sound_trigger_update_stream_status: uc_id 16 of type 1 for Event 2, with Raise=0</span><br><span class="line">10-12 16:28:31.736   613 13093 D hardware_info: hw_info_append_hw_type : device_name = headset-mic</span><br><span class="line">10-12 16:28:31.736   613 13093 D audio_hw_primary: disable_snd_device: snd_device(63: headset-mic)</span><br><span class="line">10-12 16:28:31.736   613 13093 D msm8916_platform: platform_can_split_snd_device: snd_device(63) num devices(0) new_snd_devices(0)</span><br><span class="line">10-12 16:28:31.742 12868 12868 D train_jni_log: jni---setGpioStatus----devpath:/sys/class/gpio/gpio2/value, status:1, iRet:0, cmdStr:echo 1 &gt; /sys/class/gpio/gpio2/value.</span><br><span class="line">10-12 16:28:31.743 12868 12868 D AudioManagerUtils: setSpeakerStatus: aaaaaaaaaa</span><br><span class="line">10-12 16:28:31.744   613   613 D AudioPolicyManagerCustom: setForceUse() usage 0, config 1, mPhoneState 3</span><br><span class="line">10-12 16:28:31.746 12868 12994 D TAG     : intercept: startmic: tokentoken=ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzI0OQ==</span><br><span class="line">10-12 16:28:31.755   613 13093 I soundtrigger: audio_extn_sound_trigger_update_device_status: device 0x3f of type 1 for Event 0, with Raise=1</span><br><span class="line">10-12 16:28:31.755   613  1053 D audio_hw_primary: out_set_parameters: enter: usecase(0: deep-buffer-playback) kvpairs: routing=2</span><br><span class="line">10-12 16:28:31.755   613 13093 D sound_trigger_platform: platform_stdev_check_and_update_concurrency: concurrency active 0, tx 0, rx 0, concurrency session_allowed 1</span><br><span class="line">10-12 16:28:31.756 12868 12994 I Retrofit_network: &lt;-- 200 OK http://192.168.42.131:10000/api/system/gettoken (22ms)</span><br><span class="line">10-12 16:28:31.756 12868 12994 D TAG     : 111111--convert: log: message=&lt;-- 200 OK http://192.168.42.131:10000/api/system/gettoken (22ms)</span><br><span class="line">10-12 16:28:31.756 12868 12994 I Retrofit_network: Content-Length: 117</span><br><span class="line">10-12 16:28:31.756 12868 12994 D TAG     : 111111--convert: log: message=Content-Length: 117</span><br><span class="line">10-12 16:28:31.756 12868 12994 I Retrofit_network: Content-Type: text/plain</span><br><span class="line">10-12 16:28:31.757 12868 12994 D TAG     : 111111--convert: log: message=Content-Type: text/plain</span><br><span class="line">10-12 16:28:31.757 12868 12994 I Retrofit_network: Keep-Alive: timeout=5, max=5</span><br><span class="line">10-12 16:28:31.757 12868 12994 D TAG     : 111111--convert: log: message=Keep-Alive: timeout=5, max=5</span><br><span class="line">10-12 16:28:31.758 12868 12994 I Retrofit_network: </span><br><span class="line">10-12 16:28:31.758 12868 12994 D TAG     : 111111--convert: log: message=</span><br><span class="line">10-12 16:28:31.758 12868 12994 I Retrofit_network: &#123;&quot;code&quot;:200,&quot;message&quot;:&quot;成功&quot;,&quot;success&quot;:true,&quot;token&quot;:&quot;ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==&quot;&#125;</span><br><span class="line">10-12 16:28:31.758 12868 12994 D TAG     : 111111--convert: log: message=&#123;&quot;code&quot;:200,&quot;message&quot;:&quot;成功&quot;,&quot;success&quot;:true,&quot;token&quot;:&quot;ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==&quot;&#125;</span><br><span class="line">10-12 16:28:31.759 12868 12994 I Retrofit_network: &lt;-- END HTTP (117-byte body)</span><br><span class="line">10-12 16:28:31.759 12868 12994 D TAG     : 111111--convert: log: message=&lt;-- END HTTP (117-byte body)</span><br><span class="line">10-12 16:28:31.760 12868 12994 D TAG     : 22222222222222222222convert: response=&#123;&quot;code&quot;:200,&quot;message&quot;:&quot;成功&quot;,&quot;success&quot;:true,&quot;token&quot;:&quot;ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==&quot;&#125;</span><br><span class="line">10-12 16:28:31.761 12868 12994 D TAG     : 122222222222222222222convert: response=&#123;&quot;code&quot;:200,&quot;message&quot;:&quot;成功&quot;,&quot;success&quot;:true,&quot;token&quot;:&quot;ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==&quot;&#125;</span><br><span class="line">10-12 16:28:31.762 12868 12994 D TAG     : 322222222222222222222convert:  jsonReader=JsonReader at line 1 column 1 path $, PaTokenRespData(success=true, code=200, message=成功, token=ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==)</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: java.lang.IllegalStateException: closed</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: 	at okio.RealBufferedSource.select(RealBufferedSource.kt:83)</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: 	at okhttp3.internal.Util.readBomAsCharset(Util.kt:256)</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: 	at okhttp3.ResponseBody.string(ResponseBody.kt:187)</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:53)</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:16)</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: 	at retrofit2.OkHttpCall.parseResponse(OkHttpCall.java:243)</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:153)</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)</span><br><span class="line">10-12 16:28:31.763 12868 12994 W System.err: 	at java.lang.Thread.run(Thread.java:761)</span><br><span class="line">10-12 16:28:31.767 12868 12963 D TAG     : getJsonBody: data=&#123;zone_ids=[1]&#125;</span><br><span class="line">10-12 16:28:31.775   613  1049 D audio_hw_primary: out_set_parameters: enter: usecase(12: audio-ull-playback) kvpairs: routing=2</span><br><span class="line">10-12 16:28:31.775 12868 12994 I Retrofit_network: --&gt; DELETE http://192.168.42.131:10000/api/pa/stop_mic</span><br><span class="line">10-12 16:28:31.775 12868 12994 D TAG     : 111111--convert: log: message=--&gt; DELETE http://192.168.42.131:10000/api/pa/stop_mic</span><br><span class="line">10-12 16:28:31.775 12868 12994 I Retrofit_network: Content-Type: application/json; charset=utf-8</span><br><span class="line">10-12 16:28:31.775 12868 12994 D TAG     : 111111--convert: log: message=Content-Type: application/json; charset=utf-8</span><br><span class="line">10-12 16:28:31.775 12868 12994 I Retrofit_network: Content-Length: 16</span><br><span class="line">10-12 16:28:31.775 12868 12994 D TAG     : 111111--convert: log: message=Content-Length: 16</span><br><span class="line">10-12 16:28:31.776 12868 12994 I Retrofit_network: </span><br><span class="line">10-12 16:28:31.776 12868 12994 D TAG     : 111111--convert: log: message=</span><br><span class="line">10-12 16:28:31.776 12868 12994 I Retrofit_network: &#123;&quot;zone_ids&quot;:[1]&#125;</span><br><span class="line">10-12 16:28:31.776 12868 12994 D TAG     : 111111--convert: log: message=&#123;&quot;zone_ids&quot;:[1]&#125;</span><br><span class="line">10-12 16:28:31.776 12868 12994 I Retrofit_network: --&gt; END DELETE (16-byte body)</span><br><span class="line">10-12 16:28:31.776 12868 12994 D TAG     : 111111--convert: log: message=--&gt; END DELETE (16-byte body)</span><br><span class="line">10-12 16:28:31.784 12868 12994 D TAG     : intercept: startmic: tokentoken=ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==</span><br><span class="line">10-12 16:28:31.792 12868 12994 I Retrofit_network: &lt;-- 404 Not Found http://192.168.42.131:10000/api/pa/stop_mic (15ms)</span><br><span class="line">10-12 16:28:31.792 12868 12994 D TAG     : 111111--convert: log: message=&lt;-- 404 Not Found http://192.168.42.131:10000/api/pa/stop_mic (15ms)</span><br><span class="line">10-12 16:28:31.793 12868 12994 I Retrofit_network: Content-Length: 0</span><br><span class="line">10-12 16:28:31.793 12868 12994 D TAG     : 111111--convert: log: message=Content-Length: 0</span><br><span class="line">10-12 16:28:31.793 12868 12994 I Retrofit_network: Keep-Alive: timeout=5, max=5</span><br><span class="line">10-12 16:28:31.793 12868 12994 D TAG     : 111111--convert: log: message=Keep-Alive: timeout=5, max=5</span><br><span class="line">10-12 16:28:31.793 12868 12994 I Retrofit_network: &lt;-- END HTTP (0-byte body)</span><br><span class="line">10-12 16:28:31.793 12868 12994 D TAG     : 111111--convert: log: message=&lt;-- END HTTP (0-byte body)</span><br><span class="line">10-12 16:28:31.794 12868 12963 W System.err: retrofit2.HttpException: HTTP 404 Not Found</span><br><span class="line">10-12 16:28:31.795 12868 12963 W System.err: 	at retrofit2.KotlinExtensions$await$2$2.onResponse(KotlinExtensions.kt:53)</span><br><span class="line">10-12 16:28:31.795 12868 12963 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:161)</span><br><span class="line">10-12 16:28:31.795 12868 12963 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)</span><br><span class="line">10-12 16:28:31.795 12868 12963 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)</span><br><span class="line">10-12 16:28:31.795 12868 12963 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)</span><br><span class="line">10-12 16:28:31.795 12868 12963 W System.err: 	at java.lang.Thread.run(Thread.java:761)</span><br><span class="line">10-12 16:28:31.783 12889 12889 I LogFile : type=1400 audit(0.0:358): avc: denied &#123; getattr &#125; for path=&quot;/custom/metro/log/2022-10-12&quot; dev=&quot;mmcblk0p51&quot; ino=82019 scontext=u:r:system_app:s0 tcontext=u:object_r:unlabeled:s0 tclass=dir permissive=1</span><br><span class="line">10-12 16:28:31.783 12889 12889 I LogFile : type=1400 audit(0.0:359): avc: denied &#123; read &#125; for name=&quot;2022-10-12&quot; dev=&quot;mmcblk0p51&quot; ino=82019 scontext=u:r:system_app:s0 tcontext=u:object_r:unlabeled:s0 tclass=dir permissive=1</span><br><span class="line">10-12 16:28:31.783 12889 12889 I LogFile : type=1400 audit(0.0:360): avc: denied &#123; open &#125; for path=&quot;/custom/metro/log/2022-10-12&quot; dev=&quot;mmcblk0p51&quot; ino=82019 scontext=u:r:system_app:s0 tcontext=u:object_r:unlabeled:s0 tclass=dir permissive=1</span><br><span class="line">10-12 16:28:31.795 12868 12963 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] stopMic() Exception - e=HTTP 404 Not Found</span><br></pre></td></tr></table></figure>

<p>16：35，stopmic时携带参数还是404，<a href="./file/wzs2_station_bro_stopmic_have_param_error_master_pa11eth1_20221012_1632.pcap">wzs2_station_bro_stopmic_have_param_error_master_pa11eth1_20221012_1632.pcap</a></p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_staton_bro_stop_mic_have_param_404_2022-10-12_163416.png" alt="stopmic时携带参数还是404"></p>
<p>16:45，stopmic时携带参数也报404，对方微信说用的是post，要改成delete</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_stopmic_have_param_404_2022-10-12_164407.png" alt="stopmic时携带参数也报404，对方微信说用的是post，要改成delete"></p>
<p>对方说不用传参，那么APP中的stopMic方法还需要恢复到之前，同时对方研发还说广播接口服务器用错了方法，应该用DELETE方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gbcom.library_base.service</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 站选区广播接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/07/28 14:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PaApiService</span> &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 撤销呼叫站广播</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/07/28 17:14</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">+    <span class="meta">@DELETE(&quot;/api/pa/stop_mic&quot;)</span></span><br><span class="line">-    <span class="meta">@HTTP(method = &quot;DELETE&quot;, path = &quot;/api/pa/stop_mic&quot;, hasBody = true)</span></span><br><span class="line">-    suspend fun <span class="title function_">stopMic</span><span class="params">(<span class="meta">@Body</span> body: RequestBody)</span>: StopMicRespData</span><br><span class="line">+    suspend fun <span class="title function_">stopMic</span><span class="params">()</span>: StopMicRespData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.gbcom.library_main.mvvm.viewmodel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainViewModel</span>(application: Application) : BaseViewModel(application) &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 撤销呼叫站广播</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> daizelai@gbcom.com.cn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/07/28 17:18</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    fun <span class="title function_">paStopMic</span><span class="params">()</span> &#123;</span><br><span class="line">        viewModelScope.launch(Dispatchers.IO) &#123;</span><br><span class="line">            <span class="type">val</span> <span class="variable">appIDDeferred</span> <span class="operator">=</span> async &#123;</span><br><span class="line">                PaRepository.getInstance().getAppID()</span><br><span class="line">            &#125;</span><br><span class="line">            appIDDeferred.await()</span><br><span class="line"></span><br><span class="line">            <span class="type">val</span> <span class="variable">appTokenDeferred</span> <span class="operator">=</span> async &#123;</span><br><span class="line">                PaRepository.getInstance().getToken()</span><br><span class="line">            &#125;</span><br><span class="line">            appTokenDeferred.await()</span><br><span class="line"></span><br><span class="line">            <span class="type">val</span> <span class="variable">stopMicDeferred</span> <span class="operator">=</span> async &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">-                    <span class="comment">// 随便传递一个参数</span></span><br><span class="line">-                    <span class="type">var</span> <span class="variable">mZoneIDs</span> <span class="operator">=</span> mutableListOf&lt;Int&gt;()</span><br><span class="line">-                    mZoneIDs.add(<span class="number">1</span>)</span><br><span class="line">-                    <span class="type">val</span> <span class="variable">param</span> <span class="operator">=</span> HttpManager.INSTANCE.getJsonBody(mapOf(<span class="string">&quot;zone_ids&quot;</span> to mZoneIDs))</span><br><span class="line">-                    <span class="type">val</span> <span class="variable">result</span> <span class="operator">=</span> HttpManager.INSTANCE.mApi.stopMic(param)</span><br><span class="line">+                    <span class="type">val</span> <span class="variable">result</span> <span class="operator">=</span> HttpManager.INSTANCE.mApi.stopMic()</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (result!!.result) &#123;</span><br><span class="line">                        <span class="comment">// 如果为true，则撤销成功</span></span><br><span class="line">                        LogUtils.getInstance().i(TAG, <span class="string">&quot;stopMic() success - result=$result&quot;</span>)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 撤销失败</span></span><br><span class="line">                        LogUtils.getInstance().e(TAG, <span class="string">&quot;stopMic() failure - reason=$&#123;result.reason&#125;&quot;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e: NoRouteToHostException) &#123;</span><br><span class="line">                    e.printStackTrace()</span><br><span class="line">                    LogUtils.getInstance()</span><br><span class="line">                        .e(TAG, <span class="string">&quot;stopMic() NoRouteToHostException - e=$&#123;e.message&#125;&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                    e.printStackTrace()</span><br><span class="line">                    LogUtils.getInstance().e(TAG, <span class="string">&quot;stopMic() Exception - e=$&#123;e.message&#125;&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    Common.prepareBroadcastCallStop()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            stopMicDeferred.await()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-5-6-广播发起和结束正常"><a href="#5-5-6-广播发起和结束正常" class="headerlink" title="5.5.6.广播发起和结束正常"></a>5.5.6.广播发起和结束正常</h4><p>17：09，发起广播和停止广播都正常了</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_stopmic_success_2022-10-12_170856.png" alt="17：09，发起广播和停止广播都正常了"></p>
<p>发起广播和停止广播都正常了</p>
<p><a href="./file/wzs2_station_bro_start_stop_mic_success_master_pa12eth1_20221012_1711.pcap">主机pa12eth1(1).pcap</a></p>
<p>17:15，温州S2号线v1.2.3版本，发起广播的区域不是写死的1了，发产品四部群里了。</p>
<p>17：19，下面是本次的测试结果，测试站区广播功能OK，包括发起广播时的区域ID也是动态从DIS获取的，传给广播服务器也是正常的。</p>
<p><a href="./file/wzs2_station_bro_zone_ok_master_pa13eth1_20221012_1719.pcap">主机区域pa13eth1.pcap</a></p>
<p><a href="./file/wzs2_station_bro_zone_ok_app_pa13_20221012_1721.log">终端pa13.log</a></p>
<h3 id="5-6-温州S2号线车站站选区广播20221013对接调试"><a href="#5-6-温州S2号线车站站选区广播20221013对接调试" class="headerlink" title="5.6.温州S2号线车站站选区广播20221013对接调试"></a>5.6.温州S2号线车站站选区广播20221013对接调试</h3><p>今天温州现场蒋富强说，温州现场测试站选区广播功能正常</p>
<p><img src="/2022/10/10/wzs2/20221010_1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/images/wzs2_station_bro_success_2022-10-13_133730.png" alt="测试站选区广播功能正常"></p>

    </div>

    <div>全文完。</div>
  </article>
  <div class="toc-container">
    
  <div id="toc" class="toc-article">
    <strong class="toc-title">目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#20221010-1750%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95"><span class="toc-text">20221010_1750温州S2号线固定台站选区广播调试记录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%8F%8F%E8%BF%B0"><span class="toc-text">一、描述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%89%8D%E8%A8%80"><span class="toc-text">1.1.前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%AF%B9%E6%8E%A5%E6%96%87%E6%A1%A3"><span class="toc-text">1.2.对接文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95"><span class="toc-text">1.3.调试记录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%B9%BF%E6%92%AD%E7%8E%AF%E5%A2%83"><span class="toc-text">二、实验室广播环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%90%84%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83"><span class="toc-text">2.1.各服务环境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%AB%99%E5%8C%BA%E5%B9%BF%E6%92%AD%E9%85%8D%E7%BD%AE"><span class="toc-text">三、站区广播配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E8%B0%83%E5%BA%A6%E9%85%8D%E7%BD%AE"><span class="toc-text">3.1.调度配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%9B%BA%E5%AE%9A%E5%8F%B0%E9%85%8D%E7%BD%AE"><span class="toc-text">3.2.固定台配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%9B%BA%E5%AE%9A%E5%8F%B0%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="toc-text">3.3.固定台主机配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E7%8E%B0%E5%9C%BA%E8%B0%83%E8%AF%95"><span class="toc-text">四、站选区广播现场调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E7%82%B9%E5%90%8D%E7%A7%B0%E9%97%AE%E9%A2%98"><span class="toc-text">4.1.固定台站点名称问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%9B%BA%E5%AE%9A%E5%8F%B0%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE%E5%B9%BF%E6%92%AD%E6%A8%A1%E6%8B%9F%E5%99%A8%E6%8E%A5%E5%8F%A3"><span class="toc-text">4.2.固定台浏览器访问广播模拟器接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E7%8E%B0%E5%9C%BA%E5%AF%B9%E6%8E%A5%E8%B0%83%E8%AF%95"><span class="toc-text">五、站选区广播现场对接调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%AE%9E%E9%AA%8C%E5%AE%A4%E7%AB%99%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E4%B9%8B-86%E9%97%AE%E9%A2%98"><span class="toc-text">5.1.实验室站区广播调试之+86问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%AB%99%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E4%B9%8B%E7%AB%AF%E5%8F%A3%E9%97%AE%E9%A2%98"><span class="toc-text">5.2.站区广播调试之端口问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E7%AB%99%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E4%B9%8BTCP%E6%8E%A5%E5%8F%A3%E5%88%9D%E6%AD%A5%E6%AD%A3%E5%B8%B8"><span class="toc-text">5.3.站区广播调试之TCP接口初步正常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E7%AB%99%E5%8C%BA%E5%B9%BF%E6%92%AD%E5%AF%B9%E6%8E%A5%E4%B9%8B%E6%96%B0%E7%AB%99%E8%B0%83%E8%AF%95"><span class="toc-text">5.4.站区广播对接之新站调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E8%BD%A6%E7%AB%99%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD20221012%E5%AF%B9%E6%8E%A5%E8%B0%83%E8%AF%95"><span class="toc-text">5.5.温州S2号线车站站选区广播20221012对接调试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-1-%E9%A6%96%E6%AC%A1%E8%B0%83%E8%AF%95%E6%B2%A1%E6%9C%89%E8%AE%BF%E9%97%AE%E6%B8%A9%E5%B7%9ES2%E5%B9%BF%E6%92%AD%E6%8E%A5%E5%8F%A3%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">5.5.1.首次调试没有访问温州S2广播接口的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-2-%E5%B9%BF%E6%92%AD%E5%8C%BA%E5%9F%9FID%E9%97%AE%E9%A2%98"><span class="toc-text">5.5.2.广播区域ID问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-3-%E6%B2%A1%E6%9C%89stopMic%E9%97%AE%E9%A2%98"><span class="toc-text">5.5.3.没有stopMic问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-4-%E5%B9%BF%E6%92%AD%E5%8C%BA%E5%9F%9F%E5%88%97%E8%A1%A8%E9%94%99%E8%AF%AF"><span class="toc-text">5.5.4.广播区域列表错误</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-5-%E5%B9%BF%E6%92%AD%E5%81%9C%E6%AD%A2%E4%B8%8D%E4%BA%86%E7%BB%A7%E7%BB%AD"><span class="toc-text">5.5.5.广播停止不了继续</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-6-%E5%B9%BF%E6%92%AD%E5%8F%91%E8%B5%B7%E5%92%8C%E7%BB%93%E6%9D%9F%E6%AD%A3%E5%B8%B8"><span class="toc-text">5.5.6.广播发起和结束正常</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-%E6%B8%A9%E5%B7%9ES2%E5%8F%B7%E7%BA%BF%E8%BD%A6%E7%AB%99%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD20221013%E5%AF%B9%E6%8E%A5%E8%B0%83%E8%AF%95"><span class="toc-text">5.6.温州S2号线车站站选区广播20221013对接调试</span></a></li></ol></li></ol></li></ol>
  </div>


  </div>
</div>
<div class="copyright">
    <span>本作品采用</span>
    <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0 国际许可协议</a>
    <span>进行许可。 转载时请注明原文链接。</span>
</div>
<div class="share" style="width: 100%;">
  <img src="/static/qrcode/qrcode_wwwitcsscn_20221008_0909.png" alt="Running Geek" style="margin: auto; display: block;"/>

  <div style="margin: auto; text-align: center; font-size: 0.8em; color: grey;">老铁们关注走一走，不迷路</div>
  
</div>

  
    <div class="post-nav">
      <div class="post-nav-item post-nav-next">
        
          <span>〈 </span>
          <a href="/2022/10/08/mysql/20221008_1513mysql%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7/" rel="next" title="mysql创建用户">
          mysql创建用户
          </a>
        
      </div>
  
      <div class="post-nav-item post-nav-prev">
          
          <a href="/2022/10/16/linux/20221016_1619ssh%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95/" rel="prev" title="ssh免密码登录">
            ssh免密码登录
          </a>
          <span>〉</span>
        
      </div>
    </div>
  


    </div>

    

  </div>
  <footer class="footer text-center">
    <div id="bottom-inner">
        <a class="bottom-item" target="_blank" rel="noopener" href="https://www.itcss.cn">首页</a> |
        <a class="bottom-item" href="https://www.itcss.cn" target="_blank">主站</a> |
        <a class="bottom-item" href="https://github.com/itcss" target="_blank">GitHub</a> |
        <a class="bottom-item" href="https://hexo.io" target="_blank">Powered by hexo</a> |
        <a class="bottom-item" href="https://github.com/KevinOfNeu/hexo-theme-xoxo" target="_blank">Theme xoxo</a>
    </div>
</footer>
  

<script>
  (function(window, document, undefined) {

    var timer = null;

    function returnTop() {
      cancelAnimationFrame(timer);
      timer = requestAnimationFrame(function fn() {
        var oTop = document.body.scrollTop || document.documentElement.scrollTop;
        if (oTop > 0) {
          document.body.scrollTop = document.documentElement.scrollTop = oTop - 50;
          timer = requestAnimationFrame(fn);
        } else {
          cancelAnimationFrame(timer);
        }
      });
    }

    var hearts = [];
    window.requestAnimationFrame = (function() {
      return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function(callback) {
          setTimeout(callback, 1000 / 60);
        }
    })();
    init();

    function init() {
      css(".heart{z-index:9999;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}");
      attachEvent();
      gameloop();
      addMenuEvent();
    }

    function gameloop() {
      for (var i = 0; i < hearts.length; i++) {
        if (hearts[i].alpha <= 0) {
          document.body.removeChild(hearts[i].el);
          hearts.splice(i, 1);
          continue;
        }
        hearts[i].y--;
        hearts[i].scale += 0.004;
        hearts[i].alpha -= 0.013;
        hearts[i].el.style.cssText = "left:" + hearts[i].x + "px;top:" + hearts[i].y + "px;opacity:" + hearts[i].alpha + ";transform:scale(" + hearts[i].scale + "," + hearts[i].scale + ") rotate(45deg);background:" + hearts[i].color;
      }
      requestAnimationFrame(gameloop);
    }

    /**
     * 给logo设置点击事件
     * 
     * - 回到顶部
     * - 出现爱心
     */
    function attachEvent() {
      var old = typeof window.onclick === "function" && window.onclick;
      var logo = document.getElementById("logo");
      if (logo) {
        logo.onclick = function(event) {
          returnTop();
          old && old();
          createHeart(event);
        }
      }
      
    }

    function createHeart(event) {
      var d = document.createElement("div");
      d.className = "heart";
      hearts.push({
        el: d,
        x: event.clientX - 5,
        y: event.clientY - 5,
        scale: 1,
        alpha: 1,
        color: randomColor()
      });
      document.body.appendChild(d);
    }

    function css(css) {
      var style = document.createElement("style");
      style.type = "text/css";
      try {
        style.appendChild(document.createTextNode(css));
      } catch (ex) {
        style.styleSheet.cssText = css;
      }
      document.getElementsByTagName('head')[0].appendChild(style);
    }

    function randomColor() {
      // return "rgb(" + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + ")";
      return "#F44336";
    }

    function addMenuEvent() {
      var menu = document.getElementById('menu-main-post');
      if (menu) {
        var toc = document.getElementById('toc');
        if (toc) {
          menu.onclick = function() {
            if (toc) {
              if (toc.style.display == 'block') {
                toc.style.display = 'none';
              } else {
                toc.style.display = 'block';
              }
            }
          };
        } else {
          menu.style.display = 'none';
        }
      }
    }

  })(window, document);
</script>

  



</body>
</html>
