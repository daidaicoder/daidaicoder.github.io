<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>android中XLog框架的使用 - 来来往往</title><meta name="author" content="">
<meta name="author-link" content="">
<meta name="description" content="android中XLog框架的使用" /><meta name="keywords" content='日志, 原创, android, 日志框架' /><meta itemprop="name" content="android中XLog框架的使用">
<meta itemprop="description" content="android中XLog框架的使用"><meta itemprop="datePublished" content="2023-11-30T16:31:00+08:00" />
<meta itemprop="dateModified" content="2023-11-30T16:31:00+08:00" />
<meta itemprop="wordCount" content="3365">
<meta itemprop="keywords" content="原创,android,app开发,日志框架," /><meta property="og:title" content="android中XLog框架的使用" />
<meta property="og:description" content="android中XLog框架的使用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://daizelai.github.io/posts/android/20231130_1631%E6%AD%A6%E6%B1%8919%E5%8F%B7%E7%BA%BF%E4%BD%BF%E7%94%A8%E6%96%B0%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/20231130_1631%E6%AD%A6%E6%B1%8919%E5%8F%B7%E7%BA%BF%E4%BD%BF%E7%94%A8%E6%96%B0%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-30T16:31:00+08:00" />
<meta property="article:modified_time" content="2023-11-30T16:31:00+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="android中XLog框架的使用"/>
<meta name="twitter:description" content="android中XLog框架的使用"/>
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://daizelai.github.io/posts/android/20231130_1631%E6%AD%A6%E6%B1%8919%E5%8F%B7%E7%BA%BF%E4%BD%BF%E7%94%A8%E6%96%B0%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/20231130_1631%E6%AD%A6%E6%B1%8919%E5%8F%B7%E7%BA%BF%E4%BD%BF%E7%94%A8%E6%96%B0%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/" /><link rel="prev" href="https://daizelai.github.io/posts/linux/linuxgrep/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "android中XLog框架的使用",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/daizelai.github.io\/posts\/android\/20231130_1631%E6%AD%A6%E6%B1%8919%E5%8F%B7%E7%BA%BF%E4%BD%BF%E7%94%A8%E6%96%B0%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6\/20231130_1631%E6%AD%A6%E6%B1%8919%E5%8F%B7%E7%BA%BF%E4%BD%BF%E7%94%A8%E6%96%B0%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6\/"
    },"genre": "posts","keywords": "原创, android, app开发, 日志框架","wordcount":  3365 ,
    "url": "https:\/\/daizelai.github.io\/posts\/android\/20231130_1631%E6%AD%A6%E6%B1%8919%E5%8F%B7%E7%BA%BF%E4%BD%BF%E7%94%A8%E6%96%B0%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6\/20231130_1631%E6%AD%A6%E6%B1%8919%E5%8F%B7%E7%BA%BF%E4%BD%BF%E7%94%A8%E6%96%B0%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6\/","datePublished": "2023-11-30T16:31:00+08:00","dateModified": "2023-11-30T16:31:00+08:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "daizelai"
      },"description": "android中XLog框架的使用"
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="wide"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="来来往往"><img loading="lazy" src="/img/logo.png" srcset="/img/logo.png, /img/logo.png 1.5x, /img/logo.png 2x" sizes="auto" data-title="来来往往" data-alt="来来往往" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">来来往往</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 首页</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 归档</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 关于我</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="来来往往"><img loading="lazy" src="/img/logo.png" srcset="/img/logo.png, /img/logo.png 1.5x, /img/logo.png 2x" sizes="auto" data-title="/img/logo.png" data-alt="/img/logo.png" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">来来往往</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 首页</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 归档</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 关于我</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container container-reverse"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>android中XLog框架的使用</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      daizelai</span></span>
          <span class="post-category">收录于 <a href="/categories/%E5%8E%9F%E5%88%9B/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 原创</a>&ensp;<a href="/categories/android/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> android</a>&ensp;<a href="/categories/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 日志框架</a></span></div>
      <div class="post-meta-line"><span title="发布于 2023-11-30 16:31:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2023-11-30">2023-11-30</time></span>&nbsp;<span title="更新于 2023-11-30 16:31:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2023-11-30">2023-11-30</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 3365 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 16 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#一描述">一、描述</a></li>
    <li><a href="#二删除无用依赖">二、删除无用依赖</a>
      <ul>
        <li><a href="#依赖删除">依赖删除</a></li>
        <li><a href="#删除文件">删除文件</a></li>
      </ul>
    </li>
    <li><a href="#二xlog">二、XLog</a>
      <ul>
        <li><a href="#21添加依赖">2.1.添加依赖</a></li>
        <li><a href="#22自定义xlog文件名类">2.2.自定义xlog文件名类</a></li>
        <li><a href="#23自定义xlog备份类">2.3.自定义xlog备份类</a></li>
        <li><a href="#24创建xlog需要的自定义日志格式类">2.4.创建xlog需要的自定义日志格式类</a></li>
        <li><a href="#25xlog初始化">2.5.xlog初始化</a></li>
        <li><a href="#26获取日志保存目录">2.6.获取日志保存目录</a></li>
        <li><a href="#27配置常量">2.7.配置常量</a></li>
      </ul>
    </li>
    <li><a href="#三替换日志框架">三、替换日志框架</a>
      <ul>
        <li><a href="#31当前日志工具类">3.1.当前日志工具类</a></li>
        <li><a href="#32替换后的日志工具类">3.2.替换后的日志工具类</a></li>
      </ul>
    </li>
    <li><a href="#四日志文件效果">四、日志文件效果</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="一描述">一、描述</h2>
<p>怀疑武汉19号线最近出现的固定台APP异常退出到桌面是因为内存溢出，通过看日志发现回到桌面是因为大量写数据到日志文件导致的，项目中使用的写日志到文件，是我自己写的工具类，性能堪忧。</p>
<p>本文主要是把日志工具类替换为XLog日志框架，此框架之前也在此项目中使用过，现在正式启用它看看。</p>
<h2 id="二删除无用依赖">二、删除无用依赖</h2>
<h3 id="依赖删除">依赖删除</h3>
<p>删除不使用的日志依赖和一个glide依赖。</p>
<p>by daizelai on 2023/11/30 16:37</p>
<p>路径：E:\develop\WH19-MetroSystem\app\build.gradle</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gradle" data-lang="gradle"><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">// 751其它依赖
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>    implementation <span style="color:#c0f">project</span><span style="color:#555">(</span><span style="color:#c30">&#39;:binder&#39;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>    annotationProcessor <span style="color:#c0f">project</span><span style="color:#555">(</span><span style="color:#c30">&#39;:binder-compile&#39;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#c0f">project</span><span style="color:#555">(</span><span style="color:#c30">&#39;:eventlib&#39;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#c30">&#39;org.apache.mina:mina-core:2.0.19&#39;</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#c30">&#39;org.slf4j:slf4j-api:1.7.25&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>    <span style="color:#09f;font-style:italic">// 图片
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>    implementation <span style="color:#c30">&#39;com.github.bumptech.glide:glide:3.7.0&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>    <span style="color:#09f;font-style:italic">// log4j日志
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>    implementation <span style="color:#c30">&#39;log4j:log4j:1.2.17&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>    implementation <span style="color:#c30">&#39;de.mindpipe.android:android-logging-log4j:1.0.3&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>    implementation <span style="color:#c30">&#39;com.orhanobut:logger:2.2.0&#39;</span>
</span></span></code></pre></div><h3 id="删除文件">删除文件</h3>
<p>删除以下文件：</p>
<p>E:\develop\WH19-MetroSystem\app\src\main\java\com\gbcom\subwaysystem\log\Log4j.java
E:\develop\WH19-MetroSystem\app\src\main\java\com\gbcom\subwaysystem\log\Log4jConfig.java
E:\develop\WH19-MetroSystem\app\src\main\java\com\gbcom\subwaysystem\log\Logger4.java</p>
<h2 id="二xlog">二、XLog</h2>
<h3 id="21添加依赖">2.1.添加依赖</h3>
<p>by daizelai on 2023/11/30 16:47</p>
<p>路径：E:\develop\WH19-MetroSystem\app\build.gradle</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gradle" data-lang="gradle"><span style="display:flex;"><span><span style="color:#555">+</span>    implementation <span style="color:#c30">&#39;com.elvishew:xlog:1.11.0&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>CONFIGURE SUCCESSFUL in 0s
Download https://jcenter.bintray.com/com/elvishew/xlog/1.11.0/xlog-1.11.0.pom
Download https://jcenter.bintray.com/com/elvishew/xlog-libcat/1.0.0/xlog-libcat-1.0.0.pom
Download https://jcenter.bintray.com/org/aspectj/aspectjrt/1.9.5/aspectjrt-1.9.5.pom
Download https://jcenter.bintray.com/com/elvishew/xlog/1.11.0/xlog-1.11.0.aar
Download https://jcenter.bintray.com/org/aspectj/aspectjrt/1.9.5/aspectjrt-1.9.5.jar
Download https://jcenter.bintray.com/com/elvishew/xlog-libcat/1.0.0/xlog-libcat-1.0.0.aar
Download https://jcenter.bintray.com/org/aspectj/aspectjrt/1.9.5/aspectjrt-1.9.5-sources.jar
Download https://jcenter.bintray.com/com/elvishew/xlog/1.11.0/xlog-1.11.0-sources.jar
Download https://jcenter.bintray.com/com/elvishew/xlog-libcat/1.0.0/xlog-libcat-1.0.0-sources.jar
Download https://dl.google.com/dl/android/maven2/androidx/room/room-runtime/maven-metadata.xml
Download https://dl.google.com/dl/android/maven2/androidx/test/monitor/maven-metadata.xml
Download https://dl.google.com/dl/android/maven2/androidx/test/services/storage/maven-metadata.xml
</code></pre><h3 id="22自定义xlog文件名类">2.2.自定义xlog文件名类</h3>
<p>新建xlog使用到的自定义文件名类。</p>
<p>路径：D:\code\android\WH19-MetroSystem\app\src\main\java\com\gbcom\subwaysystem\log\GbcomDateFilePathGenerator.java</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.log</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">android.util.Log</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.printer.file.naming.FileNameGenerator</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.io.File</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.text.SimpleDateFormat</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.Date</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.Locale</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.TimeZone</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2023/12/01 19:16
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">GbcomDateFilePathGenerator</span> <span style="color:#069;font-weight:bold">implements</span> FileNameGenerator <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////    private String lastFileName = &#34;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////    ThreadLocal&lt;SimpleDateFormat&gt; mLocalDateFormat = new ThreadLocal&lt;SimpleDateFormat&gt;() {
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////        @Override
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////        protected SimpleDateFormat initialValue() {
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////            return new SimpleDateFormat(&#34;yyyy-MM-dd&#34;, Locale.US);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////        }
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////    };
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>    <span style="color:#09f;font-style:italic">//private SimpleDateFormat dateFormat = new SimpleDateFormat(&#34;yyyy-MM-dd&#34;, Locale.getDefault());
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">boolean</span> <span style="color:#c0f">isFileNameChangeable</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">true</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> String <span style="color:#c0f">generateFileName</span><span style="color:#555">(</span><span style="color:#078;font-weight:bold">int</span> logLevel<span style="color:#555">,</span> <span style="color:#078;font-weight:bold">long</span> timestamp<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////        Date date = new Date(timestamp);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////       //String dir = dateFormat.format(date);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////        SimpleDateFormat sdf = mLocalDateFormat.get();
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////        sdf.setTimeZone(TimeZone.getDefault());
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////        String fileName = sdf.format(new Date(timestamp));
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////        String dir = sdf.format(date);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////        lastFileName = dir + File.separator + fileName + &#34;.log&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">////        return lastFileName;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#34;train.log&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><h3 id="23自定义xlog备份类">2.3.自定义xlog备份类</h3>
<p>新建xlog使用到的自定义备份类。</p>
<p>路径：D:\code\android\WH19-MetroSystem\app\src\main\java\com\gbcom\subwaysystem\log\GbcomFileSizeBackupStrategy.java</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.log</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">android.os.HandlerThread</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">android.util.Log</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.printer.file.backup.FileSizeBackupStrategy2</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.bean.LFileList</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.constant.MainConstant</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.listeners.LOnDbFinishedListener</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.repository.FileListRepository</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.utils.CommonUtils</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.utils.MyLogger</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.utils.ZipUtils</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.io.File</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.text.SimpleDateFormat</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.Calendar</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.Date</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.Locale</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.TimeZone</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.concurrent.Executors</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.concurrent.ScheduledExecutorService</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.concurrent.TimeUnit</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2023/12/04 17:55
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">GbcomFileSizeBackupStrategy</span> <span style="color:#069;font-weight:bold">extends</span> FileSizeBackupStrategy2 <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String TAG <span style="color:#555">=</span> GbcomFileSizeBackupStrategy<span style="color:#555">.</span><span style="color:#309">class</span><span style="color:#555">.</span><span style="color:#309">getSimpleName</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 日志文件的扩展名
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> String logFileExt <span style="color:#555">=</span> <span style="color:#c30">&#34;.log&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 达到指定文件时的文件名
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> String backupFileName <span style="color:#555">=</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> ScheduledExecutorService executorService<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ThreadLocal<span style="color:#555">&lt;</span>SimpleDateFormat<span style="color:#555">&gt;</span> mLocalDateFormat <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> ThreadLocal<span style="color:#555">&lt;</span>SimpleDateFormat<span style="color:#555">&gt;()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">protected</span> SimpleDateFormat <span style="color:#c0f">initialValue</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">new</span> SimpleDateFormat<span style="color:#555">(</span><span style="color:#c30">&#34;yyyy-MM-dd-HHmmss&#34;</span><span style="color:#555">,</span> Locale<span style="color:#555">.</span><span style="color:#309">US</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ThreadLocal<span style="color:#555">&lt;</span>SimpleDateFormat<span style="color:#555">&gt;</span> mLocalDirDateFormat <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> ThreadLocal<span style="color:#555">&lt;</span>SimpleDateFormat<span style="color:#555">&gt;()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">protected</span> SimpleDateFormat <span style="color:#c0f">initialValue</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">new</span> SimpleDateFormat<span style="color:#555">(</span><span style="color:#c30">&#34;yyyy-MM-dd&#34;</span><span style="color:#555">,</span> Locale<span style="color:#555">.</span><span style="color:#309">US</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * Constructor.
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @param maxSize        the max size the file can reach
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @param maxBackupIndex the max backup index, or {@link #NO_LIMIT}, see {@link #getMaxBackupIndex()}
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#c0f">GbcomFileSizeBackupStrategy</span><span style="color:#555">(</span><span style="color:#078;font-weight:bold">long</span> maxSize<span style="color:#555">,</span> <span style="color:#078;font-weight:bold">int</span> maxBackupIndex<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">super</span><span style="color:#555">(</span>maxSize<span style="color:#555">,</span> maxBackupIndex<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">this</span><span style="color:#555">.</span><span style="color:#309">executorService</span> <span style="color:#555">=</span> Executors<span style="color:#555">.</span><span style="color:#309">newSingleThreadScheduledExecutor</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">boolean</span> <span style="color:#c0f">shouldBackup</span><span style="color:#555">(</span>File file<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#078;font-weight:bold">boolean</span> shouldBackup <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">super</span><span style="color:#555">.</span><span style="color:#309">shouldBackup</span><span style="color:#555">(</span>file<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>shouldBackup<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#09f;font-style:italic">// 备份文件名的自定义生成逻辑，例如根据文件的创建时间生成文件名
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>            backupFileName <span style="color:#555">=</span> generateBackupFileName<span style="color:#555">(</span>file<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#09f;font-style:italic">// 延迟备份操作到后台线程执行，延迟 1 秒
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span><span style="color:#069;font-weight:bold">null</span> <span style="color:#555">!=</span> executorService<span style="color:#555">){</span>
</span></span><span style="display:flex;"><span>                executorService<span style="color:#555">.</span><span style="color:#309">schedule</span><span style="color:#555">(()</span> <span style="color:#555">-&gt;</span> performBackup<span style="color:#555">(</span>file<span style="color:#555">,</span> backupFileName<span style="color:#555">),</span> <span style="color:#f60">1</span><span style="color:#555">,</span> TimeUnit<span style="color:#555">.</span><span style="color:#309">SECONDS</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;shouldBackup: executorService is null&#34;</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> shouldBackup<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//    /**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//     * 每天凌晨的时候需要备份
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//     *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//     * @param file
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//     */
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//    private boolean checkLastBackupTime(File file) {
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        // 每天执行一次备份
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        Calendar today = Calendar.getInstance();
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        today.set(Calendar.HOUR_OF_DAY, 0);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        today.set(Calendar.MINUTE, 0);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        today.set(Calendar.SECOND, 0);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        //today.set(Calendar.MILLISECOND, 0);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        Calendar lastBackup = Calendar.getInstance();
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        lastBackup.setTimeInMillis(file.lastModified());
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        Log.d(&#34;TAG&#34;, &#34;checkLastBackupTime: istime=&#34; + today.after(lastBackup)+&#34;, filefilefilefile=&#34;+file.getAbsolutePath());
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        return today.after(lastBackup);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//    }
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 生成备份日志文件的文件名
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @param file
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> String <span style="color:#c0f">generateBackupFileName</span><span style="color:#555">(</span>File file<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>        <span style="color:#09f;font-style:italic">// 自定义备份文件名的逻辑，例如根据文件的创建时间生成文件名
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        <span style="color:#078;font-weight:bold">long</span> lastModified <span style="color:#555">=</span> file<span style="color:#555">.</span><span style="color:#309">lastModified</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        SimpleDateFormat sdf <span style="color:#555">=</span> mLocalDateFormat<span style="color:#555">.</span><span style="color:#309">get</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>        sdf<span style="color:#555">.</span><span style="color:#309">setTimeZone</span><span style="color:#555">(</span>TimeZone<span style="color:#555">.</span><span style="color:#309">getDefault</span><span style="color:#555">());</span>
</span></span><span style="display:flex;"><span>        String formattedDate <span style="color:#555">=</span> sdf<span style="color:#555">.</span><span style="color:#309">format</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">new</span> Date<span style="color:#555">(</span>lastModified<span style="color:#555">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> formattedDate <span style="color:#555">+</span> logFileExt<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 备份日志后需要对日志文件进行压缩
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @param file
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @param backupFileName
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">performBackup</span><span style="color:#555">(</span>File file<span style="color:#555">,</span> String backupFileName<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        SimpleDateFormat sdf <span style="color:#555">=</span> mLocalDirDateFormat<span style="color:#555">.</span><span style="color:#309">get</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>        sdf<span style="color:#555">.</span><span style="color:#309">setTimeZone</span><span style="color:#555">(</span>TimeZone<span style="color:#555">.</span><span style="color:#309">getDefault</span><span style="color:#555">());</span>
</span></span><span style="display:flex;"><span>        String logSaveDir <span style="color:#555">=</span> sdf<span style="color:#555">.</span><span style="color:#309">format</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">new</span> Date<span style="color:#555">(</span>file<span style="color:#555">.</span><span style="color:#309">lastModified</span><span style="color:#555">()));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#078;font-weight:bold">long</span> fileSize <span style="color:#555">=</span> file<span style="color:#555">.</span><span style="color:#309">length</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>        String saveFileName <span style="color:#555">=</span> file<span style="color:#555">.</span><span style="color:#309">getParent</span><span style="color:#555">()</span> <span style="color:#555">+</span> File<span style="color:#555">.</span><span style="color:#309">separator</span> <span style="color:#555">+</span> backupFileName<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>        <span style="color:#09f;font-style:italic">// 2023-12-03 23:28:16.191 20755-20835/com.gbcom.subwaysystem D/TAG: id=1488, performBackup: len=216406,getAbsolutePath=/custom/metro/gbcom_log/2023-12-03/2023-12-03.log, path=/custom/metro/gbcom_log/2023-12-03/2023-12-03.log, backupFileName=2023-12-03-232815.log, new path=/custom/metro/gbcom_log/2023-12-03/2023-12-03-232815.log
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;id=&#34;</span> <span style="color:#555">+</span> Thread<span style="color:#555">.</span><span style="color:#309">currentThread</span><span style="color:#555">().</span><span style="color:#309">getId</span><span style="color:#555">()</span> <span style="color:#555">+</span> <span style="color:#c30">&#34;, performBackup: len=&#34;</span> <span style="color:#555">+</span> file<span style="color:#555">.</span><span style="color:#309">length</span><span style="color:#555">()</span> <span style="color:#555">+</span> <span style="color:#c30">&#34;,getAbsolutePath=&#34;</span> <span style="color:#555">+</span> file<span style="color:#555">.</span><span style="color:#309">getAbsolutePath</span><span style="color:#555">()</span> <span style="color:#555">+</span> <span style="color:#c30">&#34;, path=&#34;</span> <span style="color:#555">+</span> file<span style="color:#555">.</span><span style="color:#309">getPath</span><span style="color:#555">()</span> <span style="color:#555">+</span> <span style="color:#c30">&#34;, backupFileName=&#34;</span> <span style="color:#555">+</span> backupFileName <span style="color:#555">+</span> <span style="color:#c30">&#34;, new path=&#34;</span> <span style="color:#555">+</span> saveFileName<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        String getZipFileName <span style="color:#555">=</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#078;font-weight:bold">int</span> getZipFileModifiedTime <span style="color:#555">=</span> <span style="color:#f60">0</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            File tmpFile <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> File<span style="color:#555">(</span>saveFileName<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#09f;font-style:italic">// 1.先压缩
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>            <span style="color:#09f;font-style:italic">//String zipFileName = tmpFile.getAbsolutePath() + &#34;.gz&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>            <span style="color:#09f;font-style:italic">// 压缩到指定日期的目录下
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>            File zipFile <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> File<span style="color:#555">(</span>tmpFile<span style="color:#555">.</span><span style="color:#309">getParent</span><span style="color:#555">()</span> <span style="color:#555">+</span> File<span style="color:#555">.</span><span style="color:#309">separator</span> <span style="color:#555">+</span> logSaveDir<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#09f;font-style:italic">// 创建目录
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(!</span>zipFile<span style="color:#555">.</span><span style="color:#309">exists</span><span style="color:#555">())</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                zipFile<span style="color:#555">.</span><span style="color:#309">mkdirs</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            String zipFileName <span style="color:#555">=</span> zipFile<span style="color:#555">.</span><span style="color:#309">getAbsolutePath</span><span style="color:#555">()</span> <span style="color:#555">+</span> File<span style="color:#555">.</span><span style="color:#309">separator</span> <span style="color:#555">+</span> tmpFile<span style="color:#555">.</span><span style="color:#309">getName</span><span style="color:#555">()</span> <span style="color:#555">+</span> <span style="color:#c30">&#34;.gz&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            ZipUtils<span style="color:#555">.</span><span style="color:#309">zipFile</span><span style="color:#555">(</span>tmpFile<span style="color:#555">.</span><span style="color:#309">getAbsolutePath</span><span style="color:#555">(),</span> zipFileName<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>zipFile<span style="color:#555">.</span><span style="color:#309">exists</span><span style="color:#555">()</span> <span style="color:#555">&amp;&amp;</span> zipFile<span style="color:#555">.</span><span style="color:#309">length</span><span style="color:#555">()</span> <span style="color:#555">&gt;</span> <span style="color:#f60">0</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                fileSize <span style="color:#555">=</span> zipFile<span style="color:#555">.</span><span style="color:#309">length</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>                saveFileName <span style="color:#555">=</span> zipFileName<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>                tmpFile<span style="color:#555">.</span><span style="color:#309">delete</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>                getZipFileName <span style="color:#555">=</span> zipFile<span style="color:#555">.</span><span style="color:#309">getName</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>                getZipFileModifiedTime <span style="color:#555">=</span> <span style="color:#555">(</span><span style="color:#078;font-weight:bold">int</span><span style="color:#555">)</span> <span style="color:#555">(</span>zipFile<span style="color:#555">.</span><span style="color:#309">lastModified</span><span style="color:#555">()</span> <span style="color:#555">/</span> <span style="color:#f60">1000</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;performBackup: e=&#34;</span><span style="color:#555">+</span>e<span style="color:#555">.</span><span style="color:#309">getMessage</span><span style="color:#555">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#09f;font-style:italic">// 2.入库
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        LFileList lFileList <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> LFileList<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>        lFileList<span style="color:#555">.</span><span style="color:#309">setAddTime</span><span style="color:#555">(</span>CommonUtils<span style="color:#555">.</span><span style="color:#309">getTime</span><span style="color:#555">());</span>
</span></span><span style="display:flex;"><span>        lFileList<span style="color:#555">.</span><span style="color:#309">setFileName</span><span style="color:#555">(</span>getZipFileName<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        lFileList<span style="color:#555">.</span><span style="color:#309">setFilePath</span><span style="color:#555">(</span>saveFileName<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        lFileList<span style="color:#555">.</span><span style="color:#309">setFileSize</span><span style="color:#555">(</span>fileSize<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        lFileList<span style="color:#555">.</span><span style="color:#309">setMarkNumber</span><span style="color:#555">(</span>MainConstant<span style="color:#555">.</span><span style="color:#309">TRAIN_NUMBER</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        lFileList<span style="color:#555">.</span><span style="color:#309">setModifiedTime</span><span style="color:#555">(</span>getZipFileModifiedTime<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#09f;font-style:italic">// 2表示行为操作日志，1表示通话音频文件
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        lFileList<span style="color:#555">.</span><span style="color:#309">setFileType</span><span style="color:#555">(</span>MainConstant<span style="color:#555">.</span><span style="color:#309">LOG_TYPE_BEHAVIOR</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        addData<span style="color:#555">(</span>lFileList<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 日志入库
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">addData</span><span style="color:#555">(</span>LFileList fileList<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#09f;font-style:italic">// 3、把查找到的最新文件列表保存入库
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        FileListRepository<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">addData</span><span style="color:#555">(</span>fileList<span style="color:#555">,</span> <span style="color:#069;font-weight:bold">new</span> LOnDbFinishedListener<span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">onSuccessfully</span><span style="color:#555">(</span>HandlerThread thread<span style="color:#555">,</span> Object data<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#078;font-weight:bold">long</span> ids <span style="color:#555">=</span> <span style="color:#555">(</span><span style="color:#078;font-weight:bold">long</span><span style="color:#555">)</span> data<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>                MyLogger<span style="color:#555">.</span><span style="color:#309">debug</span><span style="color:#555">(</span><span style="color:#c30">&#34;addData() - onSuccessfully, ids=&#34;</span> <span style="color:#555">+</span> ids<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>thread <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    thread<span style="color:#555">.</span><span style="color:#309">quit</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">onFailed</span><span style="color:#555">(</span>HandlerThread thread<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                MyLogger<span style="color:#555">.</span><span style="color:#309">debug</span><span style="color:#555">(</span><span style="color:#c30">&#34;addData() - onFailed&#34;</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>thread <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    thread<span style="color:#555">.</span><span style="color:#309">quit</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> String <span style="color:#c0f">getBackupFileName</span><span style="color:#555">(</span>String fileName<span style="color:#555">,</span> <span style="color:#078;font-weight:bold">int</span> backupIndex<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span><span style="color:#069;font-weight:bold">null</span> <span style="color:#555">!=</span> backupFileName<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> backupFileName<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">super</span><span style="color:#555">.</span><span style="color:#309">getBackupFileName</span><span style="color:#555">(</span>fileName<span style="color:#555">,</span> backupIndex<span style="color:#555">)</span> <span style="color:#555">+</span> logFileExt<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><h3 id="24创建xlog需要的自定义日志格式类">2.4.创建xlog需要的自定义日志格式类</h3>
<p>路径：D:\code\android\WH19-MetroSystem\app\src\main\java\com\gbcom\subwaysystem\log\GbcomFlattener.java</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.log</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">android.os.Build</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">android.util.Log</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.flattener.Flattener</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.flattener.Flattener2</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.text.SimpleDateFormat</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.Calendar</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.Date</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 日志输出格式
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2023/12/04 18:08
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">GbcomFlattener</span> <span style="color:#069;font-weight:bold">implements</span> Flattener<span style="color:#555">,</span> Flattener2 <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> CharSequence <span style="color:#c0f">flatten</span><span style="color:#555">(</span><span style="color:#078;font-weight:bold">int</span> logLevel<span style="color:#555">,</span> String tag<span style="color:#555">,</span> String message<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> flatten<span style="color:#555">(</span>System<span style="color:#555">.</span><span style="color:#309">currentTimeMillis</span><span style="color:#555">(),</span> logLevel<span style="color:#555">,</span> tag<span style="color:#555">,</span> message<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> CharSequence <span style="color:#c0f">flatten</span><span style="color:#555">(</span><span style="color:#078;font-weight:bold">long</span> timeMillis<span style="color:#555">,</span> <span style="color:#078;font-weight:bold">int</span> logLevel<span style="color:#555">,</span> String tag<span style="color:#555">,</span> String message<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> getCurrDateTime<span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">+</span> <span style="color:#c30">&#34; | &#34;</span> <span style="color:#555">+</span> getLevelName<span style="color:#555">(</span>logLevel<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">+</span> <span style="color:#c30">&#34; | &#34;</span> <span style="color:#555">+</span> tag
</span></span><span style="display:flex;"><span>                <span style="color:#555">+</span> <span style="color:#c30">&#34; | &#34;</span> <span style="color:#555">+</span> message<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> String <span style="color:#c0f">getCurrDateTime</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>Build<span style="color:#555">.</span><span style="color:#309">VERSION</span><span style="color:#555">.</span><span style="color:#309">SDK_INT</span> <span style="color:#555">&gt;=</span> <span style="color:#f60">24</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">new</span> SimpleDateFormat<span style="color:#555">(</span><span style="color:#c30">&#34;yyyy-MM-dd HH:mm:ss.SSS&#34;</span><span style="color:#555">).</span><span style="color:#309">format</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">new</span> Date<span style="color:#555">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            Calendar calendar <span style="color:#555">=</span> Calendar<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> String<span style="color:#555">.</span><span style="color:#309">format</span><span style="color:#555">(</span><span style="color:#c30">&#34;%04d-%02d-%02d %02d:%02d:%02d.%03d&#34;</span><span style="color:#555">,</span>
</span></span><span style="display:flex;"><span>                    calendar<span style="color:#555">.</span><span style="color:#309">get</span><span style="color:#555">(</span>Calendar<span style="color:#555">.</span><span style="color:#309">YEAR</span><span style="color:#555">),</span>
</span></span><span style="display:flex;"><span>                    calendar<span style="color:#555">.</span><span style="color:#309">get</span><span style="color:#555">(</span>Calendar<span style="color:#555">.</span><span style="color:#309">MONTH</span><span style="color:#555">)</span> <span style="color:#555">+</span> <span style="color:#f60">1</span><span style="color:#555">,</span>
</span></span><span style="display:flex;"><span>                    calendar<span style="color:#555">.</span><span style="color:#309">get</span><span style="color:#555">(</span>Calendar<span style="color:#555">.</span><span style="color:#309">DAY_OF_MONTH</span><span style="color:#555">),</span>
</span></span><span style="display:flex;"><span>                    calendar<span style="color:#555">.</span><span style="color:#309">get</span><span style="color:#555">(</span>Calendar<span style="color:#555">.</span><span style="color:#309">HOUR_OF_DAY</span><span style="color:#555">),</span>
</span></span><span style="display:flex;"><span>                    calendar<span style="color:#555">.</span><span style="color:#309">get</span><span style="color:#555">(</span>Calendar<span style="color:#555">.</span><span style="color:#309">MINUTE</span><span style="color:#555">),</span>
</span></span><span style="display:flex;"><span>                    calendar<span style="color:#555">.</span><span style="color:#309">get</span><span style="color:#555">(</span>Calendar<span style="color:#555">.</span><span style="color:#309">SECOND</span><span style="color:#555">),</span>
</span></span><span style="display:flex;"><span>                    calendar<span style="color:#555">.</span><span style="color:#309">get</span><span style="color:#555">(</span>Calendar<span style="color:#555">.</span><span style="color:#309">MILLISECOND</span><span style="color:#555">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> String <span style="color:#c0f">getLevelName</span><span style="color:#555">(</span><span style="color:#078;font-weight:bold">int</span> logLevel<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">switch</span> <span style="color:#555">(</span>logLevel<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">case</span> Log<span style="color:#555">.</span><span style="color:#309">VERBOSE</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#34;VERBOSE&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">case</span> Log<span style="color:#555">.</span><span style="color:#309">DEBUG</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#34; DEBUG &#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">case</span> Log<span style="color:#555">.</span><span style="color:#309">INFO</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#34; INFO  &#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">case</span> Log<span style="color:#555">.</span><span style="color:#309">WARN</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#34; WARN  &#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">case</span> Log<span style="color:#555">.</span><span style="color:#309">ERROR</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#34; ERROR &#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">default</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#34;UNKNOWN&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><h3 id="25xlog初始化">2.5.xlog初始化</h3>
<p>在Application中初始化xlog。</p>
<p>路径：D:\code\android\WH19-MetroSystem\app\src\main\java\com\gbcom\subwaysystem\application\SystemApplication.java</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.application</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">android.app.Application</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">android.content.Context</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">android.util.Log</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">androidx.multidex.MultiDex</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.LogConfiguration</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.LogLevel</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.XLog</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.printer.AndroidPrinter</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.printer.Printer</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.printer.file.FilePrinter</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.crash.CrashHandler</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.log.GbcomDateFilePathGenerator</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.log.GbcomFileSizeBackupStrategy</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.log.GbcomFlattener</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.utils.MyLogger</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.tdtech.providers.econtacts.EContactsProviderApplication</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">lte.trunk.tapp.sdk.TAppFramework</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">lte.trunk.terminal.contacts.ContactsApplication</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">lte.trunk.tms.api.TMSCore</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">SystemApplication</span> <span style="color:#069;font-weight:bold">extends</span> Application <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String TAG <span style="color:#555">=</span> SystemApplication<span style="color:#555">.</span><span style="color:#309">class</span><span style="color:#555">.</span><span style="color:#309">getSimpleName</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> Context mContext<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> Context <span style="color:#c0f">getmContext</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> mContext<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> Application <span style="color:#c0f">getApplication</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> getApplication<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">protected</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">attachBaseContext</span><span style="color:#555">(</span>Context base<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">super</span><span style="color:#555">.</span><span style="color:#309">attachBaseContext</span><span style="color:#555">(</span>base<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        MultiDex<span style="color:#555">.</span><span style="color:#309">install</span><span style="color:#555">(</span>base<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">onCreate</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">super</span><span style="color:#555">.</span><span style="color:#309">onCreate</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>        mContext <span style="color:#555">=</span> getApplicationContext<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#09f;font-style:italic">// 异常处理
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        CrashHandler<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">init</span><span style="color:#555">(</span>getApplicationContext<span style="color:#555">());</span>
</span></span><span style="display:flex;"><span>        initLog<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            TMSCore<span style="color:#555">.</span><span style="color:#309">initInstance</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">this</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#09f;font-style:italic">//只做初始化，但是不启动SDK内部的service。待动态申请权限后，再启动后台的service
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>            TAppFramework<span style="color:#555">.</span><span style="color:#309">initApplication</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">this</span><span style="color:#555">,</span> <span style="color:#069;font-weight:bold">false</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            EContactsProviderApplication<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">init</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">this</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            ContactsApplication<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">init</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">this</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            MyLogger<span style="color:#555">.</span><span style="color:#309">record</span><span style="color:#555">(</span>TAG <span style="color:#555">+</span> <span style="color:#c30">&#34;, app onCreate()&#34;</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            MyLogger<span style="color:#555">.</span><span style="color:#309">record</span><span style="color:#555">(</span>TAG <span style="color:#555">+</span> <span style="color:#c30">&#34;, init SDK error, e=&#34;</span> <span style="color:#555">+</span> e<span style="color:#555">.</span><span style="color:#309">getMessage</span><span style="color:#555">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">initLog</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        String logSaveDir  <span style="color:#555">=</span> FileUtils<span style="color:#555">.</span><span style="color:#309">getLogPath</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        XLog.init(LogLevel.ALL);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>
</span></span><span style="display:flex;"><span>        <span style="color:#09f;font-style:italic">// flattener设置日志文件内容输出格式，默认DefaultFlattener，默认的格式是时间戳|日志级别|tag
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        FilePrinter filePrinter <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> FilePrinter                      <span style="color:#09f;font-style:italic">// 打印(保存)日志到文件的打印机
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                <span style="color:#555">.</span><span style="color:#309">Builder</span><span style="color:#555">(</span>logSaveDir<span style="color:#555">)</span><span style="color:#09f;font-style:italic">// 指定日志文件的目录路径
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#09f;font-style:italic">//.Builder(new File(&#34;/custom/metro/gbcom_log&#34;, &#34;log&#34;).getPath())// 指定日志文件的目录路径
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#09f;font-style:italic">//.fileNameGenerator(new DateFileNameGenerator()) //自定义文件名称 默认值:ChangelessFileNameGenerator(“日志”)
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                <span style="color:#555">.</span><span style="color:#309">fileNameGenerator</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">new</span> GbcomDateFilePathGenerator<span style="color:#555">())</span> <span style="color:#09f;font-style:italic">//自定义文件名称 默认值:ChangelessFileNameGenerator(“日志”)
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#09f;font-style:italic">//.backupStrategy(new FileSizeBackupStrategy2(2 * 1024 * 1024, 0)) //单个日志文件的大小默认:FileSizeBackupStrategy(1024 * 1024)【3 * 1024 * 1024】
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                <span style="color:#555">.</span><span style="color:#309">backupStrategy</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">new</span> GbcomFileSizeBackupStrategy<span style="color:#555">(</span>MainConstant<span style="color:#555">.</span><span style="color:#309">APP_FILE_SAVE_LOG_SIZE</span><span style="color:#555">,</span> <span style="color:#f60">0</span><span style="color:#555">))</span> <span style="color:#09f;font-style:italic">//单个日志文件的大小默认:FileSizeBackupStrategy(1024 * 1024)【3 * 1024 * 1024】
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#09f;font-style:italic">//.cleanStrategy(new FileLastModifiedCleanStrategy(30L * 24L * 60L * 60L * 1000L))  //日志文件存活时间，单位毫秒【单位毫秒。当日志文件超过指定的时间，在下次执行打印的时候就会被清除！防止日志文件过多占用存储空间！这里要注意int类型数据溢出哦！建议用long类型的参数！】
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#09f;font-style:italic">//.cleanStrategy(new NeverCleanStrategy ())  //日志文件存活时间，单位毫秒【单位毫秒。当日志文件超过指定的时间，在下次执行打印的时候就会被清除！防止日志文件过多占用存储空间！这里要注意int类型数据溢出哦！建议用long类型的参数！】
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                <span style="color:#555">.</span><span style="color:#309">flattener</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">new</span> GbcomFlattener<span style="color:#555">())</span> <span style="color:#09f;font-style:italic">//自定义flattener，控制打印格式-DefaultFlattener()
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                <span style="color:#555">.</span><span style="color:#309">build</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#09f;font-style:italic">// 通过 android.util.Log 打印日志的打印器，必须调用它，否则没办法在控制台上打印出来
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        Printer androidPrinter <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> AndroidPrinter<span style="color:#555">(</span><span style="color:#069;font-weight:bold">true</span><span style="color:#555">);</span>         <span style="color:#09f;font-style:italic">// 经过 android.util.Log 打印日志的打印器
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>        <span style="color:#09f;font-style:italic">//Printer consolePrinter = new ConsolePrinter();             // 经过 System.out 打印日志到控制台的打印器
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#09f;font-style:italic">// 初始化，这一段的初始化方法全局只用执行一次就够了
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        LogConfiguration config <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> LogConfiguration<span style="color:#555">.</span><span style="color:#309">Builder</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                <span style="color:#09f;font-style:italic">//.logLevel(BuildConfig.DEBUG ? LogLevel.ALL             // 指定日志等级，低于该等级的日志将不会被打印，默以为 LogLevel.ALL
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#09f;font-style:italic">//        : LogLevel.NONE)
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                <span style="color:#555">.</span><span style="color:#309">logLevel</span><span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">ALL</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                <span style="color:#555">.</span><span style="color:#309">tag</span><span style="color:#555">(</span><span style="color:#c30">&#34;Gbcom-log&#34;</span><span style="color:#555">)</span>                                         <span style="color:#09f;font-style:italic">// 指定 TAG，默以为 &#34;X-LOG&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#555">.</span><span style="color:#309">enableThreadInfo</span><span style="color:#555">()</span>                                    <span style="color:#09f;font-style:italic">// 答应打印线程信息，默许制止
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#555">.</span><span style="color:#309">enableStackTrace</span><span style="color:#555">(</span><span style="color:#f60">2</span><span style="color:#555">)</span>                                   <span style="color:#09f;font-style:italic">// 答应打印深度为 2 的调用栈信息，默许制止
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .enableBorder()                                        // 答应打印日志边框，默许制止
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .jsonFormatter(new MyJsonFormatter())                  // 指定 JSON 格局化器，默以为 DefaultJsonFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .xmlFormatter(new MyXmlFormatter())                    // 指定 XML 格局化器，默以为 DefaultXmlFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .throwableFormatter(new MyThrowableFormatter())        // 指定可抛出反常格局化器，默以为 DefaultThrowableFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .threadFormatter(new MyThreadFormatter())              // 指定线程信息格局化器，默以为 DefaultThreadFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .stackTraceFormatter(new MyStackTraceFormatter())      // 指定调用栈信息格局化器，默以为 DefaultStackTraceFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .borderFormatter(new MyBoardFormatter())               // 指定边框格局化器，默以为 DefaultBorderFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .addObjectFormatter(AnyClass.class,                    // 为指定类型增加对象格局化器
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                        new AnyClassObjectFormatter())                     // 默许运用 Object.toString()
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#09f;font-style:italic">//.addInterceptor(new BlacklistTagsFilterInterceptor(    // 增加黑名单 TAG 过滤器
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#09f;font-style:italic">//        &#34;blacklist1&#34;, &#34;blacklist2&#34;, &#34;blacklist3&#34;))
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#09f;font-style:italic">//.addInterceptor(new WhitelistTagsFilterInterceptor( // Add whitelist tags filter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                <span style="color:#09f;font-style:italic">//        &#34;whitelist1&#34;, &#34;whitelist2&#34;, &#34;whitelist3&#34;))
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .addInterceptor(new MyInterceptor())                   // 增加一个日志拦截器
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                <span style="color:#555">.</span><span style="color:#309">build</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        XLog.init(config, androidPrinter, consolePrinter, filePrinter);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        XLog<span style="color:#555">.</span><span style="color:#309">init</span><span style="color:#555">(</span>config<span style="color:#555">,</span> androidPrinter<span style="color:#555">,</span> filePrinter<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        LogConfiguration config = new LogConfiguration.Builder()
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .logLevel(BuildConfig.DEBUG ? LogLevel.ALL             // Specify log level, logs below this level won&#39;t be printed, default: LogLevel.ALL
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                        : LogLevel.NONE)
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                //.tag(getString(R.string.global_tag))                   // Specify TAG, default: &#34;X-LOG&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .tag(&#34;Gbcom-LOG&#34;)                   // 指定 TAG，默认为 &#34;X-LOG&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .enableThreadInfo()                                 // 允许打印线程信息，默认禁止
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .enableStackTrace(2)                                // 允许打印深度为2的调用栈信息，默认禁止
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .enableBorder()                                     // 允许打印日志边框，默认禁止
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .jsonFormatter(new MyJsonFormatter())               // 指定 JSON 格式化器，默认为 DefaultJsonFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .xmlFormatter(new MyXmlFormatter())                 // 指定 XML 格式化器，默认为 DefaultXmlFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .throwableFormatter(new MyThrowableFormatter())     // 指定可抛出异常格式化器，默认为 DefaultThrowableFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .threadFormatter(new MyThreadFormatter())           // 指定线程信息格式化器，默认为 DefaultThreadFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .stackTraceFormatter(new MyStackTraceFormatter())   // 指定调用栈信息格式化器，默认为 DefaultStackTraceFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .borderFormatter(new MyBoardFormatter())            // 指定边框格式化器，默认为 DefaultBorderFormatter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .addObjectFormatter(AnyClass.class,                 // Add formatter for specific class of object
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                //     new AnyClassObjectFormatter())                  // Use Object.toString() by default
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .addInterceptor(new BlacklistTagsFilterInterceptor(    // Add blacklist tags filter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                        &#34;blacklist1&#34;, &#34;blacklist2&#34;, &#34;blacklist3&#34;))
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .addInterceptor(new WhitelistTagsFilterInterceptor( // Add whitelist tags filter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                //     &#34;whitelist1&#34;, &#34;whitelist2&#34;, &#34;whitelist3&#34;))
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .addInterceptor(new MyInterceptor())                // Add a log interceptor
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .build();
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        Printer androidPrinter = new AndroidPrinter();             // 通过 android.util.Log 打印日志的打印器
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        Printer filePrinter = new FilePrinter                      // Printer that print the log to the file system
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                //.Builder(new File(getExternalCacheDir().getAbsolutePath(), &#34;log&#34;).getPath())       // Specify the path to save log file
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .Builder(new File(&#34;/custom/metro/test_log&#34;, &#34;log&#34;).getPath())       // Specify the path to save log file
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .fileNameGenerator(new DateFileNameGenerator())        // Default: ChangelessFileNameGenerator(&#34;log&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .backupStrategy(new MyBackupStrategy())             // Default: FileSizeBackupStrategy(1024 * 1024)
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                // .cleanStrategy(new FileLastModifiedCleanStrategy(MAX_TIME))     // Default: NeverCleanStrategy()
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .flattener(new ClassicFlattener())                     // Default: DefaultFlattener
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .writer(new SimpleWriter() {                           // Default: SimpleWriter
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                    @Override
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                    public void onNewFileCreated(File file) {
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                        super.onNewFileCreated(file);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                        final String header = &#34;\n&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; File Header &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#34; +
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                                &#34;\nDevice Manufacturer: &#34; + Build.MANUFACTURER +
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                                &#34;\nDevice Model       : &#34; + Build.MODEL +
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                                &#34;\nAndroid Version    : &#34; + Build.VERSION.RELEASE +
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                                &#34;\nAndroid SDK        : &#34; + Build.VERSION.SDK_INT +
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                                &#34;\nApp VersionName    : &#34; + BuildConfig.VERSION_NAME +
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                                &#34;\nApp VersionCode    : &#34; + BuildConfig.VERSION_CODE +
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                                &#34;\n&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; File Header &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;\n\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                        appendLog(header);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                    }
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                })
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                .build();
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        XLog.init(                                                 // Initialize XLog
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                config,                                                // Specify the log configuration, if not specified, will use new LogConfiguration.Builder().build()
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                androidPrinter,                                        // Specify printers, if no printer is specified, AndroidPrinter(for Android)/ConsolePrinter(for java) will be used.
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                filePrinter);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        // For future usage: partial usage in MainActivity.
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        globalFilePrinter = filePrinter;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        // Intercept all logs(including logs logged by third party modules/libraries) and print them to file.
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//        LibCat.config(true, filePrinter);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">onTerminate</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">super</span><span style="color:#555">.</span><span style="color:#309">onTerminate</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>        Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;onTerminate&#34;</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>        exitApp<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 退出应用
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">exitApp</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        android<span style="color:#555">.</span><span style="color:#309">os</span><span style="color:#555">.</span><span style="color:#309">Process</span><span style="color:#555">.</span><span style="color:#309">killProcess</span><span style="color:#555">(</span>android<span style="color:#555">.</span><span style="color:#309">os</span><span style="color:#555">.</span><span style="color:#309">Process</span><span style="color:#555">.</span><span style="color:#309">myPid</span><span style="color:#555">());</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#555">.</span><span style="color:#309">exit</span><span style="color:#555">(</span><span style="color:#f60">0</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><h3 id="26获取日志保存目录">2.6.获取日志保存目录</h3>
<p>获取日志保存的位置。</p>
<p>路径：D:\code\android\WH19-MetroSystem\app\src\main\java\com\gbcom\subwaysystem\utils\FileUtils.java</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 返回SC60文件的存储路径
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @author daizelai
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @date 2021/12/09 18:14
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> String <span style="color:#c0f">getMetroVoiceStoragePath</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        String path <span style="color:#555">=</span> getMetroStoragePath<span style="color:#555">()</span> <span style="color:#555">+</span> File<span style="color:#555">.</span><span style="color:#309">separator</span> <span style="color:#555">+</span> <span style="color:#c30">&#34;voice&#34;</span> <span style="color:#555">+</span> File<span style="color:#555">.</span><span style="color:#309">separator</span> <span style="color:#555">+</span> CommonUtils<span style="color:#555">.</span><span style="color:#309">getDate</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            File file <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> File<span style="color:#555">(</span>path<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(!</span>file<span style="color:#555">.</span><span style="color:#309">exists</span><span style="color:#555">())</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                file<span style="color:#555">.</span><span style="color:#309">mkdirs</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#555">.</span><span style="color:#309">printStackTrace</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> path<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     * 获取日志存储目录
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     * @author daizelai
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     * @date 2023/12/04 19:18
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     */</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> String <span style="color:#c0f">getLogPath</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>        String path <span style="color:#555">=</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>        <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>            path <span style="color:#555">=</span> getMetroSonStoragePath<span style="color:#555">(</span>MainConstant<span style="color:#555">.</span><span style="color:#309">APP_FILE_SAVE_LOG_DIR</span> <span style="color:#555">+</span> File<span style="color:#555">.</span><span style="color:#309">separator</span> <span style="color:#555">+</span> MainConstant<span style="color:#555">.</span><span style="color:#309">APP_FILE_SAVE_LOG_BEHAVIOR_DIR</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>path <span style="color:#555">==</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>                path <span style="color:#555">=</span> getSDPath<span style="color:#555">(</span>MainConstant<span style="color:#555">.</span><span style="color:#309">APP_FILE_SAVE_LOG_BEHAVIOR_DIR</span><span style="color:#555">);</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>        <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>            MyLogger<span style="color:#555">.</span><span style="color:#309">error</span><span style="color:#555">(</span><span style="color:#c30">&#34;getLogPath - Exception=&#34;</span> <span style="color:#555">+</span> e<span style="color:#555">.</span><span style="color:#309">getMessage</span><span style="color:#555">());</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>        <span style="color:#069;font-weight:bold">return</span> path<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    <span style="color:#555">}</span>
</span></span></code></pre></div><h3 id="27配置常量">2.7.配置常量</h3>
<p>定义日志文件大小。</p>
<p>2023/12/04 22:19</p>
<p>路径：D:\code\android\WH19-MetroSystem\app\src\main\java\com\gbcom\subwaysystem\constant\MainConstant.java</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 文件存储路径
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * APP_FILE_SAVE_ROOT_DIR：文件保存的顶级目录名
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * APP_FILE_SAVE_CONFIG_DIR：开局配置文件备份的存储路径
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * APP_FILE_SAVE_BAK_DIR = &#34;backup&#34;：此目录表示train下面的备份目录，文件只要被扫描过了都放置在此目录
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * APP_FILE_SAVE_PCM_DIR：音频文件保存的目录名
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * APP_FILE_SAVE_PCAP_DIR：抓去的报文保存目录名
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * APP_FILE_SAVE_LOG_DIR：apk异常日志保存目录名
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * APP_FILE_SAVE_LOG_BEHAVIOR_DIR = &#34;behavior&#34;：用户行为日志保存目录
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * APP_FILE_SAVE_LOG_SIZE: 默认生成的日志文件大小为2M(2 * 1024 * 1024)
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_ROOT_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;train&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_CONFIG_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;config&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_BROADCAST_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;bro&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_BAK_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;backup&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_PCM_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;pcm&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_PCAP_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;pcap&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_LOG_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;log&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_LOG_RUN_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;run&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_LOG_BEHAVIOR_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;behavior&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_LOG_EXCEPTION_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;exception&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_CRASH_LOG_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;crashLog&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_ATTACH_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;attachment&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String APP_FILE_SAVE_TMP_DIR <span style="color:#555">=</span> <span style="color:#c30">&#34;tmp&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> <span style="color:#078;font-weight:bold">int</span> APP_FILE_SAVE_LOG_SIZE <span style="color:#555">=</span> <span style="color:#f60">20</span> <span style="color:#555">*</span> <span style="color:#f60">1024</span> <span style="color:#555">*</span> <span style="color:#f60">1024</span><span style="color:#555">;</span>
</span></span></code></pre></div><h2 id="三替换日志框架">三、替换日志框架</h2>
<h3 id="31当前日志工具类">3.1.当前日志工具类</h3>
<p>今天2023/12/04 22:21之前的日志工具类源码，是自己写的一个源码。</p>
<p>路径：D:\code\android\WH19-MetroSystem\app\src\main\java\com\gbcom\subwaysystem\utils\MyLogger.java</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.utils</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">android.util.Log</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 日志封装使用
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2020/05/13 11:26
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">MyLogger</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String TAG <span style="color:#555">=</span> MyLogger<span style="color:#555">.</span><span style="color:#309">class</span><span style="color:#555">.</span><span style="color:#309">getSimpleName</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">final</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">boolean</span> logFlag <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">true</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 日志文件
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> String userName <span style="color:#555">=</span> <span style="color:#c30">&#34;train&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#c0f">MyLogger</span><span style="color:#555">(</span>String userName<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">this</span><span style="color:#555">.</span><span style="color:#309">userName</span> <span style="color:#555">=</span> userName<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 获取方法名
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> String <span style="color:#c0f">getFunctionName</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        StackTraceElement<span style="color:#555">[]</span> sts <span style="color:#555">=</span> Thread<span style="color:#555">.</span><span style="color:#309">currentThread</span><span style="color:#555">().</span><span style="color:#309">getStackTrace</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>sts <span style="color:#555">==</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">for</span> <span style="color:#555">(</span>StackTraceElement st <span style="color:#555">:</span> sts<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>st<span style="color:#555">.</span><span style="color:#309">isNativeMethod</span><span style="color:#555">())</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">continue</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>st<span style="color:#555">.</span><span style="color:#309">getClassName</span><span style="color:#555">().</span><span style="color:#309">equals</span><span style="color:#555">(</span>Thread<span style="color:#555">.</span><span style="color:#309">class</span><span style="color:#555">.</span><span style="color:#309">getName</span><span style="color:#555">()))</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">continue</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>st<span style="color:#555">.</span><span style="color:#309">getClassName</span><span style="color:#555">().</span><span style="color:#309">equals</span><span style="color:#555">(</span>MyLogger<span style="color:#555">.</span><span style="color:#309">class</span><span style="color:#555">.</span><span style="color:#309">getName</span><span style="color:#555">()))</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">continue</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#34;[ &#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#555">+</span> Thread<span style="color:#555">.</span><span style="color:#309">currentThread</span><span style="color:#555">().</span><span style="color:#309">getName</span><span style="color:#555">()</span> <span style="color:#555">+</span> <span style="color:#c30">&#34;: &#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#555">+</span> st<span style="color:#555">.</span><span style="color:#309">getFileName</span><span style="color:#555">().</span><span style="color:#309">replace</span><span style="color:#555">(</span><span style="color:#c30">&#34;.java&#34;</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">)</span> <span style="color:#555">+</span> <span style="color:#c30">&#34;:&#34;</span> <span style="color:#555">+</span> st<span style="color:#555">.</span><span style="color:#309">getLineNumber</span><span style="color:#555">()</span> <span style="color:#555">+</span> <span style="color:#c30">&#34; ]&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">info</span><span style="color:#555">(</span>String str<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>logFlag<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String name <span style="color:#555">=</span> getFunctionName<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>name <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    LogUtil<span style="color:#555">.</span><span style="color:#309">ii</span><span style="color:#555">(</span>name<span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    LogUtil<span style="color:#555">.</span><span style="color:#309">ii</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;info - &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                e<span style="color:#555">.</span><span style="color:#309">printStackTrace</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">i</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34; - Exception - &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">debug</span><span style="color:#555">(</span>String str<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>logFlag<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String name <span style="color:#555">=</span> getFunctionName<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;debug: &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                e<span style="color:#555">.</span><span style="color:#309">printStackTrace</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34; - Exception - &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 用户行为日志
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @param str
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">record</span><span style="color:#555">(</span>String str<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>logFlag<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String name <span style="color:#555">=</span> getFunctionName<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>name <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    LogUtil<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>name<span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    LogUtil<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span><span style="color:#c30">&#34;record&#34;</span><span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                e<span style="color:#555">.</span><span style="color:#309">printStackTrace</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34; - &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 信息太长,分段打印
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @param str
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">debugMax</span><span style="color:#555">(</span>String str<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>logFlag<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String name <span style="color:#555">=</span> getFunctionName<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>name <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#09f;font-style:italic">//为String的length是字符数量不是字节数量所以为了防止中文字符过多，把4*1024的MAX字节打印长度改为2001字符数
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                <span style="color:#078;font-weight:bold">int</span> max_str_length <span style="color:#555">=</span> <span style="color:#f60">2001</span> <span style="color:#555">-</span> name<span style="color:#555">.</span><span style="color:#309">length</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#09f;font-style:italic">//大于4000时
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                <span style="color:#069;font-weight:bold">while</span> <span style="color:#555">(</span>str<span style="color:#555">.</span><span style="color:#309">length</span><span style="color:#555">()</span> <span style="color:#555">&gt;</span> max_str_length<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>name<span style="color:#555">,</span> str<span style="color:#555">.</span><span style="color:#309">substring</span><span style="color:#555">(</span><span style="color:#f60">0</span><span style="color:#555">,</span> max_str_length<span style="color:#555">));</span>
</span></span><span style="display:flex;"><span>                    str <span style="color:#555">=</span> str<span style="color:#555">.</span><span style="color:#309">substring</span><span style="color:#555">(</span>max_str_length<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#09f;font-style:italic">//剩余部分
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>name<span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#09f;font-style:italic">// 因为String的length是字符数量不是字节数量所以为了防止中文字符过多，把4*1024的MAX字节打印长度改为2001字符数
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                <span style="color:#078;font-weight:bold">int</span> max_str_length <span style="color:#555">=</span> <span style="color:#f60">2001</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#09f;font-style:italic">//大于4000时
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                <span style="color:#069;font-weight:bold">while</span> <span style="color:#555">(</span>str<span style="color:#555">.</span><span style="color:#309">length</span><span style="color:#555">()</span> <span style="color:#555">&gt;</span> max_str_length<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>name<span style="color:#555">,</span> str<span style="color:#555">.</span><span style="color:#309">substring</span><span style="color:#555">(</span><span style="color:#f60">0</span><span style="color:#555">,</span> max_str_length<span style="color:#555">));</span>
</span></span><span style="display:flex;"><span>                    str <span style="color:#555">=</span> str<span style="color:#555">.</span><span style="color:#309">substring</span><span style="color:#555">(</span>max_str_length<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#09f;font-style:italic">//剩余部分
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>name<span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 记录错误日志，记录错误日志时，同时也会记录record日志
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @param str
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">error</span><span style="color:#555">(</span>String str<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>logFlag<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String name <span style="color:#555">=</span> getFunctionName<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>name <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                LogUtil<span style="color:#555">.</span><span style="color:#309">ee</span><span style="color:#555">(</span>name<span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                LogUtil<span style="color:#555">.</span><span style="color:#309">ee</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;error - &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><h3 id="32替换后的日志工具类">3.2.替换后的日志工具类</h3>
<p>候后的调用的日志工具类。by daizelai on 2023/12/05 13:33</p>
<p>路径：D:\code\android\WH19-MetroSystem\app\src\main\java\com\gbcom\subwaysystem\utils\MyLogger.java</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.subwaysystem.utils</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">android.util.Log</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.LogLevel</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">com.elvishew.xlog.XLog</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.concurrent.ExecutorService</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.concurrent.Executors</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">java.util.concurrent.LinkedBlockingQueue</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 日志封装使用
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * Log.v 的调试颜色为黑色的，任何消息都会输出，这里的v代表verbose啰嗦的意思，平时使用就是Log.v(&#34;&#34;,&#34;&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * Log.d的输出颜色是蓝色的，仅输出debug调试的意思，但他会输出上层的信息，过滤起来可以通过DDMS的Logcat标签来选择
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * Log.i的输出为绿色，一般提示性的消息information，它不会输出Log.v和Log.d的信息，但会显示i、w和e的信息
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * Log.w的意思为橙色，可以看作为warning警告，一般需要我们注意优化Android代码，同时选择它后还会输出Log.e的信息。
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * Log.e为红色，可以想到error错误，这里仅显示红色的错误信息，这些错误就需要我们认真的分析，查看栈的信息了。
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2020/05/13 11:26
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">MyLogger</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> String TAG <span style="color:#555">=</span> MyLogger<span style="color:#555">.</span><span style="color:#309">class</span><span style="color:#555">.</span><span style="color:#309">getSimpleName</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">final</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">boolean</span> logFlag <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">true</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> ExecutorService logExecutor <span style="color:#555">=</span> Executors<span style="color:#555">.</span><span style="color:#309">newSingleThreadExecutor</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 设置队列的最大容量
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> <span style="color:#078;font-weight:bold">int</span> MAX_QUEUE_SIZE <span style="color:#555">=</span> <span style="color:#f60">1000</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#069;font-weight:bold">final</span> LinkedBlockingQueue<span style="color:#555">&lt;</span>String<span style="color:#555">&gt;</span> logQueue <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">new</span> LinkedBlockingQueue<span style="color:#555">&lt;&gt;(</span>MAX_QUEUE_SIZE<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 获取方法名
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> String <span style="color:#c0f">getFunctionName</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        StackTraceElement<span style="color:#555">[]</span> sts <span style="color:#555">=</span> Thread<span style="color:#555">.</span><span style="color:#309">currentThread</span><span style="color:#555">().</span><span style="color:#309">getStackTrace</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>sts <span style="color:#555">==</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">for</span> <span style="color:#555">(</span>StackTraceElement st <span style="color:#555">:</span> sts<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>st<span style="color:#555">.</span><span style="color:#309">isNativeMethod</span><span style="color:#555">())</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">continue</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>st<span style="color:#555">.</span><span style="color:#309">getClassName</span><span style="color:#555">().</span><span style="color:#309">equals</span><span style="color:#555">(</span>Thread<span style="color:#555">.</span><span style="color:#309">class</span><span style="color:#555">.</span><span style="color:#309">getName</span><span style="color:#555">()))</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">continue</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>st<span style="color:#555">.</span><span style="color:#309">getClassName</span><span style="color:#555">().</span><span style="color:#309">equals</span><span style="color:#555">(</span>MyLogger<span style="color:#555">.</span><span style="color:#309">class</span><span style="color:#555">.</span><span style="color:#309">getName</span><span style="color:#555">()))</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">continue</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#34;[ &#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#555">+</span> Thread<span style="color:#555">.</span><span style="color:#309">currentThread</span><span style="color:#555">().</span><span style="color:#309">getName</span><span style="color:#555">()</span> <span style="color:#555">+</span> <span style="color:#c30">&#34;:&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#555">+</span> st<span style="color:#555">.</span><span style="color:#309">getFileName</span><span style="color:#555">().</span><span style="color:#309">replace</span><span style="color:#555">(</span><span style="color:#c30">&#34;.java&#34;</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">)</span> <span style="color:#555">+</span> <span style="color:#c30">&#34;:&#34;</span> <span style="color:#555">+</span> st<span style="color:#555">.</span><span style="color:#309">getLineNumber</span><span style="color:#555">()</span> <span style="color:#555">+</span> <span style="color:#c30">&#34; ]&#34;</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">verbose</span><span style="color:#555">(</span>String str<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>logFlag<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String name <span style="color:#555">=</span> getFunctionName<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>name <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">VERBOSE</span><span style="color:#555">,</span> name<span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">VERBOSE</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">v</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;verbose - &#34;</span> <span style="color:#555">+</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34; - Exception - &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">warn</span><span style="color:#555">(</span>String str<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>logFlag<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String name <span style="color:#555">=</span> getFunctionName<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>name <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">WARN</span><span style="color:#555">,</span> name<span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">WARN</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">v</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;warn - &#34;</span> <span style="color:#555">+</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34; - Exception - &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">info</span><span style="color:#555">(</span>String str<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>logFlag<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String name <span style="color:#555">=</span> getFunctionName<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>name <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                    <span style="color:#09f;font-style:italic">//XLog.i(name + &#34;, &#34; + str);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">INFO</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">,</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34;, &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">INFO</span><span style="color:#555">,</span> name<span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                    <span style="color:#09f;font-style:italic">//XLog.i(str);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">INFO</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">i</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;info - &#34;</span> <span style="color:#555">+</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34; - Exception - &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">debug</span><span style="color:#555">(</span>String str<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>logFlag<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String name <span style="color:#555">=</span> getFunctionName<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>name <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                    <span style="color:#09f;font-style:italic">//XLog.d(name + &#34;, &#34; + str);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">DEBUG</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">,</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34;, &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">DEBUG</span><span style="color:#555">,</span> name<span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                    XLog.d(str);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">DEBUG</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;debug - &#34;</span> <span style="color:#555">+</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34; - Exception - &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 用户行为日志
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @param str
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">record</span><span style="color:#555">(</span>String str<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>logFlag<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String name <span style="color:#555">=</span> getFunctionName<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>name <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                    XLog.i(name + &#34;, &#34; + str);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">INFO</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">,</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34;, &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">INFO</span><span style="color:#555">,</span> name<span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span><span style="color:#09f;font-style:italic">//                    XLog.i(str);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">INFO</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;record - &#34;</span> <span style="color:#555">+</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34; - &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 记录错误日志，记录错误日志时，同时也会记录record日志
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @param str
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">public</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">error</span><span style="color:#555">(</span>String str<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>logFlag<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String name <span style="color:#555">=</span> getFunctionName<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>name <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                    <span style="color:#09f;font-style:italic">//XLog.e(name + &#34;, &#34; + str);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">ERROR</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">,</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34;, &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">ERROR</span><span style="color:#555">,</span> name<span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                    <span style="color:#09f;font-style:italic">//XLog.e(str);
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                    enqueueLog<span style="color:#555">(</span>LogLevel<span style="color:#555">.</span><span style="color:#309">ERROR</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">,</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;error - &#34;</span> <span style="color:#555">+</span> name <span style="color:#555">+</span> <span style="color:#c30">&#34; - &#34;</span> <span style="color:#555">+</span> str<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">enqueueLog</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">final</span> <span style="color:#078;font-weight:bold">int</span> logLevel<span style="color:#555">,</span> <span style="color:#069;font-weight:bold">final</span> String tag<span style="color:#555">,</span> <span style="color:#069;font-weight:bold">final</span> String message<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        logQueue<span style="color:#555">.</span><span style="color:#309">offer</span><span style="color:#555">(</span>String<span style="color:#555">.</span><span style="color:#309">format</span><span style="color:#555">(</span><span style="color:#c30">&#34;%d|%s|%s&#34;</span><span style="color:#555">,</span> logLevel<span style="color:#555">,</span> tag<span style="color:#555">,</span> message<span style="color:#555">));</span>
</span></span><span style="display:flex;"><span>        logExecutor<span style="color:#555">.</span><span style="color:#309">execute</span><span style="color:#555">(</span><span style="color:#069;font-weight:bold">new</span> Runnable<span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#99f">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">public</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">run</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                processLogQueue<span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> <span style="color:#069;font-weight:bold">static</span> <span style="color:#078;font-weight:bold">void</span> <span style="color:#c0f">processLogQueue</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">while</span> <span style="color:#555">(!</span>logQueue<span style="color:#555">.</span><span style="color:#309">isEmpty</span><span style="color:#555">())</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            String log <span style="color:#555">=</span> logQueue<span style="color:#555">.</span><span style="color:#309">poll</span><span style="color:#555">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>log <span style="color:#555">!=</span> <span style="color:#069;font-weight:bold">null</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">// 获取日志级别
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                    <span style="color:#078;font-weight:bold">int</span> logLevel <span style="color:#555">=</span> Integer<span style="color:#555">.</span><span style="color:#309">parseInt</span><span style="color:#555">(</span>log<span style="color:#555">.</span><span style="color:#309">split</span><span style="color:#555">(</span><span style="color:#c30">&#34;\\|&#34;</span><span style="color:#555">)[</span><span style="color:#f60">0</span><span style="color:#555">]);</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                    <span style="color:#09f;font-style:italic">//String tag = log.split(&#34;\\|&#34;)[1];
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                    String message <span style="color:#555">=</span> log<span style="color:#555">.</span><span style="color:#309">split</span><span style="color:#555">(</span><span style="color:#c30">&#34;\\|&#34;</span><span style="color:#555">)[</span><span style="color:#f60">2</span><span style="color:#555">];</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">// 根据不同的日志级别调用不同的 XLog 方法
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                    <span style="color:#069;font-weight:bold">switch</span> <span style="color:#555">(</span>logLevel<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                        <span style="color:#069;font-weight:bold">case</span> LogLevel<span style="color:#555">.</span><span style="color:#309">VERBOSE</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                            XLog<span style="color:#555">.</span><span style="color:#309">v</span><span style="color:#555">(</span>message<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                            <span style="color:#069;font-weight:bold">break</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#069;font-weight:bold">case</span> LogLevel<span style="color:#555">.</span><span style="color:#309">DEBUG</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                            XLog<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>message<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>                            XLog<span style="color:#555">.</span><span style="color:#309">tag</span><span style="color:#555">(</span>tag<span style="color:#555">).</span><span style="color:#309">d</span><span style="color:#555">(</span>message<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#069;font-weight:bold">break</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#069;font-weight:bold">case</span> LogLevel<span style="color:#555">.</span><span style="color:#309">INFO</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                            XLog<span style="color:#555">.</span><span style="color:#309">i</span><span style="color:#555">(</span>message<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>                            XLog<span style="color:#555">.</span><span style="color:#309">tag</span><span style="color:#555">(</span>tag<span style="color:#555">).</span><span style="color:#309">i</span><span style="color:#555">(</span>message<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#069;font-weight:bold">break</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#069;font-weight:bold">case</span> LogLevel<span style="color:#555">.</span><span style="color:#309">WARN</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                            XLog<span style="color:#555">.</span><span style="color:#309">w</span><span style="color:#555">(</span>message<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>                            XLog<span style="color:#555">.</span><span style="color:#309">tag</span><span style="color:#555">(</span>tag<span style="color:#555">).</span><span style="color:#309">w</span><span style="color:#555">(</span>message<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#069;font-weight:bold">break</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#069;font-weight:bold">case</span> LogLevel<span style="color:#555">.</span><span style="color:#309">ERROR</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                            XLog<span style="color:#555">.</span><span style="color:#309">e</span><span style="color:#555">(</span>message<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>                            XLog<span style="color:#555">.</span><span style="color:#309">tag</span><span style="color:#555">(</span>tag<span style="color:#555">).</span><span style="color:#309">e</span><span style="color:#555">(</span>message<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#069;font-weight:bold">break</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#069;font-weight:bold">default</span><span style="color:#555">:</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                            <span style="color:#09f;font-style:italic">// 默认使用 XLog.i 记录
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                            XLog<span style="color:#555">.</span><span style="color:#309">tag</span><span style="color:#555">(</span>tag<span style="color:#555">).</span><span style="color:#309">v</span><span style="color:#555">(</span>message<span style="color:#555">);</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#069;font-weight:bold">break</span><span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>Exception e<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">// 处理异常，你可以记录到其他地方或采取其他适当的措施
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                    Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;processLogQueue: Exception=&#34;</span> <span style="color:#555">+</span> e<span style="color:#555">.</span><span style="color:#309">getMessage</span><span style="color:#555">());</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><h2 id="四日志文件效果">四、日志文件效果</h2>
<p>现在来看一下日志输出的效果。</p>
<pre tabindex="0"><code class="language-log" data-lang="log">msm8953_64:/custom/metro/log/behavior # date
Tue Dec  5 13:30:22 CST 2023
msm8953_64:/custom/metro/log/behavior # ls -l
total 3640
drwx------ 2 system system    4096 2023-12-02 07:15 2023-12-02
drwx------ 2 system system    4096 2023-12-05 11:40 2023-12-05
drwx------ 2 system system    4096 2023-12-05 13:22 tmp
-rw------- 1 system system 1845644 2023-12-05 13:30 train.log
msm8953_64:/custom/metro/log/behavior # ls -l 2023
2023-12-02/  2023-12-05/
msm8953_64:/custom/metro/log/behavior # ls -l 2023-12-02
total 1632
-rw------- 1 system system 412805 2023-12-02 06:46 2023-12-02-064652.log.gz
-rw------- 1 system system 420703 2023-12-02 07:16 2023-12-02-071558.log.gz
msm8953_64:/custom/metro/log/behavior # ls -lh 2023-12-02
total 816K
-rw------- 1 system system 403K 2023-12-02 06:46 2023-12-02-064652.log.gz
-rw------- 1 system system 411K 2023-12-02 07:16 2023-12-02-071558.log.gz
msm8953_64:/custom/metro/log/behavior # tail train.log
2023-12-05 13:30:38.227 |  DEBUG  | Gbcom-log | [ LMonitorPollingService_MonitorPollingThread:UDPDcRepository:136 ], udp start send getDSCfgInfoReq - mDsObj={&#34;MsgSeqID&#34;:1701754238,&#34;MsgName&#34;:&#34;GetDSCfgInfoReq&#34;,&#34;MsgInfo&#34;:{&#34;UserID&#34;:&#34;&#34;}}
2023-12-05 13:30:38.228 |  INFO   | Gbcom-log | [ LMonitorPollingService_MonitorPollingThread:MonitorPollingThread:84 ], MonitorPollingThread, System time check - getTime=1701754238, beatTime=0, difference=600000
2023-12-05 13:30:38.230 |  INFO   | Gbcom-log | [ pool-7-thread-1:UdpDcService:244 ], UdpDcService, dis_server - data sent successfully - message=[B@9776277
2023-12-05 13:30:38.232 |  INFO   | Gbcom-log | [ LMonitorPollingService_MonitorPollingThread:MonitorPollingThread:100 ], MonitorPollingThread, DBA server timeout check - failure, TRAIN_DBA_LAST_CONNECTED=0, time=101655103, timeout=60000
2023-12-05 13:30:38.234 |  DEBUG  | Gbcom-log | [ LMonitorPollingService_MonitorPollingThread:UDPDbaRepository:332 ], TCPRepository, getNTPInfoReq()={&#34;MsgInfo&#34;:{},&#34;MsgSeqID&#34;:1701754238,&#34;MsgName&#34;:&#34;GetNTPInfoReq&#34;}
2023-12-05 13:30:38.236 |  INFO   | Gbcom-log | [ pool-6-thread-1:UdpDbaService:293 ], UdpDbaService, sendMessage() - dba_server - data sent run: message=={&#34;MsgInfo&#34;:{},&#34;MsgSeqID&#34;:1701754238,&#34;MsgName&#34;:&#34;GetNTPInfoReq&#34;}
2023-12-05 13:30:40.297 |  INFO   | Gbcom-log | [ RadioStatusScheduledTaskExecutor:UDPDbaRepository:311 ], getMasterStatusReq - jsonData={&#34;MsgInfo&#34;:{},&#34;MsgSeqID&#34;:1701754240,&#34;MsgName&#34;:&#34;GetMasterStatusReq&#34;}
2023-12-05 13:30:40.300 |  INFO   | Gbcom-log | [ pool-6-thread-2:UdpDbaService:293 ], UdpDbaService, sendMessage() - dba_server - data sent run: message=={&#34;MsgInfo&#34;:{},&#34;MsgSeqID&#34;:1701754240,&#34;MsgName&#34;:&#34;GetRadioStatusReq&#34;}
2023-12-05 13:30:40.306 |  INFO   | Gbcom-log | [ pool-6-thread-1:UdpDbaService:293 ], UdpDbaService, sendMessage() - dba_server - data sent run: message=={&#34;MsgInfo&#34;:{},&#34;MsgSeqID&#34;:1701754240,&#34;MsgName&#34;:&#34;GetMasterStatusReq&#34;}
2023-12-05 13:30:41.259 |  INFO   | Gbcom-log | [ LMonitorPollingService_MonitorPollingThread:MonitorPollingThread:158 ], MonitorPollingThread, PA server connection timeout - failure, isWork3=false, address=192.0.1.2
msm8953_64:/custom/metro/log/behavior #
</code></pre></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2023-11-30 16:31:00">更新于 2023-11-30&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"></div>
      <div class="post-info-share">
        <span></span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/%E5%8E%9F%E5%88%9B/' class="post-tag">原创</a><a href='/tags/android/' class="post-tag">android</a><a href='/tags/app%E5%BC%80%E5%8F%91/' class="post-tag">app开发</a><a href='/tags/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/' class="post-tag">日志框架</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/linux/linuxgrep/" class="post-nav-item" rel="prev" title="在linux中使用grep的几种技巧"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>在linux中使用grep的几种技巧</a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line custom">学习数理化，走遍天下都不怕</div><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.114.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.2.18"><img class="fixit-icon" src="/fixit.min.svg" alt="FixIt logo" />&nbsp;FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2013 - 2023</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div><div class="footer-line statistics"></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/lunr/lunr.min.js" defer></script><script src="/lib/lunr/lunr.stemmer.support.min.js" defer></script><script src="/lib/lunr/lunr.zh.min.js" defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":10},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":30,"type":"lunr"}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
