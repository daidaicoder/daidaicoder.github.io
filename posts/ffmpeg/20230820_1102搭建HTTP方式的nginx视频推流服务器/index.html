<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>搭建HTTP方式的nginx视频推流服务器 - 来来往往</title><meta name="author" content="">
<meta name="author-link" content="">
<meta name="description" content="搭建HTTP方式的nginx视频推流服务器" /><meta name="keywords" content='原创, nginx, 视频推流, rtmp, rtsp' /><meta itemprop="name" content="搭建HTTP方式的nginx视频推流服务器">
<meta itemprop="description" content="搭建HTTP方式的nginx视频推流服务器"><meta itemprop="datePublished" content="2023-08-20T11:02:00+08:00" />
<meta itemprop="dateModified" content="2023-08-20T11:02:00+08:00" />
<meta itemprop="wordCount" content="2288">
<meta itemprop="keywords" content="原创,android,rtmp,rtsp," /><meta property="og:title" content="搭建HTTP方式的nginx视频推流服务器" />
<meta property="og:description" content="搭建HTTP方式的nginx视频推流服务器" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://daizelai.github.io/posts/ffmpeg/20230820_1102%E6%90%AD%E5%BB%BAhttp%E6%96%B9%E5%BC%8F%E7%9A%84nginx%E8%A7%86%E9%A2%91%E6%8E%A8%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-20T11:02:00+08:00" />
<meta property="article:modified_time" content="2023-08-20T11:02:00+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="搭建HTTP方式的nginx视频推流服务器"/>
<meta name="twitter:description" content="搭建HTTP方式的nginx视频推流服务器"/>
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://daizelai.github.io/posts/ffmpeg/20230820_1102%E6%90%AD%E5%BB%BAhttp%E6%96%B9%E5%BC%8F%E7%9A%84nginx%E8%A7%86%E9%A2%91%E6%8E%A8%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8/" /><link rel="prev" href="https://daizelai.github.io/posts/android/drivers/%E5%9C%A8sc60%E6%BA%90%E7%A0%81%E4%B8%AD%E7%BC%96%E8%AF%91ko%E6%96%87%E4%BB%B6/%E5%9C%A8sc60%E6%BA%90%E7%A0%81%E4%B8%AD%E7%BC%96%E8%AF%91ko%E6%96%87%E4%BB%B6/" /><link rel="next" href="https://daizelai.github.io/posts/android/adb%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/adb%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "搭建HTTP方式的nginx视频推流服务器",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/daizelai.github.io\/posts\/ffmpeg\/20230820_1102%E6%90%AD%E5%BB%BAhttp%E6%96%B9%E5%BC%8F%E7%9A%84nginx%E8%A7%86%E9%A2%91%E6%8E%A8%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8\/"
    },"genre": "posts","keywords": "原创, android, rtmp, rtsp","wordcount":  2288 ,
    "url": "https:\/\/daizelai.github.io\/posts\/ffmpeg\/20230820_1102%E6%90%AD%E5%BB%BAhttp%E6%96%B9%E5%BC%8F%E7%9A%84nginx%E8%A7%86%E9%A2%91%E6%8E%A8%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8\/","datePublished": "2023-08-20T11:02:00+08:00","dateModified": "2023-08-20T11:02:00+08:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "daizelai"
      },"description": "搭建HTTP方式的nginx视频推流服务器"
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="wide"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="来来往往"><img loading="lazy" src="/img/logo.png" srcset="/img/logo.png, /img/logo.png 1.5x, /img/logo.png 2x" sizes="auto" data-title="来来往往" data-alt="来来往往" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">来来往往</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 首页</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 归档</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 关于我</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="来来往往"><img loading="lazy" src="/img/logo.png" srcset="/img/logo.png, /img/logo.png 1.5x, /img/logo.png 2x" sizes="auto" data-title="/img/logo.png" data-alt="/img/logo.png" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">来来往往</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 首页</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 归档</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 关于我</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container container-reverse"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>搭建HTTP方式的nginx视频推流服务器</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      daizelai</span></span>
          <span class="post-category">收录于 <a href="/categories/%E5%8E%9F%E5%88%9B/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 原创</a>&ensp;<a href="/categories/%E8%A7%86%E9%A2%91%E6%8E%A8%E6%B5%81/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 视频推流</a>&ensp;<a href="/categories/nginx/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> nginx</a>&ensp;<a href="/categories/rtmp/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> rtmp</a>&ensp;<a href="/categories/rtsp/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> rtsp</a></span></div>
      <div class="post-meta-line"><span title="发布于 2023-08-20 11:02:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2023-08-20">2023-08-20</time></span>&nbsp;<span title="更新于 2023-08-20 11:02:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2023-08-20">2023-08-20</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 2288 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 11 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#一描述">一、描述</a>
      <ul>
        <li><a href="#11前言">1.1.前言</a></li>
        <li><a href="#12实验环境">1.2.实验环境</a></li>
        <li><a href="#13温馨提示">1.3.温馨提示</a></li>
      </ul>
    </li>
    <li><a href="#二nginx下载">二、nginx下载</a>
      <ul>
        <li><a href="#21软件下载">2.1.软件下载</a></li>
        <li><a href="#22环境配置推荐">2.2.环境配置推荐</a></li>
      </ul>
    </li>
    <li><a href="#三nginx安装">三、nginx安装</a>
      <ul>
        <li><a href="#31安装方法">3.1.安装方法</a></li>
        <li><a href="#32找不到msvcr100dll问题的解决">3.2.找不到MSVCR100.dll问题的解决</a></li>
      </ul>
    </li>
    <li><a href="#四环境配置">四、环境配置</a>
      <ul>
        <li><a href="#41nginx服务器端环境">4.1.nginx服务器端环境</a></li>
        <li><a href="#42终端环境">4.2.终端环境</a></li>
      </ul>
    </li>
    <li><a href="#五运行nginx">五、运行nginx</a></li>
    <li><a href="#六推流">六、推流</a>
      <ul>
        <li><a href="#61rtmp推流">6.1.RTMP推流</a></li>
        <li><a href="#62拉流">6.2.拉流</a></li>
      </ul>
    </li>
    <li><a href="#七使用rtsp进行h264推流">七、使用RTSP进行H264推流</a>
      <ul>
        <li><a href="#71错误的h264推流">7.1.错误的H264推流</a></li>
      </ul>
    </li>
    <li><a href="#八rstp推流">八、RSTP推流</a>
      <ul>
        <li><a href="#81描述">8.1.描述</a></li>
        <li><a href="#82运行服务器">8.2.运行服务器</a></li>
        <li><a href="#83可以推拉流不能vlc播放">8.3.可以推拉流不能VLC播放</a></li>
        <li><a href="#84成功的rtsp推流方案">8.4.成功的RTSP推流方案</a></li>
        <li><a href="#85其它命令">8.5.其它命令</a></li>
      </ul>
    </li>
    <li><a href="#九使用vlc搭建rstp推流环境简易的rtsp推流环境">九、使用VLC搭建RSTP推流环境【简易的RTSP推流环境】</a>
      <ul>
        <li><a href="#91打开流菜单">9.1.打开流菜单</a></li>
        <li><a href="#92配置文件选项">9.2.配置文件选项</a></li>
        <li><a href="#93配置流输出">9.3.配置流输出</a></li>
        <li><a href="#94拉流播放">9.4.拉流播放</a></li>
      </ul>
    </li>
    <li><a href="#十成功的一次rtsp推拉流rtsp推流成功">十、成功的一次RTSP推拉流【RTSP推流成功】</a>
      <ul>
        <li><a href="#101描述">10.1.描述</a></li>
        <li><a href="#102运行服务器">10.2.运行服务器</a></li>
        <li><a href="#103推流">10.3.推流</a></li>
        <li><a href="#104ffplay拉流">10.4.ffplay拉流</a></li>
        <li><a href="#105vlc拉流">10.5.VLC拉流</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="一描述">一、描述</h2>
<h3 id="11前言">1.1.前言</h3>
<p>搭建TCP/HTTP协议的nginx视频推流服务器，主要推RTMP和RTSP两种流。</p>
<h3 id="12实验环境">1.2.实验环境</h3>
<p>10:35，我的笔记本地址如果在7楼配置：</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">IP:172.16.120.222
MASK:255.255.255.0
GateWay:172.16.120.1
</code></pre><p>我的笔记本地址如果在4楼配置：</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">IP:192.168.19.7
MASK:255.255.255.0
GateWay:192.168.19.1
</code></pre><h3 id="13温馨提示">1.3.温馨提示</h3>
<ul>
<li>本文有点杂乱，其实你也可以直接看第六章【RTMP】、第九章【RTSP】和第十章【RTSP】就可以了。</li>
<li>另外，第十章的mediamtx其实也可以接收推的RTMP流哦。</li>
</ul>
<h2 id="二nginx下载">二、nginx下载</h2>
<h3 id="21软件下载">2.1.软件下载</h3>
<p>nginx下载地址：http://nginx-win.ecsds.eu/download/</p>
<p>nginx-rtmp-module下载地址：https://github.com/arut/nginx-rtmp-module/</p>
<p>ffmpeg官方地址：http://ffmpeg.org/download.html?aemtn=tg-on#repositories
ffmpeg下载地址：https://github.com/BtbN/FFmpeg-Builds/releases
请下载【ffmpeg-master-latest-win64-gpl.zip】版本，里面带x264。</p>
<h3 id="22环境配置推荐">2.2.环境配置推荐</h3>
<p>下面是推荐的环境配置：</p>
<blockquote>
<p>RTMP环境</p>
</blockquote>
<p><a href="./file/nginx1.7.11.3Gryphon_dai.rar">nginx 1.7.11.3 Gryphon_dai.rar</a>
<a href="https://www.gyan.dev/ffmpeg/builds/ffmpeg-git-full.7z"target="_blank" rel="external nofollow noopener noreferrer">ffmpeg-git-full.7z</a></p>
<blockquote>
<p>RTSP环境</p>
</blockquote>
<p><a href="https://github.com/bluenviron/mediamtx/releases"target="_blank" rel="external nofollow noopener noreferrer">RTSP推流服务器环境 mediamtx_v1.0.0_windows_amd64.zip</a>
<a href="https://www.gyan.dev/ffmpeg/builds/ffmpeg-git-full.7z"target="_blank" rel="external nofollow noopener noreferrer">ffmpeg-git-full.7z</a></p>
<h2 id="三nginx安装">三、nginx安装</h2>
<h3 id="31安装方法">3.1.安装方法</h3>
<p>Windows下载下来可以直接使用。</p>
<h3 id="32找不到msvcr100dll问题的解决">3.2.找不到MSVCR100.dll问题的解决</h3>
<p>16：06，nginx.exe 由于找不到MSVCR100.dll，无法继续执行代码。重新安装程序可能会解决此问题。
使用DirectX修复工具进行修复，修复了好个182个丢失的文件。</p>
<p>浏览器访问：http://127.0.0.1/</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>Welcome to nginx!
</span></span><span style="display:flex;"><span>If you see this page, the nginx web server is successfully installed and working. Further configuration is required.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>For online documentation and support please refer to nginx.org.
</span></span><span style="display:flex;"><span>Commercial support is available at nginx.com.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Windows documentation and support is available at nginx for Windows.
</span></span><span style="display:flex;"><span>Windows commercial support is available at ITProjectPartner.
</span></span><span style="display:flex;"><span>Thank you for using nginx.
</span></span></code></pre></div><h2 id="四环境配置">四、环境配置</h2>
<h3 id="41nginx服务器端环境">4.1.nginx服务器端环境</h3>
<p>笔记本在7楼使用网络连接DIS的交换机上，配置了和DIS同一网段的地址。</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">C:\Users\daizelai&gt;ipconfig

Windows IP 配置


以太网适配器 以太网:

   连接特定的 DNS 后缀 . . . . . . . :
   本地链接 IPv6 地址. . . . . . . . : fe80::3c84:252a:7ebe:9767%17
   IPv4 地址 . . . . . . . . . . . . : 172.16.120.222
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   IPv4 地址 . . . . . . . . . . . . : 192.168.19.7
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . : 172.16.120.1

无线局域网适配器 WLAN:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :

无线局域网适配器 本地连接* 9:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :

无线局域网适配器 本地连接* 10:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :

以太网适配器 VMware Network Adapter VMnet1:

   连接特定的 DNS 后缀 . . . . . . . :
   本地链接 IPv6 地址. . . . . . . . : fe80::25d0:6d3b:2e4a:6fae%7
   IPv4 地址 . . . . . . . . . . . . : 192.168.80.1
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . : 10.60.3.59

以太网适配器 蓝牙网络连接:

   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
   连接特定的 DNS 后缀 . . . . . . . :

C:\Users\daizelai&gt;
</code></pre><p>并且ping DIS是可以拼通的。</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">C:\Users\daizelai&gt;ping 172.16.120.52

正在 Ping 172.16.120.52 具有 32 字节的数据:
来自 172.16.120.52 的回复: 字节=32 时间=1ms TTL=64
来自 172.16.120.52 的回复: 字节=32 时间=2ms TTL=64
来自 172.16.120.52 的回复: 字节=32 时间=1ms TTL=64
来自 172.16.120.52 的回复: 字节=32 时间=1ms TTL=64

172.16.120.52 的 Ping 统计信息:
    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
    最短 = 1ms，最长 = 2ms，平均 = 1ms

C:\Users\daizelai&gt;ping 172.16.120.8

正在 Ping 172.16.120.8 具有 32 字节的数据:
来自 172.16.120.8 的回复: 字节=32 时间=1ms TTL=64
来自 172.16.120.8 的回复: 字节=32 时间=1ms TTL=64
来自 172.16.120.8 的回复: 字节=32 时间=1ms TTL=64
来自 172.16.120.8 的回复: 字节=32 时间=1ms TTL=64

172.16.120.8 的 Ping 统计信息:
    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
    最短 = 1ms，最长 = 1ms，平均 = 1ms

C:\Users\daizelai&gt;
</code></pre><h3 id="42终端环境">4.2.终端环境</h3>
<p>下面是主机的通信板WAN口地址</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">C:\Users\daizelai&gt;ping 10.178.14.8

正在 Ping 10.178.14.8 具有 32 字节的数据:
来自 10.178.14.8 的回复: 字节=32 时间=19ms TTL=55
来自 10.178.14.8 的回复: 字节=32 时间=66ms TTL=55
来自 10.178.14.8 的回复: 字节=32 时间=171ms TTL=55
来自 10.178.14.8 的回复: 字节=32 时间=113ms TTL=55

10.178.14.8 的 Ping 统计信息:
    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
    最短 = 19ms，最长 = 171ms，平均 = 92ms

C:\Users\daizelai&gt;
</code></pre><h2 id="五运行nginx">五、运行nginx</h2>
<p>16:48，启动</p>
<p>第一个版本是 <a href="./file/nginx_1.7.11.3_Gryphon.7z">nginx_1.7.11.3_Gryphon.7z</a>，这个版本运行起来是有问题的。</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">D:\program\nginx\rtmpServer\Gryphon\nginx.exe -c D:\program\nginx\rtmpServer\Gryphon\conf\nginx.conf
</code></pre><p>后面又下载了 <a href="./file/nginx1.7.11.3Gryphon_dai.rar">nginx 1.7.11.3 Gryphon_dai.rar</a>，这个版本的是可以正常的。</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">c:\&gt;cd D:\program\nginx\rtmpServer\Gryphon_dai
D:\program\nginx\rtmpServer\Gryphon_dai&gt;nginx.exe -c conf\nginx-win-rtmp.conf
D:\program\nginx\rtmpServer\Gryphon_dai&gt;
</code></pre><h2 id="六推流">六、推流</h2>
<h3 id="61rtmp推流">6.1.RTMP推流</h3>
<p>第一个不好的推流ffmpeg <a href="./file/ffmpeg-n6.0-latest-win64-lgpl-shared-6.0.zip">ffmpeg-n6.0-latest-win64-lgpl-shared-6.0.zip</a>，也可以用的。</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">cd D:\program\nginx\ffmpeg-n6.0-latest-win64-lgpl-shared-6.0\bin
ffmpeg.exe -re -i D:\program\nginx\86319e21c91550ffc57d617ce21ea593.mp4 -f flv rtmp://192.168.19.7:1935/live/test
</code></pre><h3 id="62拉流">6.2.拉流</h3>
<p>使用ffplay.exe进行拉流。</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">C:\Users\daizelai\Downloads\ffplay.exe rtmp://192.168.19.7:1935/live/home
</code></pre><h2 id="七使用rtsp进行h264推流">七、使用RTSP进行H264推流</h2>
<h3 id="71错误的h264推流">7.1.错误的H264推流</h3>
<p>注意上面的<a href="./file/ffmpeg-n6.0-latest-win64-lgpl-shared-6.0.zip">ffmpeg-n6.0-latest-win64-lgpl-shared-6.0.zip</a>版本的ffmpeg推H264流格式流的话，会提示“未安装libx264”错误。</p>
<p>2023/08/15 10:20推流出错</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">D:\program\nginx\ffmpeg-n6.0-latest-win64-lgpl-shared-6.0\bin&gt;ffmpeg.exe -i D:\program\nginx\86319e21c91550ffc57d617ce21ea593.mp4 -c:v libx264 -preset ultrafast -tune zerolatency -b:v 500k -f rtsp rtsp://192.168.43.52:8554/stream
ffmpeg version n6.0-34-g3d5edb89e7-20230813 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 13.1.0 (crosstool-NG 1.25.0.196_227d99d)
  configuration: --prefix=/ffbuild/prefix --pkg-config-flags=--static --pkg-config=pkg-config --cross-prefix=x86_64-w64-mingw32- --arch=x86_64 --target-os=mingw32 --enable-version3 --disable-debug --enable-shared --disable-static --disable-w32threads --enable-pthreads --enable-iconv --enable-libxml2 --enable-zlib --enable-libfreetype --enable-libfribidi --enable-gmp --enable-lzma --enable-fontconfig --enable-libvorbis --enable-opencl --disable-libpulse --enable-libvmaf --disable-libxcb --disable-xlib --enable-amf --enable-libaom --enable-libaribb24 --disable-avisynth --enable-chromaprint --enable-libdav1d --disable-libdavs2 --disable-libfdk-aac --enable-ffnvcodec --enable-cuda-llvm --disable-frei0r --enable-libgme --enable-libkvazaar --enable-libass --enable-libbluray --disable-libjxl --enable-libmp3lame --enable-libopus --enable-librist --enable-libssh --enable-libtheora --enable-libvpx --enable-libwebp --enable-lv2 --enable-libvpl --enable-openal --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libopenh264 --enable-libopenjpeg --enable-libopenmpt --enable-librav1e --disable-librubberband --enable-schannel --enable-sdl2 --enable-libsoxr --enable-libsrt --enable-libsvtav1 --enable-libtwolame --enable-libuavs3d --disable-libdrm --disable-vaapi --disable-libvidstab --enable-vulkan --enable-libshaderc --disable-libplacebo --disable-libx264 --disable-libx265 --disable-libxavs2 --disable-libxvid --enable-libzimg --enable-libzvbi --extra-cflags=-DLIBTWOLAME_STATIC --extra-cxxflags= --extra-ldflags=-pthread --extra-ldexeflags= --extra-libs=-lgomp --extra-version=20230813
  libavutil      58.  2.100 / 58.  2.100
  libavcodec     60.  3.100 / 60.  3.100
  libavformat    60.  3.100 / 60.  3.100
  libavdevice    60.  1.100 / 60.  1.100
  libavfilter     9.  3.100 /  9.  3.100
  libswscale      7.  1.100 /  7.  1.100
  libswresample   4. 10.100 /  4. 10.100
Input #0, mov,mp4,m4a,3gp,3g2,mj2, from &#39;D:\program\nginx\86319e21c91550ffc57d617ce21ea593.mp4&#39;:
  Metadata:
    major_brand     : isom
    minor_version   : 512
    compatible_brands: isomiso2avc1mp41
    encoder         : Lavf58.20.100
  Duration: 00:01:08.30, start: 0.000000, bitrate: 1657 kb/s
  Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuv420p(progressive), 1280x720, 1603 kb/s, 30 fps, 30 tbr, 15360 tbn (default)
    Metadata:
      handler_name    : VideoHandler
      vendor_id       : [0][0][0][0]
  Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, mono, fltp, 47 kb/s (default)
    Metadata:
      handler_name    : SoundHandler
      vendor_id       : [0][0][0][0]
[vost#0:0 @ 000001edf0670cc0] Unknown encoder &#39;libx264&#39;

D:\program\nginx\ffmpeg-n6.0-latest-win64-lgpl-shared-6.0\bin&gt;     
</code></pre><p>因为未安装libx264库，导致在生成mp4视频的时候出错。</p>
<p>但是使用<code>ffmpeg-master-latest-win64-gpl</code>推流是可以的。
而使用<code>ffmpeg-n6.0-latest-win64-lgpl-shared-6.0.zip</code>进行下面两种推流都是提示错误的。</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">ffmpeg.exe -re -i D:\program\nginx\86319e21c91550ffc57d617ce21ea593.mp4 -vcodec libx264 -acodec aac -f flv rtmp://localhost:1935/rtmplive/home
ffmpeg.exe -i D:\program\nginx\86319e21c91550ffc57d617ce21ea593.mp4 -c:v libx264 -preset ultrafast -tune zerolatency -b:v 500k -f rtsp rtsp://192.168.43.52:8554/stream
</code></pre><h2 id="八rstp推流">八、RSTP推流</h2>
<h3 id="81描述">8.1.描述</h3>
<p>使用mediamtx搭建RTSP流媒体服务器。</p>
<p>10:51, RTSP:https://github.com/bluenviron/mediamtx/releases，下载了mediamtx_v1.0.0_windows_amd64.zip文件</p>
<p><a href="https://github.com/bluenviron/mediamtx/releases"target="_blank" rel="external nofollow noopener noreferrer">下载RTSP流流 mediamtx_v1.0.0_windows_amd64.zip</a></p>
<h3 id="82运行服务器">8.2.运行服务器</h3>
<p>解压之后根据自己需要修改其yml配置文件。</p>
<p>执行启动命令：</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">D:\program\nginx\rtmpServer\Gryphon_dai&gt;D:\program\nginx\mediamtx_v1.0.0_windows_amd64\mediamtx.exe
2023/08/15 10:56:02 INF MediaMTX v1.0.0
2023/08/15 10:56:02 WAR configuration file not found, using an empty configuration
2023/08/15 10:56:02 INF [RTSP] listener opened on :8554 (TCP), :8000 (UDP/RTP), :8001 (UDP/RTCP)
2023/08/15 10:56:02 INF [RTMP] listener opened on :1935
2023/08/15 10:56:02 INF [HLS] listener opened on :8888
2023/08/15 10:56:02 INF [WebRTC] listener opened on :8889 (HTTP)
2023/08/15 10:56:02 INF [SRT] listener opened on :8890 (UDP)
</code></pre><h3 id="83可以推拉流不能vlc播放">8.3.可以推拉流不能VLC播放</h3>
<p>下面的可以，但VLC不能播放：
监听目标端口：</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">ffplay -rtsp_flags listen -i rtsp://localhost:8888/live.sdp
</code></pre><p>使用ffmpeg推流</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">ffmpeg.exe -re -r 30 -i D:\program\nginx\2270605199.mp4 -codec copy -an -f rtsp -muxdelay 0  -rtsp_transport tcp rtsp://localhost:8888/live.sdp
</code></pre><p>监听目标端口：</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">ffplay -rtsp_flags listen -i rtsp://127.0.0.1:8554/stream1
</code></pre><p>使用ffmpeg推流</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">ffmpeg.exe -re -stream_loop -1 -i D:\program\nginx\2270605199.mp4 -vcodec h264 -codec copy -f rtsp -rtsp_transport tcp rtsp://127.0.0.1:8554/stream1
ffmpeg.exe -re -stream_loop -1 -i D:\program\nginx\2270605199.mp4 -vcodec h264 -codec copy -f rtsp -rtsp_transport udp rtsp://127.0.0.1:8554/stream1
</code></pre><h3 id="84成功的rtsp推流方案">8.4.成功的RTSP推流方案</h3>
<p>执行ffmpeg推流失败问题解决</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">D:\program\nginx\ffmpeg-master-latest-win64-gpl\bin&gt;ffmpeg.exe -re -stream_loop -1 -i D:\program\nginx\2270605199.mp4 -vcodec h264 -codec copy -f rtsp -rtsp_transport udp rtsp://127.0.0.1:8554/stream1
ffmpeg version N-111765-gc704901324-20230814 Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 13.1.0 (crosstool-NG 1.25.0.196_227d99d)
  configuration: --prefix=/ffbuild/prefix --pkg-config-flags=--static --pkg-config=pkg-config --cross-prefix=x86_64-w64-mingw32- --arch=x86_64 --target-os=mingw32 --enable-gpl --enable-version3 --disable-debug --disable-w32threads --enable-pthreads --enable-iconv --enable-libxml2 --enable-zlib --enable-libfreetype --enable-libfribidi --enable-gmp --enable-lzma --enable-fontconfig --enable-libvorbis --enable-opencl --disable-libpulse --enable-libvmaf --disable-libxcb --disable-xlib --enable-amf --enable-libaom --enable-libaribb24 --enable-avisynth --enable-chromaprint --enable-libdav1d --enable-libdavs2 --disable-libfdk-aac --enable-ffnvcodec --enable-cuda-llvm --enable-frei0r --enable-libgme --enable-libkvazaar --enable-libass --enable-libbluray --enable-libjxl --enable-libmp3lame --enable-libopus --enable-librist --enable-libssh --enable-libtheora --enable-libvpx --enable-libwebp --enable-lv2 --enable-libvpl --enable-openal --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libopenh264 --enable-libopenjpeg --enable-libopenmpt --enable-librav1e --enable-librubberband --enable-schannel --enable-sdl2 --enable-libsoxr --enable-libsrt --enable-libsvtav1 --enable-libtwolame --enable-libuavs3d --disable-libdrm --disable-vaapi --enable-libvidstab --enable-vulkan --enable-libshaderc --enable-libplacebo --enable-libx264 --enable-libx265 --enable-libxavs2 --enable-libxvid --enable-libzimg --enable-libzvbi --extra-cflags=-DLIBTWOLAME_STATIC --extra-cxxflags= --extra-ldflags=-pthread --extra-ldexeflags= --extra-libs=-lgomp --extra-version=20230814
  libavutil      58. 16.101 / 58. 16.101
  libavcodec     60. 23.100 / 60. 23.100
  libavformat    60. 10.100 / 60. 10.100
  libavdevice    60.  2.101 / 60.  2.101
  libavfilter     9. 11.100 /  9. 11.100
  libswscale      7.  3.100 /  7.  3.100
  libswresample   4. 11.100 /  4. 11.100
  libpostproc    57.  2.100 / 57.  2.100
Input #0, mov,mp4,m4a,3gp,3g2,mj2, from &#39;D:\program\nginx\2270605199.mp4&#39;:
  Metadata:
    major_brand     : isom
    minor_version   : 512
    compatible_brands: isomiso2avc1mp41
    encoder         : Lavf58.76.100
    comment         : zy-libx264,vid:2270605199
  Duration: 00:08:41.28, start: 0.000000, bitrate: 797 kb/s
  Stream #0:0[0x1](und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(progressive), 960x600 [SAR 1:1 DAR 8:5], 662 kb/s, 25 fps, 25 tbr, 90k tbn (default)
    Metadata:
      handler_name    : VideoHandler
      vendor_id       : [0][0][0][0]
      encoder         : Lavc58.134.100 libwz264
  Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 128 kb/s (default)
    Metadata:
      handler_name    : SoundHandler
      vendor_id       : [0][0][0][0]
Multiple -c, -codec, -acodec, -vcodec, -scodec or -dcodec options specified for stream 0, only the last option &#39;-c copy&#39; will be used.
[out#0/rtsp @ 000001526f876c00] Could not write header (incorrect codec parameters ?): Server returned 400 Bad Request
Error opening output file rtsp://127.0.0.1:8554/stream1.
Error opening output files: Server returned 400 Bad Request

D:\program\nginx\ffmpeg-master-latest-win64-gpl\bin&gt;
</code></pre><p>12:17，问题解决有两个方案，推荐两个方案：</p>
<h4 id="841方案一">8.4.1.方案一</h4>
<p>不要加端口rtsp://127.0.0.1/stream1</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">ffmpeg.exe -re -stream_loop -1 -i D:\program\nginx\2270605199.mp4 -vcodec h264 -codec copy -f rtsp -rtsp_transport udp rtsp://127.0.0.1/stream1
</code></pre><h4 id="842方案二">8.4.2.方案二</h4>
<p>先使用ffplay监听指定端口，再使用ffmpeg推流。</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">a. D:\program\nginx\ffmpeg-master-latest-win64-gpl\bin&gt;ffplay -rtsp_flags listen -i rtsp://127.0.0.1:8554/stream1
b. D:\program\nginx\ffmpeg-master-latest-win64-gpl\bin&gt;ffmpeg.exe -re -stream_loop -1 -i D:\program\nginx\2270605199.mp4 -vcodec h264 -codec copy -f rtsp -rtsp_transport udp rtsp://127.0.0.1:8554/stream1
</code></pre><h4 id="843完整的ffmpeg">8.4.3.完整的ffmpeg</h4>
<p>最好下载完整版的ffmpeg，执行ffmpeg的时候，就不会缺这个，少那个了。</p>
<p>12：58，下载https://www.gyan.dev/ffmpeg/builds/
<a href="https://www.gyan.dev/ffmpeg/builds/ffmpeg-git-full.7z"target="_blank" rel="external nofollow noopener noreferrer">ffmpeg-git-full.7z</a></p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">ffmpeg -re -stream_loop -1 -i D:\program\nginx\2270605199.mp4 -c copy -f rtsp rtsp://192.168.19.7:8554/video
</code></pre><h3 id="85其它命令">8.5.其它命令</h3>
<p>下面的命令有些未经过测试的，不保证运行成功。</p>
<p>录制电脑屏幕并推流到服务器。</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">ffmpeg -f gdigrab -i desktop -vcodec libx264 -preset:v ultrafast -tune:v zerolatency -f rtsp rtsp://192.168.80.49:8554/mystream
</code></pre><p>下面是TCP推流：</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">ffmpeg -re -i input.mp4 -c copy -rtsp_transport tcp -f rtsp rtsp://127.0.0.1:8554/stream
</code></pre><p>下面是UDP推流：</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">ffmpeg -re -i input.mp4 -c copy -f rtsp rtsp://127.0.0.1:8554/stream
</code></pre><p>拉流：</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">ffplay rtsp://127.0.0.1:8554/stream
</code></pre><h2 id="九使用vlc搭建rstp推流环境简易的rtsp推流环境">九、使用VLC搭建RSTP推流环境【简易的RTSP推流环境】</h2>
<h3 id="91打开流菜单">9.1.打开流菜单</h3>
<p>使用<code>VLC</code>播放器的<code>File</code>菜单中的<code>流</code>菜单。</p>
<h3 id="92配置文件选项">9.2.配置文件选项</h3>
<p>在<code>文件</code>选项中，添加<code>添加</code>按钮，添加mp4视频文件进来，同时点击<code>串流</code>按钮。</p>
<h3 id="93配置流输出">9.3.配置流输出</h3>
<ul>
<li>点击<code>串流</code>按钮后，在弹出窗口中可以直接点击下一步，来目标输出页。</li>
<li>在<code>新目标</code>处选择<code>RTSP</code>，并且点击后面的<code>添加</code>按钮，</li>
<li>在此配置页中配置端口<code>8554</code>和路径<code>/</code>,可以添加个后缀如<code>/mp4</code>。</li>
<li>在转码选项页中，对配置文件选择<code>Video - H.264 + MP3（MP4）</code>，然后点击下一步。</li>
<li>再点击<code>流</code>，则VLC开始推流了。</li>
</ul>
<h3 id="94拉流播放">9.4.拉流播放</h3>
<p>可以在局域网或可ping的网络中，使用VLC进行拉流播放，打开VLC，选择File菜单中的<code>打开网络串流...</code>，地址配置<code>rtsp://推流电脑IP地址:8554/mp4</code>。
提醒：默认使用rtsp这种试的话，使用的就是UDP协议的。</p>
<h2 id="十成功的一次rtsp推拉流rtsp推流成功">十、成功的一次RTSP推拉流【RTSP推流成功】</h2>
<h3 id="101描述">10.1.描述</h3>
<p>在2023/08/20 13:01时测试实现推拉流测试。</p>
<p>下面是效果图：</p>
<p><figure><a class="lightgallery" href="./images/rstp_2023-08-20_125028.png" data-thumbnail="./images/rstp_2023-08-20_125028.png" data-sub-html="<h2>推拉流效果图</h2><p>推拉流效果图</p>"><img loading="lazy" src="./images/rstp_2023-08-20_125028.png" srcset="./images/rstp_2023-08-20_125028.png, ./images/rstp_2023-08-20_125028.png 1.5x, ./images/rstp_2023-08-20_125028.png 2x" sizes="auto" data-title="推拉流效果图" data-alt="推拉流效果图" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></a><figcaption class="image-caption">推拉流效果图</figcaption>
  </figure></p>
<h3 id="102运行服务器">10.2.运行服务器</h3>
<pre tabindex="0"><code class="language-dos" data-lang="dos">D:\program\nginx\mediamtx_v1.0.0_windows_amd64&gt;date
当前日期: 2023/08/20 周日
输入新日期: (年月日)

D:\program\nginx\mediamtx_v1.0.0_windows_amd64&gt;time
当前时间: 13:03:30.70
输入新时间:

D:\program\nginx\mediamtx_v1.0.0_windows_amd64&gt;mediamtx.exe
2023/08/20 13:03:32 INF MediaMTX v1.0.0
2023/08/20 13:03:32 INF [RTSP] listener opened on :8554 (TCP), :8000 (UDP/RTP), :8001 (UDP/RTCP)
2023/08/20 13:03:32 INF [RTMP] listener opened on :1935
2023/08/20 13:03:32 INF [HLS] listener opened on :8888
2023/08/20 13:03:32 INF [WebRTC] listener opened on :8889 (HTTP)
2023/08/20 13:03:32 INF [SRT] listener opened on :8890 (UDP)
2023/08/20 13:03:46 INF [RTSP] [conn [::1]:52661] opened
2023/08/20 13:03:46 INF [RTSP] [session 44c149af] created by [::1]:52661
# 使用ffmpeg推流日志
2023/08/20 13:03:46 INF [RTSP] [session 44c149af] is publishing to path &#39;mystream&#39;, 2 tracks (H264, MPEG-4 Audio)
# 使用ffplay拉流日志
2023/08/20 13:03:52 INF [RTSP] [conn [::1]:52662] opened
2023/08/20 13:03:52 INF [RTSP] [session c6349b1b] created by [::1]:52662
2023/08/20 13:03:52 INF [RTSP] [session c6349b1b] is reading from path &#39;mystream&#39;, with UDP, 2 tracks (H264, MPEG-4 Audio)
# 关闭了ffplay拉流弹出的播放器，停止拉流
2023/08/20 13:03:58 INF [RTSP] [conn [::1]:52662] closed (EOF)
# 下面的日志是按CTRL+C停止了本次mediamtx.exe服务的日志
2023/08/20 13:04:03 INF shutting down gracefully
2023/08/20 13:04:03 INF [SRT] listener is closing
2023/08/20 13:04:03 INF [WebRTC] listener is closing
2023/08/20 13:04:03 INF [HLS] listener is closing
2023/08/20 13:04:03 INF [RTMP] listener is closing
2023/08/20 13:04:03 INF [RTSP] listener is closing
2023/08/20 13:04:03 INF [RTSP] [session c6349b1b] destroyed (terminated)
2023/08/20 13:04:03 INF [RTSP] [conn [::1]:52661] closed (terminated)
2023/08/20 13:04:03 INF [RTSP] [session 44c149af] destroyed (terminated)
2023/08/20 13:04:03 INF waiting for external commands

D:\program\nginx\mediamtx_v1.0.0_windows_amd64&gt;
</code></pre><h3 id="103推流">10.3.推流</h3>
<p>使用完整版本的ffmpeg进行推流。
使用<code>D:\program\nginx\ffmpeg-2023-08-14-git-c704901324-full_build\bin&gt;ffmpeg.exe -re -stream_loop -1 -i D:\program\nginx\2270605199.mp4 -vcodec h264 -c copy -f rtsp -rtsp_transport udp rtsp://localhost:8554/mystream</code>进行推流，未指定UDP，但是其实你看<code>mediamtx.exe</code>，它也是UDP协议的。</p>
<p>当然，使用<code>D:\program\nginx\ffmpeg-2023-08-14-git-c704901324-full_build\bin&gt;ffmpeg.exe -re -stream_loop -1 -i D:\program\nginx\2270605199.mp4 -vcodec h264 -c copy -f rtsp -rtsp_transport udp rtsp://localhost:8554/mystream</code>推流也是可以的。</p>
<p>下成是是在Windows上执行推流命令的记录：</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">D:\program\nginx\ffmpeg-2023-08-14-git-c704901324-full_build\bin&gt;ffmpeg.exe -re -stream_loop -1 -i D:\program\nginx\2270605199.mp4 -c copy -f rtsp rtsp://localhost:8554/mystream
ffmpeg version 2023-08-14-git-c704901324-full_build-www.gyan.dev Copyright (c) 2000-2023 the FFmpeg developers
  built with gcc 12.2.0 (Rev10, Built by MSYS2 project)
  configuration: --enable-gpl --enable-version3 --enable-static --disable-w32threads --disable-autodetect --enable-fontconfig --enable-iconv --enable-gnutls --enable-libxml2 --enable-gmp --enable-bzlib --enable-lzma --enable-libsnappy --enable-zlib --enable-librist --enable-libsrt --enable-libssh --enable-libzmq --enable-avisynth --enable-libbluray --enable-libcaca --enable-sdl2 --enable-libaribb24 --enable-libaribcaption --enable-libdav1d --enable-libdavs2 --enable-libuavs3d --enable-libzvbi --enable-librav1e --enable-libsvtav1 --enable-libwebp --enable-libx264 --enable-libx265 --enable-libxavs2 --enable-libxvid --enable-libaom --enable-libjxl --enable-libopenjpeg --enable-libvpx --enable-mediafoundation --enable-libass --enable-frei0r --enable-libfreetype --enable-libfribidi --enable-libharfbuzz --enable-liblensfun --enable-libvidstab --enable-libvmaf --enable-libzimg --enable-amf --enable-cuda-llvm --enable-cuvid --enable-ffnvcodec --enable-nvdec --enable-nvenc --enable-d3d11va --enable-dxva2 --enable-libvpl --enable-libshaderc --enable-vulkan --enable-libplacebo --enable-opencl --enable-libcdio --enable-libgme --enable-libmodplug --enable-libopenmpt --enable-libopencore-amrwb --enable-libmp3lame --enable-libshine --enable-libtheora --enable-libtwolame --enable-libvo-amrwbenc --enable-libcodec2 --enable-libilbc --enable-libgsm --enable-libopencore-amrnb --enable-libopus --enable-libspeex --enable-libvorbis --enable-ladspa --enable-libbs2b --enable-libflite --enable-libmysofa --enable-librubberband --enable-libsoxr --enable-chromaprint
  libavutil      58. 16.101 / 58. 16.101
  libavcodec     60. 23.100 / 60. 23.100
  libavformat    60. 10.100 / 60. 10.100
  libavdevice    60.  2.101 / 60.  2.101
  libavfilter     9. 11.100 /  9. 11.100
  libswscale      7.  3.100 /  7.  3.100
  libswresample   4. 11.100 /  4. 11.100
  libpostproc    57.  2.100 / 57.  2.100
Input #0, mov,mp4,m4a,3gp,3g2,mj2, from &#39;D:\program\nginx\2270605199.mp4&#39;:
  Metadata:
    major_brand     : isom
    minor_version   : 512
    compatible_brands: isomiso2avc1mp41
    encoder         : Lavf58.76.100
    comment         : zy-libx264,vid:2270605199
  Duration: 00:08:41.28, start: 0.000000, bitrate: 797 kb/s
  Stream #0:0[0x1](und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(progressive), 960x600 [SAR 1:1 DAR 8:5], 662 kb/s, 25 fps, 25 tbr, 90k tbn (default)
    Metadata:
      handler_name    : VideoHandler
      vendor_id       : [0][0][0][0]
      encoder         : Lavc58.134.100 libwz264
  Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 128 kb/s (default)
    Metadata:
      handler_name    : SoundHandler
      vendor_id       : [0][0][0][0]
Output #0, rtsp, to &#39;rtsp://localhost:8554/mystream&#39;:
  Metadata:
    major_brand     : isom
    minor_version   : 512
    compatible_brands: isomiso2avc1mp41
    comment         : zy-libx264,vid:2270605199
    encoder         : Lavf60.10.100
  Stream #0:0(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(progressive), 960x600 [SAR 1:1 DAR 8:5], q=2-31, 662 kb/s, 25 fps, 25 tbr, 90k tbn (default)
    Metadata:
      handler_name    : VideoHandler
      vendor_id       : [0][0][0][0]
      encoder         : Lavc58.134.100 libwz264
  Stream #0:1(und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 128 kb/s (default)
    Metadata:
      handler_name    : SoundHandler
      vendor_id       : [0][0][0][0]
Stream mapping:
  Stream #0:0 -&gt; #0:0 (copy)
  Stream #0:1 -&gt; #0:1 (copy)
Press [q] to stop, [?] for help
[out#0/rtsp @ 000001982c7dd400] video:44124kB audio:8513kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: unknown
frame=13590 fps= 25 q=-1.0 Lsize=N/A time=00:09:03.52 bitrate=N/A speed=   1x
Exiting normally, received signal 2.

D:\program\nginx\ffmpeg-2023-08-14-git-c704901324-full_build\bin&gt;
</code></pre><p>注意：推流指定的地址中的<code>mystream</code>，是可以自己随便指定的，只要拉流的时候是相同的地址就可以了。</p>
<h3 id="104ffplay拉流">10.4.ffplay拉流</h3>
<p>下面是在Windows命令使用ffplay拉流：</p>
<pre tabindex="0"><code class="language-dos" data-lang="dos">D:\program\nginx\ffmpeg-2023-08-14-git-c704901324-full_build\bin&gt;ffplay.exe rtsp://localhost:8554/mystream
ffplay version 2023-08-14-git-c704901324-full_build-www.gyan.dev Copyright (c) 2003-2023 the FFmpeg developers
  built with gcc 12.2.0 (Rev10, Built by MSYS2 project)
  configuration: --enable-gpl --enable-version3 --enable-static --disable-w32threads --disable-autodetect --enable-fontconfig --enable-iconv --enable-gnutls --enable-libxml2 --enable-gmp --enable-bzlib --enable-lzma --enable-libsnappy --enable-zlib --enable-librist --enable-libsrt --enable-libssh --enable-libzmq --enable-avisynth --enable-libbluray --enable-libcaca --enable-sdl2 --enable-libaribb24 --enable-libaribcaption --enable-libdav1d --enable-libdavs2 --enable-libuavs3d --enable-libzvbi --enable-librav1e --enable-libsvtav1 --enable-libwebp --enable-libx264 --enable-libx265 --enable-libxavs2 --enable-libxvid --enable-libaom --enable-libjxl --enable-libopenjpeg --enable-libvpx --enable-mediafoundation --enable-libass --enable-frei0r --enable-libfreetype --enable-libfribidi --enable-libharfbuzz --enable-liblensfun --enable-libvidstab --enable-libvmaf --enable-libzimg --enable-amf --enable-cuda-llvm --enable-cuvid --enable-ffnvcodec --enable-nvdec --enable-nvenc --enable-d3d11va --enable-dxva2 --enable-libvpl --enable-libshaderc --enable-vulkan --enable-libplacebo --enable-opencl --enable-libcdio --enable-libgme --enable-libmodplug --enable-libopenmpt --enable-libopencore-amrwb --enable-libmp3lame --enable-libshine --enable-libtheora --enable-libtwolame --enable-libvo-amrwbenc --enable-libcodec2 --enable-libilbc --enable-libgsm --enable-libopencore-amrnb --enable-libopus --enable-libspeex --enable-libvorbis --enable-ladspa --enable-libbs2b --enable-libflite --enable-libmysofa --enable-librubberband --enable-libsoxr --enable-chromaprint
  libavutil      58. 16.101 / 58. 16.101
  libavcodec     60. 23.100 / 60. 23.100
  libavformat    60. 10.100 / 60. 10.100
  libavdevice    60.  2.101 / 60.  2.101
  libavfilter     9. 11.100 /  9. 11.100
  libswscale      7.  3.100 /  7.  3.100
  libswresample   4. 11.100 /  4. 11.100
  libpostproc    57.  2.100 / 57.  2.100
[h264 @ 000001ef96980440] co located POCs unavailable    0B f=0/0
Input #0, rtsp, from &#39;rtsp://localhost:8554/mystream&#39;:   0B f=0/0
  Metadata:
    title           : Stream
  Duration: N/A, start: 0.083856, bitrate: N/A
  Stream #0:0: Video: h264 (High), yuv420p(progressive), 960x600 [SAR 1:1 DAR 8:5], 25 fps, 25 tbr, 90k tbn
  Stream #0:1: Audio: aac (LC), 44100 Hz, stereo, fltp
[h264 @ 000001ef969d3940] co located POCs unavailable
[h264 @ 000001ef9d061580] co located POCs unavailable
 517.22 A-V: -0.027 fd=  41 aq=   24KB vq=  155KB sq=    0B f=0/0

D:\program\nginx\ffmpeg-2023-08-14-git-c704901324-full_build\bin&gt;
</code></pre><h3 id="105vlc拉流">10.5.VLC拉流</h3>
<p>在VLC中配置网络串流地址为<code>rtsp://localhost:8554/mystream</code>，就可以播放推的流了。</p></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2023-08-20 11:02:00">更新于 2023-08-20&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"></div>
      <div class="post-info-share">
        <span></span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/%E5%8E%9F%E5%88%9B/' class="post-tag">原创</a><a href='/tags/android/' class="post-tag">android</a><a href='/tags/rtmp/' class="post-tag">rtmp</a><a href='/tags/rtsp/' class="post-tag">rtsp</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/android/drivers/%E5%9C%A8sc60%E6%BA%90%E7%A0%81%E4%B8%AD%E7%BC%96%E8%AF%91ko%E6%96%87%E4%BB%B6/%E5%9C%A8sc60%E6%BA%90%E7%A0%81%E4%B8%AD%E7%BC%96%E8%AF%91ko%E6%96%87%E4%BB%B6/" class="post-nav-item" rel="prev" title="在SC60源码中编译ko文件"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>在SC60源码中编译ko文件</a>
      <a href="/posts/android/adb%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/adb%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/" class="post-nav-item" rel="next" title="adb网络命令记录">adb网络命令记录<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line custom">学习数理化，走遍天下都不怕</div><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.114.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.2.18"><img class="fixit-icon" src="/fixit.min.svg" alt="FixIt logo" />&nbsp;FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2013 - 2023</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div><div class="footer-line statistics"></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/lunr/lunr.min.js" defer></script><script src="/lib/lunr/lunr.stemmer.support.min.js" defer></script><script src="/lib/lunr/lunr.zh.min.js" defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":10},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":30,"type":"lunr"}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
