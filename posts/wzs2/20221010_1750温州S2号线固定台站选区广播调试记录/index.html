<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>温州S2号线固定台站选区广播调试记录 - 来来往往</title><meta name="author" content="">
<meta name="author-link" content="">
<meta name="description" content="温州S2号线固定台站选区广播调试记录" /><meta name="keywords" content='PA, 固定台, 站选区广播, 温州S2号线' /><meta itemprop="name" content="温州S2号线固定台站选区广播调试记录">
<meta itemprop="description" content="温州S2号线固定台站选区广播调试记录"><meta itemprop="datePublished" content="2022-10-10T18:27:00+08:00" />
<meta itemprop="dateModified" content="2022-10-10T18:27:00+08:00" />
<meta itemprop="wordCount" content="7262">
<meta itemprop="keywords" content="PA,固定台,站选区广播,温州S2号线," /><meta property="og:title" content="温州S2号线固定台站选区广播调试记录" />
<meta property="og:description" content="温州S2号线固定台站选区广播调试记录" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://daizelai.github.io/posts/wzs2/20221010_1750%E6%B8%A9%E5%B7%9Es2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-10T18:27:00+08:00" />
<meta property="article:modified_time" content="2022-10-10T18:27:00+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="温州S2号线固定台站选区广播调试记录"/>
<meta name="twitter:description" content="温州S2号线固定台站选区广播调试记录"/>
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://daizelai.github.io/posts/wzs2/20221010_1750%E6%B8%A9%E5%B7%9Es2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/" /><link rel="prev" href="https://daizelai.github.io/posts/wzs2/20221011_1049%E4%B8%AD%E5%85%B4sdk%E5%A4%9A%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/" /><link rel="next" href="https://daizelai.github.io/posts/linux/20221016_1619ssh%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "温州S2号线固定台站选区广播调试记录",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/daizelai.github.io\/posts\/wzs2\/20221010_1750%E6%B8%A9%E5%B7%9Es2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95\/"
    },"genre": "posts","keywords": "PA, 固定台, 站选区广播, 温州S2号线","wordcount":  7262 ,
    "url": "https:\/\/daizelai.github.io\/posts\/wzs2\/20221010_1750%E6%B8%A9%E5%B7%9Es2%E5%8F%B7%E7%BA%BF%E5%9B%BA%E5%AE%9A%E5%8F%B0%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95\/","datePublished": "2022-10-10T18:27:00+08:00","dateModified": "2022-10-10T18:27:00+08:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "daizelai"
      },"description": "温州S2号线固定台站选区广播调试记录"
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="wide"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="来来往往"><img loading="lazy" src="/img/logo.png" srcset="/img/logo.png, /img/logo.png 1.5x, /img/logo.png 2x" sizes="auto" data-title="来来往往" data-alt="来来往往" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">来来往往</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 首页</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 归档</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 关于我</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="来来往往"><img loading="lazy" src="/img/logo.png" srcset="/img/logo.png, /img/logo.png 1.5x, /img/logo.png 2x" sizes="auto" data-title="/img/logo.png" data-alt="/img/logo.png" class="logo" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/><span class="header-title-text">来来往往</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 首页</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 归档</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 关于我</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container container-reverse"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom">
    </aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>温州S2号线固定台站选区广播调试记录</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      daizelai</span></span>
          <span class="post-category">收录于 <a href="/categories/pa/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> PA</a>&ensp;<a href="/categories/%E5%9B%BA%E5%AE%9A%E5%8F%B0/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 固定台</a>&ensp;<a href="/categories/%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD/"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 站选区广播</a></span></div>
      <div class="post-meta-line"><span title="发布于 2022-10-10 18:27:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden="true"></i><time datetime="2022-10-10">2022-10-10</time></span>&nbsp;<span title="更新于 2022-10-10 18:27:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden="true"></i><time datetime="2022-10-10">2022-10-10</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 7262 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 35 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#一描述">一、描述</a>
      <ul>
        <li><a href="#11前言">1.1.前言</a></li>
        <li><a href="#12对接文档">1.2.对接文档</a></li>
        <li><a href="#13调试记录">1.3.调试记录</a></li>
      </ul>
    </li>
    <li><a href="#二实验室广播环境">二、实验室广播环境</a>
      <ul>
        <li><a href="#21各服务环境">2.1.各服务环境</a></li>
      </ul>
    </li>
    <li><a href="#三站区广播配置">三、站区广播配置</a>
      <ul>
        <li><a href="#31调度配置">3.1.调度配置</a></li>
        <li><a href="#32固定台配置">3.2.固定台配置</a></li>
        <li><a href="#33固定台主机配置">3.3.固定台主机配置</a></li>
      </ul>
    </li>
    <li><a href="#四站选区广播现场调试">四、站选区广播现场调试</a>
      <ul>
        <li><a href="#41固定台站点名称问题">4.1.固定台站点名称问题</a></li>
        <li><a href="#42固定台浏览器访问广播模拟器接口">4.2.固定台浏览器访问广播模拟器接口</a></li>
      </ul>
    </li>
    <li><a href="#五站选区广播现场对接调试">五、站选区广播现场对接调试</a>
      <ul>
        <li><a href="#51实验室站区广播调试之86问题">5.1.实验室站区广播调试之+86问题</a></li>
        <li><a href="#52站区广播调试之端口问题">5.2.站区广播调试之端口问题</a></li>
        <li><a href="#53站区广播调试之tcp接口初步正常">5.3.站区广播调试之TCP接口初步正常</a></li>
        <li><a href="#54站区广播对接之新站调试">5.4.站区广播对接之新站调试</a></li>
        <li><a href="#55温州s2号线车站站选区广播20221012对接调试">5.5.温州S2号线车站站选区广播20221012对接调试</a></li>
        <li><a href="#56温州s2号线车站站选区广播20221013对接调试">5.6.温州S2号线车站站选区广播20221013对接调试</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h1 id="20221010_1750温州s2号线固定台站选区广播调试记录">20221010_1750温州S2号线固定台站选区广播调试记录</h1>
<h2 id="一描述">一、描述</h2>
<h3 id="11前言">1.1.前言</h3>
<p>by daizelai on 2022/10/10 18:27
温州S2号线固定台APP站选区广播调试对接记录。</p>
<!-- raw HTML omitted -->
<h3 id="12对接文档">1.2.对接文档</h3>
<p><a href="./file/PA-PIS%e9%9f%b3%e8%a7%86%e9%a2%91%e7%bb%9f%e4%b8%80%e4%bf%a1%e6%81%af%e6%9c%8d%e5%8a%a1%e7%b3%bb%e7%bb%9f%e6%8e%a5%e5%8f%a3%e5%8d%8f%e8%ae%ae202000228%ef%bc%8818%e5%8f%b7%e7%ba%bf%e4%b8%93%e7%94%a8%e6%97%a0%e7%ba%bf%e7%b3%bb%e7%bb%9f%ef%bc%89.docx">PA-PIS音视频统一信息服务系统接口协议202000228（18号线专用无线系统）</a></p>
<h3 id="13调试记录">1.3.调试记录</h3>
<table>
<thead>
<tr>
<th style="text-align:center">时间</th>
<th style="text-align:center">已方调试</th>
<th style="text-align:left">对方调试</th>
<th style="text-align:left">修改</th>
<th style="text-align:center">结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">2022/10/10</td>
<td style="text-align:center">daizelai/jiangfuqiang</td>
<td style="text-align:left">林汐/武林过客</td>
<td style="text-align:left">+86号码问题</td>
<td style="text-align:center">已修改</td>
</tr>
<tr>
<td style="text-align:center">2022/10/10</td>
<td style="text-align:center">daizelai/jiangfuqiang</td>
<td style="text-align:left">林汐/武林过客</td>
<td style="text-align:left">广播密码问题，123修改为1234</td>
<td style="text-align:center">已修改</td>
</tr>
<tr>
<td style="text-align:center">2022/10/10</td>
<td style="text-align:center">daizelai/jiangfuqiang</td>
<td style="text-align:left">林汐/武林过客</td>
<td style="text-align:left">广播账号问题，192.168.99.1修改为user</td>
<td style="text-align:center">已修改</td>
</tr>
<tr>
<td style="text-align:center">2022/10/10</td>
<td style="text-align:center">daizelai/jiangfuqiang</td>
<td style="text-align:left">林汐/武林过客</td>
<td style="text-align:left">广播账号问题，对方写死的1修改为user</td>
<td style="text-align:center">已修改</td>
</tr>
<tr>
<td style="text-align:center">2022/10/10</td>
<td style="text-align:center">daizelai/jiangfuqiang</td>
<td style="text-align:left">林汐/武林过客</td>
<td style="text-align:left">对方广播服务器问题，重启后http接口已通</td>
<td style="text-align:center">已修改</td>
</tr>
<tr>
<td style="text-align:center">2022/10/11</td>
<td style="text-align:center">daizelai/jiangfuqiang</td>
<td style="text-align:left">林汐/武林过客</td>
<td style="text-align:left">已获取appid和token。但start_mic时解析失败，初步确定为api过来的格式不对</td>
<td style="text-align:center">已修改</td>
</tr>
<tr>
<td style="text-align:center">2022/10/11</td>
<td style="text-align:center">daizelai/jiangfuqiang</td>
<td style="text-align:left">林汐/武林过客</td>
<td style="text-align:left">app解析start_mic报文也有问题，出到V1.1.4版本明天测试</td>
<td style="text-align:center">已修改</td>
</tr>
<tr>
<td style="text-align:center">2022/10/12</td>
<td style="text-align:center">daizelai/jiangfuqiang</td>
<td style="text-align:left">林汐/武林过客</td>
<td style="text-align:left">广播服务器stop_mic问题，对方不是DELETE，而是用的POST，后对方修改成DELETE搞定</td>
<td style="text-align:center">已修改</td>
</tr>
<tr>
<td style="text-align:center">2022/10/12</td>
<td style="text-align:center">daizelai/jiangfuqiang</td>
<td style="text-align:left">林汐/武林过客</td>
<td style="text-align:left">广播服务器区域问题，已出新版本</td>
<td style="text-align:center">已修改</td>
</tr>
<tr>
<td style="text-align:center">2022/10/12</td>
<td style="text-align:center">daizelai/jiangfuqiang</td>
<td style="text-align:left">林汐/武林过客</td>
<td style="text-align:left">广播服务器问题调试初步完成，广播正常</td>
<td style="text-align:center">已修改</td>
</tr>
<tr>
<td style="text-align:center">2022/10/13</td>
<td style="text-align:center">daizelai/jiangfuqiang</td>
<td style="text-align:left">林汐/武林过客</td>
<td style="text-align:left">广播服务器区域问题，已出新版本1.2.4测试，广播正常</td>
<td style="text-align:center">已修改</td>
</tr>
</tbody>
</table>
<h2 id="二实验室广播环境">二、实验室广播环境</h2>
<h3 id="21各服务环境">2.1.各服务环境</h3>
<p>笔记本windows10运行广播wzs2_staton.jar
笔记本PA广播地址：192.168.3.13
笔记本PA广播端口：8086</p>
<p>DIS服务器地址：192.168.13.177/192.0.1.121</p>
<p>主机地址：192.168.42.131/192.168.3.12</p>
<p>终端地址：192.168.42.130</p>
<h2 id="三站区广播配置">三、站区广播配置</h2>
<h3 id="31调度配置">3.1.调度配置</h3>
<p><img loading="lazy" src="./images/wzs2_station_bro_dc_2022-10-10_141803.png" srcset="./images/wzs2_station_bro_dc_2022-10-10_141803.png, ./images/wzs2_station_bro_dc_2022-10-10_141803.png 1.5x, ./images/wzs2_station_bro_dc_2022-10-10_141803.png 2x" sizes="auto" data-title="配置区域广播组" data-alt="配置区域广播组" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>因为DC配置区域广播组失败，这里直接手动在dis_wz2数据库中配置区域广播组。</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_dis_config_db_2022-10-10_142133.png" srcset="./images/wzs2_station_bro_dis_config_db_2022-10-10_142133.png, ./images/wzs2_station_bro_dis_config_db_2022-10-10_142133.png 1.5x, ./images/wzs2_station_bro_dis_config_db_2022-10-10_142133.png 2x" sizes="auto" data-title="dis直接配置区域广播组" data-alt="dis直接配置区域广播组" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>当然dc中的群里管理处，需要看到这个上行或下行广播组，是要包含这个固定台账号的</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_dc_2022-10-10_141814.png" srcset="./images/wzs2_station_bro_dc_2022-10-10_141814.png, ./images/wzs2_station_bro_dc_2022-10-10_141814.png 1.5x, ./images/wzs2_station_bro_dc_2022-10-10_141814.png 2x" sizes="auto" data-title="群组用户查看" data-alt="群组用户查看" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="32固定台配置">3.2.固定台配置</h3>
<p>固定台开局配置之PA服务地址：192.168.42.131
固定台开局配置之PA服务端口：8086</p>
<p>固定台通过向主机发送http访<code>http://192.168.42.131:8086</code>这个地址，主机发现这个端口就会重定向到广播服务器<code>192.168.3.13</code>。</p>
<blockquote>
<p>查看APP是否获取得区域广播组的配置</p>
</blockquote>
<p><img loading="lazy" src="./images/wzs2_station_bro_app_2022-10-10_141500.png" srcset="./images/wzs2_station_bro_app_2022-10-10_141500.png, ./images/wzs2_station_bro_app_2022-10-10_141500.png 1.5x, ./images/wzs2_station_bro_app_2022-10-10_141500.png 2x" sizes="auto" data-title="查看APP是否获取得区域广播组的配置" data-alt="查看APP是否获取得区域广播组的配置" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="33固定台主机配置">3.3.固定台主机配置</h3>
<p>固定台主机需要配置重定向功能，温州S2号线车载主机查看重定向。</p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">root@TA30-72:/sbin# pwd
/sbin
root@TA30-72:/sbin# cat e110forwardbroaudio 
#def config
e110ip=&#34;192.0.4.66&#34;
ta30ip_e=&#34;192.0.4.67&#34;
broaudioip=&#34;172.17.7.23&#34;
ta30ip_b=&#34;172.17.7.108&#34;
broaudioPort=&#34;8086&#34;
#############################################################
# nvram key list
# cfg_app_ip 
# ipv4_0_ip_address 
# cfg_app_broaudio 
# ipv4_ip_broaudio
# ipv4_mask_broaudio
# cfg_app_broaudioPort
############################################################
#get cfg from uci
e110ip=`uci get ta30.config.cfg_app_ip`
ta30ip_e=`uci get network.lan.ipaddr`
broaudioip=`uci get ip_redirect.config.cfg_app_broaudio`
ta30ip_b=`uci get ip_redirect.config.cfg_ipv4_ip_broaudio`
broaudioPort=`uci get ip_redirect.config.cfg_app_broaudioPort`
#config to system
#echo &#34;iptables -t nat -A PREROUTING -s $e110ip -d $ta30ip_e -p tcp --dport $broaudioPort -j DNAT --to-destination $broaudioip&#34;
iptables -t nat -F
iptables -t nat -A PREROUTING -s $e110ip -d $ta30ip_e -p tcp --dport $broaudioPort -j DNAT --to-destination $broaudioip
iptables -t nat -A POSTROUTING -s $e110ip -d $broaudioip -p tcp --dport $broaudioPort -j SNAT --to-source $ta30ip_b
iptables -t nat -A PREROUTING -s $broaudioip -d $ta30ip_b -p tcp --sport $broaudioPort -j DNAT --to-destination $e110ip
iptables -t nat -A POSTROUTING -s $broaudioip -d $e110ip -p tcp --sport $broaudioPort -j SNAT --to-source $ta30ip_e
ifconfig br-lan:2 promisc

#show config
iptables -t nat -vnL
root@TA30-72:/sbin# iptables -t nat -vnL
Chain PREROUTING (policy ACCEPT 19642 packets, 3225K bytes)
 pkts bytes target     prot opt in     out     source               destination         
   18  1080 DNAT       tcp  --  *      *       192.168.42.130       192.168.42.131      tcp dpt:8086 to:192.168.3.13 
    0     0 DNAT       tcp  --  *      *       192.168.3.13         192.168.3.12        tcp spt:8086 to:192.168.42.130 

Chain INPUT (policy ACCEPT 1156 packets, 74610 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 1250 packets, 84936 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain POSTROUTING (policy ACCEPT 1334 packets, 92385 bytes)
 pkts bytes target     prot opt in     out     source               destination         
   18  1080 SNAT       tcp  --  *      *       192.168.42.130       192.168.3.13        tcp dpt:8086 to:192.168.3.12 
    0     0 SNAT       tcp  --  *      *       192.168.3.13         192.168.42.130      tcp spt:8086 to:192.168.42.131 
root@TA30-72:/sbin#
</code></pre><h2 id="四站选区广播现场调试">四、站选区广播现场调试</h2>
<h3 id="41固定台站点名称问题">4.1.固定台站点名称问题</h3>
<blockquote>
<p>问题1，固定台左上角只显示站点ID了，应该显示站点名称
问题2，PA状态栏连接状态不对。</p>
</blockquote>
<p>13：41，温州S2号线APP，温州S2号线固定台站选区广播模拟器放到153网盘上了。
路径：\10.1.1.154\00-网络u盘\地铁集群二开项目\版本\APP\温州S2\FX\站选区模拟器\wzs2_station_broadcast_v0.0.2_dev.jar</p>
<p>14:11, 温州S2号线APP，产口四部，1【PA还没配置   上面图标显示都是绿的】2【站名显示的是数字，10应该为永兴站】。
14：26, 温州S2号线APP，产口四部郑文杰提出来的温州S2号线APP与DBA接口GetStatusRsp，少了很多字段。</p>
<p>15：27，温州S2号线APP，修复了上面《1【PA还没配置   上面图标显示都是绿的】2【站名显示的是数字，10应该为永兴站】》两个BUG。</p>
<hr>
<p>15：39，温州S2号线APP，产品四部群里给蒋富旨发了一个温州固定台临时版本FX400-APK-3.0.1-V1.0.5&ndash;release-20221009.apk</p>
<p>蒋富强<code>v1.0.5</code>临时版本</p>
<p>1.固定台首页站点临时显示中文名称。</p>
<p>2.PA连接状态显示修改正常。</p>
<hr>
<p>15：45，温州S2号线APP，临时版本TX300-APK-2.0.1-V1.0.5&ndash;release-20221009.apk发产品四部群里。</p>
<h3 id="42固定台浏览器访问广播模拟器接口">4.2.固定台浏览器访问广播模拟器接口</h3>
<p>17:04, 温州S2号线固定台APP站区广播：</p>
<p>pa在浏览器中访问，pa默认是ping不通的。</p>
<p><a href="http://192.168.42.131:8086/api/pa/zones"target="_blank" rel="external nofollow noopener noreferrer">固定台站选区广播模拟访问http://192.168.42.131:8086/api/pa/zones</a></p>
<p><img loading="lazy" src="./images/wzs2_pa_bo_tong_2022-10-09_170016.png" srcset="./images/wzs2_pa_bo_tong_2022-10-09_170016.png, ./images/wzs2_pa_bo_tong_2022-10-09_170016.png 1.5x, ./images/wzs2_pa_bo_tong_2022-10-09_170016.png 2x" sizes="auto" data-title="pa在浏览器中访问" data-alt="pa在浏览器中访问" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><strong>注意：</strong> 这里是在固定台的浏览器访问的，访问地址192.168.42.131:8086地址是固定台的主机地址+广播接口服务器的端口</p>
<p>18：46，温州S2号线固定台APP:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_base.constant</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 配置信息
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 默认需要配置:
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * Config.APP_TYPE是车载台还是固定台;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * APP_MODE当前APP模式是DMO直通模式,还是集群模式;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * AppConstant.kt-APP_CONFIG_ID: 这个是表ID的值,默认为1
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span>object Config <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * PA站选区广播
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * PA服务器地址
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * PA服务器端口，18=8086，wzs2=10049
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    var PA_ADDRESS <span style="color:#555">=</span> <span style="color:#c30">&#34;10.60.3.8&#34;</span>
</span></span><span style="display:flex;"><span>    var PA_PORT <span style="color:#555">=</span> <span style="color:#f60">10049</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><p>修改温州S2号线固定台APP站区广播申请APPID的名称和号码。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_base.repository</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * PA管理器
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2022/07/29 11:46
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">PaRepository</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 获取APPID
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 每个第三方向平台申请，平台通过后即可使用，第三方申请的 appid 如在 15 天内 未使用(没有接口访问记录)，则需要再次申请。
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @date 2022/07/28 14:48
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@Synchronized</span>
</span></span><span style="display:flex;"><span>    suspend fun <span style="color:#c0f">getAppID</span><span style="color:#555">():</span> Boolean <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>        val authName <span style="color:#555">=</span> SPUtils<span style="color:#555">.</span><span style="color:#309">getValue</span><span style="color:#555">(</span>PaApiCode<span style="color:#555">.</span><span style="color:#309">AUTH_NAME</span><span style="color:#555">.</span><span style="color:#309">resultCode</span><span style="color:#555">,</span> <span style="color:#c30">&#34;lte&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>        val authName <span style="color:#555">=</span> SPUtils<span style="color:#555">.</span><span style="color:#309">getValue</span><span style="color:#555">(</span>PaApiCode<span style="color:#555">.</span><span style="color:#309">AUTH_NAME</span><span style="color:#555">.</span><span style="color:#309">resultCode</span><span style="color:#555">,</span> <span style="color:#c30">&#34;192.168.99.1&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>        val userNum <span style="color:#555">=</span> SPUtils<span style="color:#555">.</span><span style="color:#309">getValue</span><span style="color:#555">(</span>PaApiCode<span style="color:#555">.</span><span style="color:#309">USER_NUM</span><span style="color:#555">.</span><span style="color:#309">resultCode</span><span style="color:#555">,</span> <span style="color:#f60">123</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>        val userNum <span style="color:#555">=</span> SPUtils<span style="color:#555">.</span><span style="color:#309">getValue</span><span style="color:#555">(</span>PaApiCode<span style="color:#555">.</span><span style="color:#309">USER_NUM</span><span style="color:#555">.</span><span style="color:#309">resultCode</span><span style="color:#555">,</span> <span style="color:#f60">1234</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>authName <span style="color:#555">==</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">e</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;getAppID() - authName=$authName, userNum=$userNum&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        val appid <span style="color:#555">=</span> SPUtils<span style="color:#555">.</span><span style="color:#309">getValue</span><span style="color:#555">(</span>PaApiCode<span style="color:#555">.</span><span style="color:#309">APP_ID</span><span style="color:#555">.</span><span style="color:#309">resultCode</span><span style="color:#555">,</span> <span style="color:#c30">&#34;&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>        val appidTime <span style="color:#555">=</span> SPUtils<span style="color:#555">.</span><span style="color:#309">getValue</span><span style="color:#555">(</span>PaApiCode<span style="color:#555">.</span><span style="color:#309">APP_ID_TIMEOUT</span><span style="color:#555">.</span><span style="color:#309">resultCode</span><span style="color:#555">,</span> <span style="color:#f60">0</span>L<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>appid <span style="color:#555">==</span> <span style="color:#c30">&#34;&#34;</span> <span style="color:#555">||</span> <span style="color:#555">(</span>SystemClock<span style="color:#555">.</span><span style="color:#309">elapsedRealtime</span><span style="color:#555">()</span> <span style="color:#555">-</span> appidTime<span style="color:#555">)</span> <span style="color:#555">&gt;</span> AppConstant<span style="color:#555">.</span><span style="color:#309">APP_ID_TIMEOUT</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#09f;font-style:italic">// 如果已过期，需要重新获取一下appid
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                val param <span style="color:#555">=</span> HttpManager<span style="color:#555">.</span><span style="color:#309">INSTANCE</span><span style="color:#555">.</span><span style="color:#309">getJsonBody</span><span style="color:#555">(</span>PaAppIDData<span style="color:#555">(</span>authName<span style="color:#555">,</span> userNum<span style="color:#555">))</span>
</span></span><span style="display:flex;"><span>                var data<span style="color:#555">:</span> PaAppIDRespData <span style="color:#555">=</span> HttpManager<span style="color:#555">.</span><span style="color:#309">INSTANCE</span><span style="color:#555">.</span><span style="color:#309">mApi</span><span style="color:#555">.</span><span style="color:#309">getAppid</span><span style="color:#555">(</span>param<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>data<span style="color:#555">.</span><span style="color:#309">code</span> <span style="color:#555">==</span> BaseConstant<span style="color:#555">.</span><span style="color:#309">PaDataCode</span><span style="color:#555">.</span><span style="color:#309">SUCCESS</span><span style="color:#555">.</span><span style="color:#309">resultCode</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">// 如果获取成功
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                    SPUtils<span style="color:#555">.</span><span style="color:#309">putValue</span><span style="color:#555">(</span>PaApiCode<span style="color:#555">.</span><span style="color:#309">APP_ID</span><span style="color:#555">.</span><span style="color:#309">resultCode</span><span style="color:#555">,</span> data<span style="color:#555">.</span><span style="color:#309">regappid</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                    SPUtils<span style="color:#555">.</span><span style="color:#309">putValue</span><span style="color:#555">(</span>
</span></span><span style="display:flex;"><span>                        PaApiCode<span style="color:#555">.</span><span style="color:#309">APP_ID_TIMEOUT</span><span style="color:#555">.</span><span style="color:#309">resultCode</span><span style="color:#555">,</span>
</span></span><span style="display:flex;"><span>                        SystemClock<span style="color:#555">.</span><span style="color:#309">elapsedRealtime</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#069;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#09f;font-style:italic">// 获取APPID失败
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                    LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">e</span><span style="color:#555">(</span>
</span></span><span style="display:flex;"><span>                        TAG<span style="color:#555">,</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#c30">&#34;getAppID() - Failed to get appid, code=${data.code}, message=${data.message}&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#069;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;getAppID() - appid not expired, appid=$appid&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>e<span style="color:#555">:</span> Exception<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#555">.</span><span style="color:#309">printStackTrace</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>            LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">e</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;getAppID() - Exception - e=${e.message}&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#069;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><h2 id="五站选区广播现场对接调试">五、站选区广播现场对接调试</h2>
<h3 id="51实验室站区广播调试之86问题">5.1.实验室站区广播调试之+86问题</h3>
<p>15：30，站区广播通话问题，因为通话号码带86，而从DIS获取的广播组列表是没有+86的。</p>
<p>下面是温州现场app的发起站区广播时的logcat日志。</p>
<p>因为呼叫通话界面中的号码是866027331，获取的DIS广播组号码是6027331，判断相等就不行了。</p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-10 15:46:54.910  4494  4494 D MainActivity: onReceive: new request mBroadCastReceiver, intent?.action=com.gbcom.action.ACTION_FX_STATION_BRD_ZONE_START_TASK
10-10 15:46:54.910  4494  4494 D MainActivity: onReceive: 站选区广播开始 start
10-10 15:46:54.910  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbb---start
10-10 15:46:54.910  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbbb---start----number=866027331
10-10 15:46:54.910  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---number=866027331
10-10 15:46:54.910  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list1=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]
10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]
10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]
10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]
10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]
10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]
10-10 15:46:54.911  4494  4494 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list4=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=沙城站上行站台广播组, groupID=6027331), StationBrdZone(zoneID=35002, zoneName=沙城站下行站台广播组, groupID=6027351), StationBrdZone(zoneID=35003, zoneName=沙城站动态重组组, groupID=6027512)]
10-10 15:46:54.912  4494  4494 D APP_LogUtils.kt: [(LogUtils.kt:45).d()] stationBrdZone - mZoneIDs.isEmpty()=[]
</code></pre><p>继上面的日志最后一行，APP在判断的时候，从DIS拿到的沙城站上行站台广播组是6027331，而当前手台呼叫上行站台广播组的号码是866027331。这两个不相等，所以没有拿到mZoneIDs数据，然后根本就没有进入广播接口。</p>
<p>这里修改APP代码，判断的时候，加入86或+86前缀。</p>
<p>路径：com.gbcom.library_base.constant.Config.kt</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_base.constant</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 配置信息
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 默认需要配置:
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * Config.APP_TYPE是车载台还是固定台;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * APP_MODE当前APP模式是DMO直通模式,还是集群模式;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * AppConstant.kt-APP_CONFIG_ID: 这个是表ID的值,默认为1
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span>object Config <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 通话组号码
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    val CALL_NUMBER_PREFIX <span style="color:#555">=</span> <span style="color:#c30">&#34;86&#34;</span>
</span></span><span style="display:flex;"><span>    val CALL_NUMBER_PREFIX_SYMBOL <span style="color:#555">=</span> <span style="color:#c30">&#34;+${CALL_NUMBER_PREFIX}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><p>调用
路径：com.gbcom.library_main.mvvm.view.MainActivity.kt</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_main.mvvm.view</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * APP首页
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2021/02/01
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#99f">@Route</span><span style="color:#555">(</span>path <span style="color:#555">=</span> ARouterConstant<span style="color:#555">.</span><span style="color:#309">PATH_MAIN</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">MainActivity</span> <span style="color:#555">:</span> BaseActivity<span style="color:#555">(</span>R<span style="color:#555">.</span><span style="color:#309">layout</span><span style="color:#555">.</span><span style="color:#309">activity_main</span><span style="color:#555">),</span>
</span></span><span style="display:flex;"><span>    CoroutineScope by <span style="color:#c0f">MainScope</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 站选区广播开始
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @date 2022/08/03 17:13
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> fun <span style="color:#c0f">paStartMic</span><span style="color:#555">(</span>number<span style="color:#555">:</span> String<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---number=$number&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>        Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list1=${AppConstant.STATION_ZONE_BRO_LIST}&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#09f;font-style:italic">// 3.如果站选区广播列表不为空的话，则对站选区广播对应的区域发起广播
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        <span style="color:#09f;font-style:italic">// 4.获取到站选区广播区域
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>        var mZoneIDs <span style="color:#555">=</span> mutableListOf<span style="color:#555">&lt;</span>Int<span style="color:#555">&gt;()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">for</span> <span style="color:#555">(</span>item in AppConstant<span style="color:#555">.</span><span style="color:#309">STATION_ZONE_BRO_LIST</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--${Config.CALL_NUMBER_PREFIX}${item.groupID}, ${Config.CALL_NUMBER_PREFIX_SYMBOL}${item.groupID} ---AppConstant.station_zone_bro_list2=${AppConstant.STATION_ZONE_BRO_LIST}&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>item<span style="color:#555">.</span><span style="color:#309">groupID</span> <span style="color:#555">==</span> number<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>            <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span><span style="color:#c30">&#34;${Config.CALL_NUMBER_PREFIX}${item.groupID}&#34;</span> <span style="color:#555">==</span> number <span style="color:#555">||</span> <span style="color:#c30">&#34;${Config.CALL_NUMBER_PREFIX_SYMBOL}${item.groupID}&#34;</span> <span style="color:#555">==</span> number<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list3=${AppConstant.STATION_ZONE_BRO_LIST}&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                mZoneIDs<span style="color:#555">.</span><span style="color:#309">add</span><span style="color:#555">(</span>item<span style="color:#555">.</span><span style="color:#309">zoneID</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><h3 id="52站区广播调试之端口问题">5.2.站区广播调试之端口问题</h3>
<p>一开始访问的端口就是有问题的，然后昨天2022/10/09把8086修改为10049，今天访问广播接口还是失败，这是<a href="./file/wzs2_app_station_bro_logcat_pa2.log">完整app的logcat日志，看510行</a>。</p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-10 16:03:42.791  5148  5245 W System.err: java.net.ConnectException: Failed to connect to /192.168.42.131:10049
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:270)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.RealConnection.connect(RealConnection.kt:176)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findConnection(ExchangeFinder.kt:236)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findHealthyConnection(ExchangeFinder.kt:109)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.find(ExchangeFinder.kt:77)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.Transmitter.newExchange$okhttp(Transmitter.kt:162)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.kt:35)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.kt:82)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.kt:84)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)
10-10 16:03:42.792  5148  5245 W System.err: 	at okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.kt:71)
10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)
10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)
10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.logging.HttpLoggingInterceptor.intercept(HttpLoggingInterceptor.kt:150)
10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)
10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)
10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.RealCall.getResponseWithInterceptorChain(RealCall.kt:184)
10-10 16:03:42.793  5148  5245 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:136)
10-10 16:03:42.793  5148  5245 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)
10-10 16:03:42.793  5148  5245 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
10-10 16:03:42.793  5148  5245 W System.err: 	at java.lang.Thread.run(Thread.java:761)
10-10 16:03:42.793  5148  5245 W System.err: Caused by: java.net.ConnectException: Connection refused
10-10 16:03:42.793  5148  5245 W System.err: 	at java.net.PlainSocketImpl.socketConnect(Native Method)
10-10 16:03:42.794  5148  5245 W System.err: 	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:334)
10-10 16:03:42.794  5148  5245 W System.err: 	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:196)
10-10 16:03:42.794  5148  5245 W System.err: 	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:178)
10-10 16:03:42.794  5148  5245 W System.err: 	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:356)
10-10 16:03:42.794  5148  5245 W System.err: 	at java.net.Socket.connect(Socket.java:605)
10-10 16:03:42.794  5148  5245 W System.err: 	at okhttp3.internal.platform.AndroidPlatform.connectSocket(AndroidPlatform.kt:58)
10-10 16:03:42.794  5148  5245 W System.err: 	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:268)
10-10 16:03:42.794  5148  5245 W System.err: 	... 24 more
</code></pre><p>16:47，再次修改10049为10000
路径：com.gbcom.library_base.constant.Config.kt</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_base.constant</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 配置信息
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> *
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 默认需要配置:
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * Config.APP_TYPE是车载台还是固定台;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * APP_MODE当前APP模式是DMO直通模式,还是集群模式;
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * AppConstant.kt-APP_CONFIG_ID: 这个是表ID的值,默认为1
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span>object Config <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * PA站选区广播
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * PA服务器地址
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * PA服务器端口，18=8086，wzs2=10049, wzs2=10000
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    var PA_ADDRESS <span style="color:#555">=</span> <span style="color:#c30">&#34;10.60.3.8&#34;</span>
</span></span><span style="display:flex;"><span>    var PA_PORT <span style="color:#555">=</span> <span style="color:#f60">10000</span>
</span></span><span style="display:flex;"><span>    var PA_AUTH_NAME <span style="color:#555">=</span> <span style="color:#c30">&#34;user&#34;</span>
</span></span><span style="display:flex;"><span>    var PA_USER_NUM <span style="color:#555">=</span> <span style="color:#f60">1234</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><p>后面发现，这里的用户名称也不是<code>lte</code>，而是<code>user</code>，下面是后面温州S2号线广播厂家研发<code>武林过客</code>发来的配置。</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_api_config_20221010180326.jpg" srcset="./images/wzs2_station_bro_api_config_20221010180326.jpg, ./images/wzs2_station_bro_api_config_20221010180326.jpg 1.5x, ./images/wzs2_station_bro_api_config_20221010180326.jpg 2x" sizes="auto" data-title="温州S2号线站选区广播接口配置参数" data-alt="温州S2号线站选区广播接口配置参数" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>16：50，温州S2号线APP：站区广播，蒋富强发起站区广播通话，还是不行，蒋富强在主机上抓包，固定台终端发10000到主机正常，主机发10000到广播服务器，对端直接RST拒绝了，还要需要查。</p>
<p><img loading="lazy" src="./images/wzs2_app_station_bro_tcp_error1_2022-10-10_161245.png" srcset="./images/wzs2_app_station_bro_tcp_error1_2022-10-10_161245.png, ./images/wzs2_app_station_bro_tcp_error1_2022-10-10_161245.png 1.5x, ./images/wzs2_app_station_bro_tcp_error1_2022-10-10_161245.png 2x" sizes="auto" data-title="站区广播通话异常" data-alt="站区广播通话异常" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>16：53，温州S2号线APP：站区广播，蒋富强发起站区广播通话，广播研发“武林过客”抓包查看。</p>
<p><img loading="lazy" src="./images/wzs2_app_station_bro_tcp_error2_2022-10-10_163206.png" srcset="./images/wzs2_app_station_bro_tcp_error2_2022-10-10_163206.png, ./images/wzs2_app_station_bro_tcp_error2_2022-10-10_163206.png 1.5x, ./images/wzs2_app_station_bro_tcp_error2_2022-10-10_163206.png 2x" sizes="auto" data-title="站区广播通话广播端口1000失败" data-alt="站区广播通话广播端口1000失败" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="53站区广播调试之tcp接口初步正常">5.3.站区广播调试之TCP接口初步正常</h3>
<p>16:56，实验室正常的站区广播抓包</p>
<p><img loading="lazy" src="./images/wzs2_app_station_bro_gbcom_success_20221010165538.png" srcset="./images/wzs2_app_station_bro_gbcom_success_20221010165538.png, ./images/wzs2_app_station_bro_gbcom_success_20221010165538.png 1.5x, ./images/wzs2_app_station_bro_gbcom_success_20221010165538.png 2x" sizes="auto" data-title="实验室站区广播通话正常" data-alt="实验室站区广播通话正常" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>17：19，温州现场站区广播的接口通了，对方<code>重启了现场设备，估计是修改了什么配置之类的</code>。</p>
<p><img loading="lazy" src="./images/wzs2_app_station_bro_success_2022-10-10_172017.png" srcset="./images/wzs2_app_station_bro_success_2022-10-10_172017.png, ./images/wzs2_app_station_bro_success_2022-10-10_172017.png 1.5x, ./images/wzs2_app_station_bro_success_2022-10-10_172017.png 2x" sizes="auto" data-title="接口通了" data-alt="接口通了" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><a href="./file/20221010_wzs2_station_bro_failure_pa4eth1.pcap">本次抓包通了抓包pcap下载</a></p>
<p>2022/10/10 17:48第二次通通话抓包。</p>
<p>用户名和编号不存在</p>
<p><a href="./file/20221010_wzs2_station_bro_failre_pa10.log">站区广播失败之用户名和编号不存在 日志文件下载</a></p>
<p>下面是用户名和编号不存在的日志片段</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_failure_reason1_20221010174753.jpg" srcset="./images/wzs2_station_bro_failure_reason1_20221010174753.jpg, ./images/wzs2_station_bro_failure_reason1_20221010174753.jpg 1.5x, ./images/wzs2_station_bro_failure_reason1_20221010174753.jpg 2x" sizes="auto" data-title="用户名和编号不存在" data-alt="用户名和编号不存在" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><a href="./file/20221010_wzs2_station_bro_failre_master_eth1.pcap">站区广播失败之用户名和编号不存在 抓包pcap文件下载</a></p>
<p>下面是用户名和编号不存在的抓包分析片段</p>
<p><img loading="lazy" src="./images/20221010_wzs2_station_bro_failre_master_eth1_2022-10-10_175522.png" srcset="./images/20221010_wzs2_station_bro_failre_master_eth1_2022-10-10_175522.png, ./images/20221010_wzs2_station_bro_failre_master_eth1_2022-10-10_175522.png 1.5x, ./images/20221010_wzs2_station_bro_failre_master_eth1_2022-10-10_175522.png 2x" sizes="auto" data-title="站区广播失败之用户名和编号不存在抓包分析" data-alt="站区广播失败之用户名和编号不存在抓包分析" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<h3 id="54站区广播对接之新站调试">5.4.站区广播对接之新站调试</h3>
<p>今天蒋富强继续使用昨天我发的v1.0.9固定台版本测试车站站区广播，首次测试结果是http连接异常的，如下日志片断。</p>
<p><a href="./file/wzs2_station_bro_test_pa11_20221011_1350.log">本次日志下载 下载</a></p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-11 13:50:08.274  2706  3650 W System.err: java.net.ConnectException: Failed to connect to /192.168.42.131:10000
10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:270)
10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.RealConnection.connect(RealConnection.kt:176)
10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findConnection(ExchangeFinder.kt:236)
10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findHealthyConnection(ExchangeFinder.kt:109)
10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.find(ExchangeFinder.kt:77)
10-11 13:50:08.275  2706  3650 W System.err: 	at okhttp3.internal.connection.Transmitter.newExchange$okhttp(Transmitter.k
</code></pre><p>紧接着蒋富强又测试了一次，http访问是正常的，但是还是提示<code>用户不存在,请检查用户名和用户编号</code>。</p>
<p><a href="./file/wzs2_staton_bro_pa12_20221011_1439.log">wzs2_staton_bro_pa12_20221011_1439.log 下载</a></p>
<p>下面是日志片段：</p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-11 14:06:15.120  2706  2706 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list3=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=天河站上行站台广播组, groupID=6027332), StationBrdZone(zoneID=35002, zoneName=天河站下行站台广播组, groupID=6027352), StationBrdZone(zoneID=35003, zoneName=天河站动态重组组, groupID=6027513)]
10-11 14:06:15.120  2706  2706 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--866027513, +866027513 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=天河站上行站台广播组, groupID=6027332), StationBrdZone(zoneID=35002, zoneName=天河站下行站台广播组, groupID=6027352), StationBrdZone(zoneID=35003, zoneName=天河站动态重组组, groupID=6027513)]
10-11 14:06:15.121  2706  2706 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---mZoneIDs=[35002], ---AppConstant.station_zone_bro_list4=[StationBrdZone(zoneID=1, zoneName=上行列车通播组, groupID=20000000008), StationBrdZone(zoneID=2, zoneName=下行列车通播组, groupID=20000000009), StationBrdZone(zoneID=35001, zoneName=天河站上行站台广播组, groupID=6027332), StationBrdZone(zoneID=35002, zoneName=天河站下行站台广播组, groupID=6027352), StationBrdZone(zoneID=35003, zoneName=天河站动态重组组, groupID=6027513)]
10-11 14:06:15.121  2706  2706 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---2222
10-11 14:06:15.121  2706  2706 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa -------3333
10-11 14:06:15.126  2706  4076 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa------44444
10-11 14:06:15.174  2706  4076 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [PaRepository] getAppID() - Failed to get appid, code=500, message=用户不存在,请检查用户名和用户编号
10-11 14:06:15.175  2706  4076 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---555555--false
......
10-11 14:06:15.186  2706  2827 D TAG     : 2,initFile: /custom/metro/log/2022-10-11/app3.log, logFile.length=144878, getCurrentFileName()=app3.log, writeFileName=/custom/metro/log/2022-10-11/app3.log
10-11 14:06:15.187  2706  2827 D LogWriteUtil.class=LogFileHandlerThread.class: 8,initFile: logFile=/custom/metro/log/2022-10-11/app3.log, logFile.length=144878
10-11 14:06:15.206  2706  2706 D IndexFragment: initView: applyFxData() - ats=[StationAts(createTime=1665468375, trainGroupNumber=212, serviceNumber=000, trainCrewNumber=000, trainPosition=1, trainRunningPosition=1, railName=T1212, stationID=012, terminalStationID=000, destinationID=000, identityID=+866022012)]
10-11 14:06:15.233  2706  4007 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [PaRepository] getToken() - Failed to get token, code=500, message=appid或者时间戳错误
10-11 14:06:15.234  2706  4007 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---666666666666666--
</code></pre><p><a href="./file/wzs2_staton_bro_master_pa12eth1.pcap">wzs2_staton_bro_master_pa12eth1.pcap 下载</a></p>
<p>通过看抓包文件分析可以看到，http访问是没问题的。</p>
<blockquote>
<p>第三次调试</p>
</blockquote>
<p><a href="./wzs2_staton_bro_pa13_20221011.log">终端pa13.log 下载</a></p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-11 14:29:54.214  4965  5037 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa------44444
10-11 14:29:54.222  4965  5037 D PaRepository: getAppID: authName=user, userNum=1234, appid=, appidTime=0
10-11 14:29:54.284  4965  5037 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [PaRepository] getAppID() - Failed to get appid, authName=user, userNum=1234, appid=, code=500, message=用户不存在,请检查用户名和用户编号
10-11 14:29:54.285  4965  5037 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---555555--false
</code></pre><p><a href="./file/wzs2_station_bro_master_pa13eth1.pcap">主机pa13eth1.pcap 下载</a></p>
<p>微信沟通记录</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_return_user_error_2022-10-11_144640.png" srcset="./images/wzs2_station_bro_return_user_error_2022-10-11_144640.png, ./images/wzs2_station_bro_return_user_error_2022-10-11_144640.png 1.5x, ./images/wzs2_station_bro_return_user_error_2022-10-11_144640.png 2x" sizes="auto" data-title="微信沟通记录" data-alt="微信沟通记录" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<blockquote>
<p>第四次调试</p>
</blockquote>
<p><a href="./file/wzs2_station_bro_return_user_error_app_pa14_20221011.log">终端pa14.log 下载</a></p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-11 14:42:05.553  4965  5057 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa------44444
10-11 14:42:05.555  4965  5057 D PaRepository: getAppID: authName=user, userNum=1234, appid=, appidTime=0
10-11 14:42:05.592  4965  5057 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [PaRepository] getAppID() - Failed to get appid, authName=user, userNum=1234, appid=, code=500, message=用户不存在,请检查用户名和用户编号
10-11 14:42:05.592  4965  5057 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---555555--false
</code></pre><p><a href="./file/wzs2_station_bro_return_user_error_master_pa14eth1_20221011.pcap">主机pa14eth1.pcap 下载</a></p>
<p>请求appid携带的参数</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_getappid_return_500_2022-10-11_150206.png" srcset="./images/wzs2_station_bro_getappid_return_500_2022-10-11_150206.png, ./images/wzs2_station_bro_getappid_return_500_2022-10-11_150206.png 1.5x, ./images/wzs2_station_bro_getappid_return_500_2022-10-11_150206.png 2x" sizes="auto" data-title="请求appid携带的参数" data-alt="请求appid携带的参数" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>报文分析还是提示用户名和用户编号不一致</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_master_pa14_eth1_2022-10-11_145059.png" srcset="./images/wzs2_station_bro_master_pa14_eth1_2022-10-11_145059.png, ./images/wzs2_station_bro_master_pa14_eth1_2022-10-11_145059.png 1.5x, ./images/wzs2_station_bro_master_pa14_eth1_2022-10-11_145059.png 2x" sizes="auto" data-title="报文分析还是提示用户名和用户编号不一致" data-alt="报文分析还是提示用户名和用户编号不一致" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>微信沟通记录</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_wechat2_2022-10-11_150420.png" srcset="./images/wzs2_station_bro_wechat2_2022-10-11_150420.png, ./images/wzs2_station_bro_wechat2_2022-10-11_150420.png 1.5x, ./images/wzs2_station_bro_wechat2_2022-10-11_150420.png 2x" sizes="auto" data-title="微信沟通记录" data-alt="微信沟通记录" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><a href="./file/wzs2_station_bro_edit_retry_pa16_20221011_1513.log">pa16.log 下载</a></p>
<p>继续测试</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_test_2022-10-11_152141.png" srcset="./images/wzs2_station_bro_test_2022-10-11_152141.png, ./images/wzs2_station_bro_test_2022-10-11_152141.png 1.5x, ./images/wzs2_station_bro_test_2022-10-11_152141.png 2x" sizes="auto" data-title="微信沟通" data-alt="微信沟通" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p><a href="./file/wzs2_station_bro_teset_pa17_20221011_1521.log">测试pa17.log 下载</a></p>
<p>下面是pa17.log日志片段，可以看到，是解析json数据失败了，报了<code>Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $</code>错误。</p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-11 15:21:39.609  4965  6381 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---666666666666666--
10-11 15:21:39.657  4965  6381 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---aaaaa--
10-11 15:21:39.658  4965  6381 W System.err: com.google.gson.JsonSyntaxException: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $
10-11 15:21:39.658  4965  6381 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:226)
10-11 15:21:39.658  4965  6381 W System.err: 	at retrofit2.converter.gson.GsonResponseBodyConverter.convert(GsonResponseBodyConverter.java:40)
10-11 15:21:39.658  4965  6381 W System.err: 	at retrofit2.converter.gson.GsonResponseBodyConverter.convert(GsonResponseBodyConverter.java:27)
10-11 15:21:39.658  4965  6381 W System.err: 	at retrofit2.OkHttpCall.parseResponse(OkHttpCall.java:243)
10-11 15:21:39.659  4965  6381 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:153)
10-11 15:21:39.659  4965  6381 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)
10-11 15:21:39.660  4965  6381 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)
10-11 15:21:39.660  4965  6381 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
10-11 15:21:39.660  4965  6381 W System.err: 	at java.lang.Thread.run(Thread.java:761)
10-11 15:21:39.660  4965  6381 W System.err: Caused by: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $
10-11 15:21:39.660  4965  6381 W System.err: 	at com.google.gson.stream.JsonReader.beginObject(JsonReader.java:385)
10-11 15:21:39.660  4965  6381 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:215)
10-11 15:21:39.660  4965  6381 W System.err: 	... 8 more
10-11 15:21:39.661  4965  6381 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] paStartMic() Exception - zone_ids=[35001], e=java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $
10-11 15:21:39.662  4965  6381 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---bbbbb--
</code></pre><p>再去主机抓包看一下</p>
<p>接口start_mic成功返回，<a href="./file/wzs2_staton_bro_start_mic_pacp_master_pa19eth1_20221011.pcap">主机pa19eth1.pcap 下载</a>，但是解析失败，这是<a href="./file/wzs2_station_bro_app_log_pa19_20221011.log">终端pa19.log 下载</a>。</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_pa19_eth1_pacp_2022-10-11_094825.png" srcset="./images/wzs2_station_bro_pa19_eth1_pacp_2022-10-11_094825.png, ./images/wzs2_station_bro_pa19_eth1_pacp_2022-10-11_094825.png 1.5x, ./images/wzs2_station_bro_pa19_eth1_pacp_2022-10-11_094825.png 2x" sizes="auto" data-title="接口start_mic成功返回，主机pa19eth1.pcap" data-alt="接口start_mic成功返回，主机pa19eth1.pcap" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>因为APP没有添加http的日志打印，所以又修改了个版本v1.1.1，再次发广播。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 日志拦截器
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> fun <span style="color:#c0f">initLogInterceptor</span><span style="color:#555">():</span> HttpLoggingInterceptor <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span><span style="color:#c30">&#34;TAG&#34;</span><span style="color:#555">,</span> <span style="color:#c30">&#34;initLogInterceptor: aaaaaaaaaaaaaaaaaaa&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">//        if (!BuildConfig.DEBUG) {   //生产环境不打日志
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">//            Log.d(&#34;TAG&#34;, &#34;initLogInterceptor: bbbbbb&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">//            return HttpLoggingInterceptor()
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">//        }
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>
</span></span><span style="display:flex;"><span>        Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span><span style="color:#c30">&#34;TAG&#34;</span><span style="color:#555">,</span> <span style="color:#c30">&#34;initLogInterceptor: ccccccc&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>        val interceptor <span style="color:#555">=</span> HttpLoggingInterceptor<span style="color:#555">(</span>object <span style="color:#555">:</span> HttpLoggingInterceptor<span style="color:#555">.</span><span style="color:#309">Logger</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            override fun <span style="color:#c0f">log</span><span style="color:#555">(</span>message<span style="color:#555">:</span> String<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">i</span><span style="color:#555">(</span><span style="color:#c30">&#34;Retrofit_network&#34;</span><span style="color:#555">,</span> message<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span><span style="color:#c30">&#34;TAG&#34;</span><span style="color:#555">,</span> <span style="color:#c30">&#34;log: message=$message&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">})</span>
</span></span><span style="display:flex;"><span>        interceptor<span style="color:#555">.</span><span style="color:#309">level</span> <span style="color:#555">=</span> HttpLoggingInterceptor<span style="color:#555">.</span><span style="color:#309">Level</span><span style="color:#555">.</span><span style="color:#309">BODY</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> interceptor
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span></code></pre></div><p><a href="./file/wzs2_station_bro_receive_start_mic_json_error20221011.log">终端pa20.log</a></p>
<pre tabindex="0"><code class="language-linux" data-lang="linux">10-11 16:09:46.458  3867  4007 I Retrofit_network: --&gt; POST http://192.168.42.131:10000/api/pa/start_mic
10-11 16:09:46.459  3867  4007 D TAG     : log: message=--&gt; POST http://192.168.42.131:10000/api/pa/start_mic
10-11 16:09:46.459  3867  4007 I Retrofit_network: Content-Type: application/json; charset=utf-8
10-11 16:09:46.460  3867  4007 D TAG     : log: message=Content-Type: application/json; charset=utf-8
10-11 16:09:46.460  3867  4007 I Retrofit_network: Content-Length: 20
10-11 16:09:46.460  3867  4007 D TAG     : log: message=Content-Length: 20
10-11 16:09:46.461  3867  4007 I Retrofit_network: 
10-11 16:09:46.461  3867  4007 D TAG     : log: message=
10-11 16:09:46.461  3867  4007 I Retrofit_network: {&#34;zone_ids&#34;:[35001]}
10-11 16:09:46.461  3867  4007 D TAG     : log: message={&#34;zone_ids&#34;:[35001]}
10-11 16:09:46.462  3867  4007 I Retrofit_network: --&gt; END POST (20-byte body)
10-11 16:09:46.462  3867  4007 D TAG     : log: message=--&gt; END POST (20-byte body)
10-11 16:09:46.498  3867  4007 I Retrofit_network: &lt;-- 200 OK http://192.168.42.131:10000/api/pa/start_mic (35ms)
10-11 16:09:46.498  3867  4007 D TAG     : log: message=&lt;-- 200 OK http://192.168.42.131:10000/api/pa/start_mic (35ms)
10-11 16:09:46.498  3867  4007 I Retrofit_network: Content-Length: 100
10-11 16:09:46.498  3867  4007 D TAG     : log: message=Content-Length: 100
10-11 16:09:46.498  3867  4007 I Retrofit_network: Content-Type: text/plain
10-11 16:09:46.498  3867  4007 D TAG     : log: message=Content-Type: text/plain
10-11 16:09:46.498  3867  4007 I Retrofit_network: Keep-Alive: timeout=5, max=5
10-11 16:09:46.498  3867  4007 D TAG     : log: message=Keep-Alive: timeout=5, max=5
10-11 16:09:46.500  3867  4007 I Retrofit_network: 
10-11 16:09:46.501  3867  4007 D TAG     : log: message=
10-11 16:09:46.501  3867  4007 I Retrofit_network: [
10-11 16:09:46.501  3867  4007 I Retrofit_network:     {
10-11 16:09:46.501  3867  4007 I Retrofit_network:         &#34;id&#34;: 35001,
10-11 16:09:46.501  3867  4007 I Retrofit_network:         &#34;reason&#34;: &#34;广播呼叫成功&#34;,
10-11 16:09:46.501  3867  4007 I Retrofit_network:         &#34;result&#34;: true
10-11 16:09:46.501  3867  4007 I Retrofit_network:     }
10-11 16:09:46.501  3867  4007 I Retrofit_network: ]
10-11 16:09:46.501  3867  4007 D TAG     : log: message=[
10-11 16:09:46.501  3867  4007 D TAG     :     {
10-11 16:09:46.501  3867  4007 D TAG     :         &#34;id&#34;: 35001,
10-11 16:09:46.501  3867  4007 D TAG     :         &#34;reason&#34;: &#34;广播呼叫成功&#34;,
10-11 16:09:46.501  3867  4007 D TAG     :         &#34;result&#34;: true
10-11 16:09:46.501  3867  4007 D TAG     :     }
10-11 16:09:46.501  3867  4007 D TAG     : ]
10-11 16:09:46.501  3867  4007 I Retrofit_network: &lt;-- END HTTP (100-byte body)
10-11 16:09:46.501  3867  4007 D TAG     : log: message=&lt;-- END HTTP (100-byte body)
10-11 16:09:46.508  3867  3961 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---aaaaa--
</code></pre><p>再次修改了代码，其实本次修改的代码是没用的，这个<code>getJsonBody()</code>是去广播API接口服务器请求数据的时候带过去的，不是对方response的：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_base.utils</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 使用 枚举单例模式; 包括 初始化 Retrofit, OkHttpClient, 添加请求Token, 请求日志打印.
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2022/07/28
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">enum</span> <span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">HttpManager</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 日志拦截器
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> fun <span style="color:#c0f">initLogInterceptor</span><span style="color:#555">():</span> HttpLoggingInterceptor <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span><span style="color:#c30">&#34;TAG&#34;</span><span style="color:#555">,</span> <span style="color:#c30">&#34;initLogInterceptor: aaaaaaaaaaaaaaaaaaa&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">//        if (!BuildConfig.DEBUG) {   //生产环境不打日志
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">//            Log.d(&#34;TAG&#34;, &#34;initLogInterceptor: bbbbbb&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">//            return HttpLoggingInterceptor()
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">//        }
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>
</span></span><span style="display:flex;"><span>        Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span><span style="color:#c30">&#34;TAG&#34;</span><span style="color:#555">,</span> <span style="color:#c30">&#34;initLogInterceptor: ccccccc&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>        val interceptor <span style="color:#555">=</span> HttpLoggingInterceptor<span style="color:#555">(</span>object <span style="color:#555">:</span> HttpLoggingInterceptor<span style="color:#555">.</span><span style="color:#309">Logger</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            override fun <span style="color:#c0f">log</span><span style="color:#555">(</span>message<span style="color:#555">:</span> String<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">i</span><span style="color:#555">(</span><span style="color:#c30">&#34;Retrofit_network&#34;</span><span style="color:#555">,</span> message<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span><span style="color:#c30">&#34;TAG&#34;</span><span style="color:#555">,</span> <span style="color:#c30">&#34;log: message=$message&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">})</span>
</span></span><span style="display:flex;"><span>        interceptor<span style="color:#555">.</span><span style="color:#309">level</span> <span style="color:#555">=</span> HttpLoggingInterceptor<span style="color:#555">.</span><span style="color:#309">Level</span><span style="color:#555">.</span><span style="color:#309">BODY</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> interceptor
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 请求数据转 Json 形式
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    open fun <span style="color:#c0f">getJsonBody</span><span style="color:#555">(</span>data<span style="color:#555">:</span> Any<span style="color:#555">):</span> RequestBody <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>        Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span><span style="color:#c30">&#34;TAG&#34;</span><span style="color:#555">,</span> <span style="color:#c30">&#34;getJsonBody: data=$data&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>        val strEntity <span style="color:#555">=</span> Gson<span style="color:#555">().</span><span style="color:#309">toJson</span><span style="color:#555">(</span>data<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#069;font-weight:bold">return</span> strEntity<span style="color:#555">.</span><span style="color:#309">toRequestBody</span><span style="color:#555">(</span>mMediaTypeJson<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><p><a href="./file/wzs2_station_bro_receive_start_mic_json_error_pa22_20221011_1953.log">pa22.log</a></p>
<p>下面是<code>pa22.log</code>的日志片段，可以看到里面报了一个这个错误<code>java.lang.IllegalStateException: Expected BEGIN_ARRAY but was NUMBER at line 4 column 16 path $.result</code>，下面找到问题所在了。</p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-11 16:58:56.622  5501  5662 I Retrofit_network: --&gt; POST http://192.168.42.131:10000/api/pa/start_mic
10-11 16:58:56.623  5501  5662 D TAG     : log: message=--&gt; POST http://192.168.42.131:10000/api/pa/start_mic
10-11 16:58:56.623  5501  5662 I Retrofit_network: Content-Type: application/json; charset=utf-8
10-11 16:58:56.624  5501  5662 D TAG     : log: message=Content-Type: application/json; charset=utf-8
10-11 16:58:56.624  5501  5662 I Retrofit_network: Content-Length: 20
10-11 16:58:56.624  5501  5662 D TAG     : log: message=Content-Length: 20
10-11 16:58:56.624  5501  5662 I Retrofit_network: 
10-11 16:58:56.624  5501  5662 D TAG     : log: message=
10-11 16:58:56.625  5501  5662 I Retrofit_network: {&#34;zone_ids&#34;:[35001]}
10-11 16:58:56.625  5501  5662 D TAG     : log: message={&#34;zone_ids&#34;:[35001]}
10-11 16:58:56.626  5501  5662 I Retrofit_network: --&gt; END POST (20-byte body)
10-11 16:58:56.626  5501  5662 D TAG     : log: message=--&gt; END POST (20-byte body)
10-11 16:58:56.628  5501  5501 D IndexFragment: initView: applyFxData() - ats=[StationAts(createTime=1665478736, trainGroupNumber=212, serviceNumber=000, trainCrewNumber=000, trainPosition=1, trainRunningPosition=1, railName=T1212, stationID=012, terminalStationID=000, destinationID=000, identityID=+866022012)]
10-11 16:58:56.658  5501  5662 I Retrofit_network: &lt;-- 200 OK http://192.168.42.131:10000/api/pa/start_mic (32ms)
10-11 16:58:56.658  5501  5662 D TAG     : log: message=&lt;-- 200 OK http://192.168.42.131:10000/api/pa/start_mic (32ms)
10-11 16:58:56.658  5501  5662 I Retrofit_network: Content-Length: 141
10-11 16:58:56.658  5501  5662 D TAG     : log: message=Content-Length: 141
10-11 16:58:56.658  5501  5662 I Retrofit_network: Content-Type: text/plain
10-11 16:58:56.658  5501  5662 D TAG     : log: message=Content-Type: text/plain
10-11 16:58:56.658  5501  5662 I Retrofit_network: Keep-Alive: timeout=5, max=5
10-11 16:58:56.658  5501  5662 D TAG     : log: message=Keep-Alive: timeout=5, max=5
10-11 16:58:56.659  5501  5662 I Retrofit_network: 
10-11 16:58:56.659  5501  5662 D TAG     : log: message=
10-11 16:58:56.660  5501  5662 I Retrofit_network: {
10-11 16:58:56.660  5501  5662 I Retrofit_network:     &#34;code&#34;: 500,
10-11 16:58:56.660  5501  5662 I Retrofit_network:     &#34;message&#34;: &#34;token已经过期,请重新申请!&#34;,
10-11 16:58:56.660  5501  5662 I Retrofit_network:     &#34;result&#34;: 0,
10-11 16:58:56.660  5501  5662 I Retrofit_network:     &#34;success&#34;: false,
10-11 16:58:56.660  5501  5662 I Retrofit_network:     &#34;timestamp&#34;: 1665478728
10-11 16:58:56.660  5501  5662 I Retrofit_network: }
10-11 16:58:56.660  5501  5662 D TAG     : log: message={
10-11 16:58:56.660  5501  5662 D TAG     :     &#34;code&#34;: 500,
10-11 16:58:56.660  5501  5662 D TAG     :     &#34;message&#34;: &#34;token已经过期,请重新申请!&#34;,
10-11 16:58:56.660  5501  5662 D TAG     :     &#34;result&#34;: 0,
10-11 16:58:56.660  5501  5662 D TAG     :     &#34;success&#34;: false,
10-11 16:58:56.660  5501  5662 D TAG     :     &#34;timestamp&#34;: 1665478728
10-11 16:58:56.660  5501  5662 D TAG     : }
10-11 16:58:56.660  5501  5662 I Retrofit_network: &lt;-- END HTTP (141-byte body)
10-11 16:58:56.660  5501  5662 D TAG     : log: message=&lt;-- END HTTP (141-byte body)
10-11 16:58:56.665  5501  5501 I APP_LogUtils.kt: [(LogUtils.kt:50).i()] [com.gbcom.library_base.service.LLteService] lte_resp_sys_for_emci_detail - EmciDetail=com.ztegota.system.common.EmciDetail@d13f120
10-11 16:58:56.668  5501  5602 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---aaaaa--


10-11 16:58:56.668  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log
10-11 16:58:56.668  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11
10-11 16:58:56.668  5501  5602 W System.err: com.google.gson.JsonSyntaxException: java.lang.IllegalStateException: Expected BEGIN_ARRAY but was NUMBER at line 4 column 16 path $.result
10-11 16:58:56.669  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 1getCurrentFileName: LogWriteUtil.logfile=app.log
10-11 16:58:56.669  5501  5602 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:226)
10-11 16:58:56.669  5501  5602 W System.err: 	at retrofit2.converter.gson.GsonResponseBodyConverter.convert(GsonResponseBodyConverter.java:40)
10-11 16:58:56.669  5501  5602 W System.err: 	at retrofit2.converter.gson.GsonResponseBodyConverter.convert(GsonResponseBodyConverter.java:27)
10-11 16:58:56.669  5501  5602 W System.err: 	at retrofit2.OkHttpCall.parseResponse(OkHttpCall.java:243)
10-11 16:58:56.669  5501  5602 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:153)
10-11 16:58:56.669  5501  5602 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)
10-11 16:58:56.669  5501  5602 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)
10-11 16:58:56.669  5501  5602 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
10-11 16:58:56.669  5501  5602 W System.err: 	at java.lang.Thread.run(Thread.java:761)
10-11 16:58:56.669  5501  5602 W System.err: Caused by: java.lang.IllegalStateException: Expected BEGIN_ARRAY but was NUMBER at line 4 column 16 path $.result
10-11 16:58:56.669  5501  5602 W System.err: 	at com.google.gson.stream.JsonReader.beginArray(JsonReader.java:350)
10-11 16:58:56.669  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log
10-11 16:58:56.669  5501  5602 W System.err: 	at com.google.gson.internal.bind.CollectionTypeAdapterFactory$Adapter.read(CollectionTypeAdapterFactory.java:80)
10-11 16:58:56.669  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11
10-11 16:58:56.669  5501  5602 W System.err: 	at com.google.gson.internal.bind.CollectionTypeAdapterFactory$Adapter.read(CollectionTypeAdapterFactory.java:61)
10-11 16:58:56.669  5501  5602 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$1.read(ReflectiveTypeAdapterFactory.java:131)
10-11 16:58:56.670  5501  5602 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:222)
10-11 16:58:56.670  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11
10-11 16:58:56.670  5501  5602 W System.err: 	... 8 more
10-11 16:58:56.670  5501  5522 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=14
10-11 16:58:56.670  5501  5602 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] paStartMic() Exception - zone_ids=[35001], e=java.lang.IllegalStateException: Expected BEGIN_ARRAY but was NUMBER at line 4 column 16 path $.result
</code></pre><blockquote>
<p>代码修改
仔细分析了下API接口文档和日志输出格式，发现对方发来的json格式是有问题的，只是发了一个[{&hellip;&hellip;.}]这种过来，APP代码也需要进行相应的修改。</p>
</blockquote>
<p>广播服务器开始站区广播接口</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_start_mic_return_json_2022-10-11_200144.png" srcset="./images/wzs2_station_bro_start_mic_return_json_2022-10-11_200144.png, ./images/wzs2_station_bro_start_mic_return_json_2022-10-11_200144.png 1.5x, ./images/wzs2_station_bro_start_mic_return_json_2022-10-11_200144.png 2x" sizes="auto" data-title="广播服务器开始站区广播接口" data-alt="广播服务器开始站区广播接口" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>先修改模拟器服务器的返回：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">-</span> <span style="color:#c30">&#34;{\&#34;success\&#34;:true,\n\&#34;code\&#34;:200,\n\&#34;timestamp\&#34;:1731936161,\&#34;message\&#34;:\&#34;ok\&#34;,\&#34;result\&#34;:[{\&#34;id\&#34;:35001,\&#34;result\&#34;:true,\&#34;reason\&#34;:\&#34;广播呼叫成功\&#34;}]}&#34;</span><span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">+</span> <span style="color:#c30">&#34;[{\&#34;id\&#34;: 35001,\&#34;reason\&#34;: \&#34;广播呼叫成功\&#34;,\&#34;result\&#34;: true}]&#34;</span><span style="color:#a00;background-color:#faa">;</span>
</span></span></code></pre></div><p>先实验室执行一次广播操作，服务器直接返回<code>[{\&quot;id\&quot;: 35001,\&quot;reason\&quot;: \&quot;广播呼叫成功\&quot;,\&quot;result\&quot;: true}]</code>，APP接收服务器并处理数据的时候，也是温州S2现场一样的err问题，因为APP解析数据是按照<code>{\&quot;success\&quot;:true,\n\&quot;code\&quot;:200,\n\&quot;timestamp\&quot;:1731936161,\&quot;message\&quot;:\&quot;ok\&quot;,\&quot;result\&quot;:[{\&quot;id\&quot;:35001,\&quot;result\&quot;:true,\&quot;reason\&quot;:\&quot;广播呼叫成功\&quot;}]}</code>来解析的。</p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-11 19:47:03.156 15412 15474 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---666666666666666--

......

10-11 19:47:03.161 15412 15911 I Retrofit_network: --&gt; POST http://192.168.42.55:8086/api/pa/start_mic
10-11 19:47:03.161 15412 15911 D TAG     : 111111--convert: log: message=--&gt; POST http://192.168.42.55:8086/api/pa/start_mic
10-11 19:47:03.161 15412 15911 I Retrofit_network: Content-Type: application/json; charset=utf-8
10-11 19:47:03.161 15412 15911 D TAG     : 111111--convert: log: message=Content-Type: application/json; charset=utf-8
10-11 19:47:03.161 15412 15911 I Retrofit_network: Content-Length: 20
10-11 19:47:03.161 15412 15911 D TAG     : 111111--convert: log: message=Content-Length: 20
10-11 19:47:03.162 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log
10-11 19:47:03.162 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11
10-11 19:47:03.162 15412 15911 I Retrofit_network: 
10-11 19:47:03.162 15412 15911 D TAG     : 111111--convert: log: message=
10-11 19:47:03.162 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11
10-11 19:47:03.162 15412 15911 I Retrofit_network: {&#34;zone_ids&#34;:[35001]}
10-11 19:47:03.162 15412 15911 D TAG     : 111111--convert: log: message={&#34;zone_ids&#34;:[35001]}
10-11 19:47:03.162 15412 15911 I Retrofit_network: --&gt; END POST (20-byte body)
10-11 19:47:03.162 15412 15911 D TAG     : 111111--convert: log: message=--&gt; END POST (20-byte body)

......

10-11 19:47:03.179 15412 15911 I Retrofit_network: &lt;-- 200 http://192.168.42.55:8086/api/pa/start_mic (16ms)
10-11 19:47:03.179 15412 15911 D TAG     : 111111--convert: log: message=&lt;-- 200 http://192.168.42.55:8086/api/pa/start_mic (16ms)
10-11 19:47:03.179 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 3getCurrentFileName: logFileName=app63.log
10-11 19:47:03.179 15412 15911 I Retrofit_network: Content-Type: application/json;charset=UTF-8
10-11 19:47:03.179 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1,initFile: getFilePath()=/custom/metro/log/2022-10-11, getCurrentFileName=app63.log
10-11 19:47:03.179 15412 15911 D TAG     : 111111--convert: log: message=Content-Type: application/json;charset=UTF-8
10-11 19:47:03.179 15412 15911 I Retrofit_network: Content-Length: 61
10-11 19:47:03.179 15412 15911 D TAG     : 111111--convert: log: message=Content-Length: 61
10-11 19:47:03.179 15412 15911 I Retrofit_network: Date: Tue, 11 Oct 2022 11:46:02 GMT
10-11 19:47:03.179 15412 15911 D TAG     : 111111--convert: log: message=Date: Tue, 11 Oct 2022 11:46:02 GMT
10-11 19:47:03.180 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log
10-11 19:47:03.180 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11
10-11 19:47:03.180 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getCurrentFileName: LogWriteUtil.logfile=app.log
10-11 19:47:03.180 15412 15911 I Retrofit_network: 
10-11 19:47:03.180 15412 15911 D TAG     : 111111--convert: log: message=
10-11 19:47:03.180 15412 15911 I Retrofit_network: [{&#34;id&#34;: 35001,&#34;reason&#34;: &#34;骞挎挱鍛煎彨鎴愬姛&#34;,&#34;result&#34;: true}]
10-11 19:47:03.181 15412 15911 D TAG     : 111111--convert: log: message=[{&#34;id&#34;: 35001,&#34;reason&#34;: &#34;骞挎挱鍛煎彨鎴愬姛&#34;,&#34;result&#34;: true}]
10-11 19:47:03.181 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log
10-11 19:47:03.181 15412 15911 I Retrofit_network: &lt;-- END HTTP (61-byte body)
10-11 19:47:03.181 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11
10-11 19:47:03.181 15412 15911 D TAG     : 111111--convert: log: message=&lt;-- END HTTP (61-byte body)
10-11 19:47:03.181 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11
10-11 19:47:03.181 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=63
10-11 19:47:03.182 15412 15911 D TAG     : 22222222222222222222convert: response=[{&#34;id&#34;: 35001,&#34;reason&#34;: &#34;骞挎挱鍛煎彨鎴愬姛&#34;,&#34;result&#34;: true}]
10-11 19:47:03.182 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log
10-11 19:47:03.182 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11
10-11 19:47:03.182 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11
10-11 19:47:03.182 15412 15911 D TAG     : 22222222222222222222convert: response=[{&#34;id&#34;: 35001,&#34;reason&#34;: &#34;骞挎挱鍛煎彨鎴愬姛&#34;,&#34;result&#34;: true}]
10-11 19:47:03.183 15412 15911 W System.err: com.google.gson.JsonSyntaxException: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $
10-11 19:47:03.183 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 3getCurrentFileName: logFileName=app63.log
10-11 19:47:03.183 15412 15911 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:226)
10-11 19:47:03.183 15412 15911 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:47)
10-11 19:47:03.183 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getCurrentFileName: LogWriteUtil.logfile=app.log
10-11 19:47:03.183 15412 15911 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:15)
10-11 19:47:03.183 15412 15911 W System.err: 	at retrofit2.OkHttpCall.parseResponse(OkHttpCall.java:243)
10-11 19:47:03.183 15412 15911 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:153)
10-11 19:47:03.183 15412 15911 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)
10-11 19:47:03.183 15412 15911 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)
10-11 19:47:03.183 15412 15911 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
10-11 19:47:03.183 15412 15911 W System.err: 	at java.lang.Thread.run(Thread.java:761)
10-11 19:47:03.183 15412 15911 W System.err: Caused by: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $
10-11 19:47:03.183 15412 15911 W System.err: 	at com.google.gson.stream.JsonReader.beginObject(JsonReader.java:385)
10-11 19:47:03.184 15412 15911 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:215)
10-11 19:47:03.184 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log
10-11 19:47:03.184 15412 15911 W System.err: 	... 8 more
10-11 19:47:03.184 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11
10-11 19:47:03.184 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11
10-11 19:47:03.184 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=63
10-11 19:47:03.185 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-11, LogWriteUtil.logPathDir=/custom/metro/log
10-11 19:47:03.185 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-11
10-11 19:47:03.185 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-11
10-11 19:47:03.185 15412 15687 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---aaaaa--
10-11 19:47:03.186 15412 15687 W System.err: com.google.gson.JsonSyntaxException: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $
10-11 19:47:03.186 15412 15687 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:226)
10-11 19:47:03.186 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 3getCurrentFileName: logFileName=app63.log
10-11 19:47:03.186 15412 15431 D TAG     : 2,initFile: /custom/metro/log/2022-10-11/app63.log, logFile.length=0, getCurrentFileName()=app63.log, writeFileName=/custom/metro/log/2022-10-11/app62.log
10-11 19:47:03.186 15412 15687 W System.err: 	at com.google.gson.TypeAdapter.fromJson(TypeAdapter.java:260)
10-11 19:47:03.186 15412 15687 W System.err: 	at com.google.gson.TypeAdapter.fromJson(TypeAdapter.java:273)
10-11 19:47:03.186 15412 15687 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:51)
10-11 19:47:03.186 15412 15431 D LogWriteUtil.class=LogFileHandlerThread.class: 8,initFile: logFile=/custom/metro/log/2022-10-11/app63.log, logFile.length=0
10-11 19:47:03.186 15412 15687 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:15)
10-11 19:47:03.186 15412 15687 W System.err: 	at retrofit2.OkHttpCall.parseResponse(OkHttpCall.java:243)
10-11 19:47:03.186 15412 15687 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:153)
10-11 19:47:03.186 15412 15687 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)
10-11 19:47:03.186 15412 15687 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)
10-11 19:47:03.186 15412 15687 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
10-11 19:47:03.186 15412 15687 W System.err: 	at java.lang.Thread.run(Thread.java:761)
10-11 19:47:03.187 15412 15687 W System.err: Caused by: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $
10-11 19:47:03.187 15412 15687 W System.err: 	at com.google.gson.stream.JsonReader.beginObject(JsonReader.java:385)
10-11 19:47:03.187 15412 15687 W System.err: 	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:215)
10-11 19:47:03.187 15412 15687 W System.err: 	... 10 more
10-11 19:47:03.187 15412 15687 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] paStartMic() Exception - zone_ids=[35001], e=java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $
10-11 19:47:03.188 15412 15687 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---bbbbb--
</code></pre><p>温州S2号线APP：因为文档中没有外层包装<code>ApiResp.kt</code>，所以直接返回<code>List&lt;StartMicRespData&gt;</code>就可以了。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_base.service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 站选区广播接口
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2022/07/28 14:28
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">interface</span> <span style="color:#0a8;font-weight:bold">PaApiService</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 发起呼叫站广播
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@POST</span><span style="color:#555">(</span><span style="color:#c30">&#34;api/pa/start_mic&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>    suspend fun <span style="color:#c0f">startMic</span><span style="color:#555">(</span><span style="color:#99f">@Body</span> body<span style="color:#555">:</span> RequestBody<span style="color:#555">):</span> ApiResp<span style="color:#555">&lt;</span>List<span style="color:#555">&lt;</span>StartMicRespData<span style="color:#555">&gt;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    suspend fun <span style="color:#c0f">startMic</span><span style="color:#555">(</span><span style="color:#99f">@Body</span> body<span style="color:#555">:</span> RequestBody<span style="color:#555">):</span> List<span style="color:#555">&lt;</span>StartMicRespData<span style="color:#555">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_main.mvvm.viewmodel</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">class</span> <span style="color:#c0f">MainViewModel</span><span style="color:#555">(</span>application<span style="color:#555">:</span> Application<span style="color:#555">)</span> <span style="color:#555">:</span> BaseViewModel<span style="color:#555">(</span>application<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">.......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 发起站选区广播
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @date 2022/07/28 14:25
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    fun <span style="color:#c0f">paStartMic</span><span style="color:#555">(</span>list<span style="color:#555">:</span> MutableList<span style="color:#555">&lt;</span>Int<span style="color:#555">&gt;)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>        val result <span style="color:#555">=</span> HttpManager<span style="color:#555">.</span><span style="color:#309">INSTANCE</span><span style="color:#555">.</span><span style="color:#309">mApi</span><span style="color:#555">.</span><span style="color:#309">startMic</span><span style="color:#555">(</span>param<span style="color:#555">).</span><span style="color:#309">apiData</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>        val result <span style="color:#555">=</span> HttpManager<span style="color:#555">.</span><span style="color:#309">INSTANCE</span><span style="color:#555">.</span><span style="color:#309">mApi</span><span style="color:#555">.</span><span style="color:#309">startMic</span><span style="color:#555">(</span>param<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><p>实验室站区广播自测试：</p>
<p>获取到API服务器的数据：</p>
<pre tabindex="0"><code class="language-log" data-lang="log">2022-10-11 19:59:33.875 16211-16732/com.gbcom.metrosystem D/TAG: 22222222222222222222convert: response=[{&#34;id&#34;: 35001,&#34;reason&#34;: &#34;广播呼叫成功&#34;,&#34;result&#34;: true}]
2022-10-11 19:59:33.876 16211-16732/com.gbcom.metrosystem D/TAG: 122222222222222222222convert: response=[{&#34;id&#34;: 35001,&#34;reason&#34;: &#34;广播呼叫成功&#34;,&#34;result&#34;: true}]
2022-10-11 19:59:33.877 16211-16732/com.gbcom.metrosystem D/TAG: 322222222222222222222convert:  jsonReader=JsonReader at line 1 column 1 path $, [StartMicRespData(id=35001, result=true, reason=广播呼叫成功)]
2022-10-11 19:59:41.792 16211-16732/com.gbcom.metrosystem D/TAG: 22222222222222222222convert: response={&#34;success&#34;:true,&#34;code&#34;:200,&#34;timestamp&#34;:1731936161,&#34;message&#34;:&#34;ok&#34;,&#34;result&#34;:{&#34;id&#34;:0,&#34;result&#34;:true,&#34;reason&#34;:&#34;撤销呼叫站广播成功&#34;}}
2022-10-11 19:59:41.793 16211-16732/com.gbcom.metrosystem D/TAG: 122222222222222222222convert: response={&#34;success&#34;:true,&#34;code&#34;:200,&#34;timestamp&#34;:1731936161,&#34;message&#34;:&#34;ok&#34;,&#34;result&#34;:{&#34;id&#34;:0,&#34;result&#34;:true,&#34;reason&#34;:&#34;撤销呼叫站广播成功&#34;}}
2022-10-11 19:59:41.793 16211-16732/com.gbcom.metrosystem D/TAG: 322222222222222222222convert:  jsonReader=JsonReader at line 1 column 1 path $, ApiResp(success=true, code=200, message=ok, timestamp=1731936161, result=StopMicRespData(result=true, reason=撤销呼叫站广播成功))
</code></pre><p>下面是APP代码里的后续处一。</p>
<pre tabindex="0"><code class="language-log" data-lang="log">2022-10-11 19:59:33.292 16211-16211/com.gbcom.metrosystem D/BaseApp: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------aaaa000001---receive call
2022-10-11 19:59:33.735 16211-16211/com.gbcom.metrosystem D/CallActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------aaaa00000---start
2022-10-11 19:59:33.735 16211-16211/com.gbcom.metrosystem D/CallActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------aaaa111---start
2022-10-11 19:59:33.735 16211-16211/com.gbcom.metrosystem D/CallActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------aaaa2222---start
2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbb---start
2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbbb---start----number=20000000005
2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---number=20000000005
2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list1=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]
2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--8620000000005, +8620000000005 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]
2022-10-11 19:59:33.783 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list3=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]
2022-10-11 19:59:33.784 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--866027340, +866027340 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]
2022-10-11 19:59:33.784 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--866027521, +866027521 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]
2022-10-11 19:59:33.784 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---mZoneIDs=[35001], ---AppConstant.station_zone_bro_list4=[StationBrdZone(zoneID=35001, zoneName=上行广播组测试, groupID=20000000005), StationBrdZone(zoneID=35002, zoneName=东山站上行站台广播组, groupID=6027340), StationBrdZone(zoneID=35003, zoneName=东山路站动态重组组, groupID=6027521)]
2022-10-11 19:59:33.784 16211-16211/com.gbcom.metrosystem D/MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---2222
2022-10-11 19:59:33.784 16211-16211/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa -------3333
2022-10-11 19:59:33.795 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa------44444
2022-10-11 19:59:33.797 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---555555--false
2022-10-11 19:59:33.800 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---666666666666666--
2022-10-11 19:59:33.881 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---7777777777777--result=[StartMicRespData(id=35001, result=true, reason=广播呼叫成功)]
2022-10-11 19:59:33.881 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---7777777777777--
2022-10-11 19:59:35.028 16211-16537/com.gbcom.metrosystem D/MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---99999999999999---bbbbb--
</code></pre><p>可以看到处理数据成功，OK。
制作温州S2号线APP V1.1.4版本，明天测试。</p>
<h3 id="55温州s2号线车站站选区广播20221012对接调试">5.5.温州S2号线车站站选区广播20221012对接调试</h3>
<h4 id="551首次调试没有访问温州s2广播接口的问题">5.5.1.首次调试没有访问温州S2广播接口的问题</h4>
<p><a href="./file/wzs2_station_bro_app_pa2_20221012_1119.log">终端pa2</a></p>
<p>下面是本次站区广播日志【终端pa2】片段。</p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-12 10:30:56.289  2699  2699 D MainActivity: onReceive: new request mBroadCastReceiver, intent?.action=com.gbcom.action.ACTION_FX_STATION_BRD_ZONE_START_TASK
10-12 10:30:56.289  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-12, LogWriteUtil.logPathDir=/custom/metro/log
10-12 10:30:56.289  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12
10-12 10:30:56.289  2699  2699 D MainActivity: onReceive: 站选区广播开始 start
10-12 10:30:56.289  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbb---start
10-12 10:30:56.289  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 1getCurrentFileName: LogWriteUtil.logfile=app.log
10-12 10:30:56.289  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-------------------------bbbbb---start----number=866027333
10-12 10:30:56.289  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---number=866027333
10-12 10:30:56.289  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list1=[StationBrdZone(zoneID=1, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=2, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35001, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35002, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=35003, zoneName=海城站动态重组组, groupID=6027514)]
10-12 10:30:56.289  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--866027333, +866027333 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=2, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35001, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35002, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=35003, zoneName=海城站动态重组组, groupID=6027514)]
10-12 10:30:56.289  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-12, LogWriteUtil.logPathDir=/custom/metro/log
10-12 10:30:56.289  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12
10-12 10:30:56.290  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12
10-12 10:30:56.290  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111---AppConstant.station_zone_bro_list3=[StationBrdZone(zoneID=1, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=2, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35001, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35002, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=35003, zoneName=海城站动态重组组, groupID=6027514)]
10-12 10:30:56.290  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---1111ssssss--866027353, +866027353 ---AppConstant.station_zone_bro_list2=[StationBrdZone(zoneID=1, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=2, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35001, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35002, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=35003, zoneName=海城站动态重组组, groupID=6027514)]

10-12 10:30:56.290  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12
10-12 10:30:56.290  2699  2699 D MainActivity: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---2222
10-12 10:30:56.291  2699  2699 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa -------3333

10-12 10:30:56.293  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 8,initFile: logFile=/custom/metro/log/2022-10-12/app7.log, logFile.length=1028583
10-12 10:30:56.295  2699  4933 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa------44444
10-12 10:30:56.296  2699  4933 D PaRepository: getAppID: authName=user, userNum=1234, appid=ef08e274512c41d885a755edc7870e9d, appidTime=5984373
10-12 10:30:56.296  2699  4933 D APP_LogUtils.kt: [(LogUtils.kt:45).d()] getAppID() - appid not expired, appid=ef08e274512c41d885a755edc7870e9d
10-12 10:30:56.299  2699  4933 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---555555--false

10-12 10:30:56.300  2699  4618 D APP_LogUtils.kt: [(LogUtils.kt:45).d()] getToken() - token not expired, token=ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTQ3Mjg5OQ==, tokenTime=5984425
10-12 10:30:56.300  2699  4618 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---666666666666666--

10-12 10:30:56.310  2699  5400 I Retrofit_network: --&gt; POST http://192.168.42.55:8086/api/pa/start_mic
10-12 10:30:56.310  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-12, LogWriteUtil.logPathDir=/custom/metro/log
10-12 10:30:56.310  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12
10-12 10:30:56.310  2699  5400 D TAG     : 111111--convert: log: message=--&gt; POST http://192.168.42.55:8086/api/pa/start_mic
10-12 10:30:56.310  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12
10-12 10:30:56.310  2699  5400 I Retrofit_network: Content-Type: application/json; charset=utf-8
10-12 10:30:56.310  2699  5400 D TAG     : 111111--convert: log: message=Content-Type: application/json; charset=utf-8
10-12 10:30:56.310  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=7
10-12 10:30:56.310  2699  5400 I Retrofit_network: Content-Length: 22
10-12 10:30:56.310  2699  5400 D TAG     : 111111--convert: log: message=Content-Length: 22

10-12 10:30:56.329  2699  5400 I Retrofit_network: 
10-12 10:30:56.329  2699  5400 D TAG     : 111111--convert: log: message=
10-12 10:30:56.329  2699  2813 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=7
10-12 10:30:56.329  2699  5400 I Retrofit_network: {&#34;zone_ids&#34;:[1,35002]}
10-12 10:30:56.329  2699  5400 D TAG     : 111111--convert: log: message={&#34;zone_ids&#34;:[1,35002]}
10-12 10:30:56.330  2699  5400 I Retrofit_network: --&gt; END POST (22-byte body)
10-12 10:30:56.330  2699  5400 D TAG     : 111111--convert: log: message=--&gt; END POST (22-byte body)

......

10-12 10:30:58.439  2699  5361 I APP_LogUtils.kt: [(LogUtils.kt:50).i()] [MainViewModel] GotaSystem SDK:V2.13 2021-04-20, Host Soft Version:GM655+V1.0.6.8B02, Host Hard Version:GM655MB_C, Host Build Time:2021年 12月 28日 星期二 16:23:13 CST;

10-12 10:30:59.338   671   671 I cnss-daemon: RTM_NEWNEIGH message received: 28
10-12 10:30:59.338   671   671 E cnss-daemon: Stale or unreachable neighbors, ndm state: 32
10-12 10:30:59.341  2699  5400 I Retrofit_network: &lt;-- HTTP FAILED: java.net.NoRouteToHostException: No route to host
10-12 10:30:59.342  2699  5400 D TAG     : 111111--convert: log: message=&lt;-- HTTP FAILED: java.net.NoRouteToHostException: No route to host
10-12 10:30:59.343  2699  4618 W System.err: java.net.NoRouteToHostException: No route to host
10-12 10:30:59.344  2699  4618 W System.err: 	at java.net.PlainSocketImpl.socketConnect(Native Method)
10-12 10:30:59.344  2699  4618 W System.err: 	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:334)
10-12 10:30:59.344  2699  4618 W System.err: 	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:196)
10-12 10:30:59.344  2699  4618 W System.err: 	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:178)
10-12 10:30:59.344  2699  4618 W System.err: 	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:356)
10-12 10:30:59.345  2699  4618 W System.err: 	at java.net.Socket.connect(Socket.java:605)
10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.platform.AndroidPlatform.connectSocket(AndroidPlatform.kt:58)
10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:268)
10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.RealConnection.connect(RealConnection.kt:176)
10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findConnection(ExchangeFinder.kt:236)
10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.findHealthyConnection(ExchangeFinder.kt:109)
10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.ExchangeFinder.find(ExchangeFinder.kt:77)
10-12 10:30:59.345  2699  4618 W System.err: 	at okhttp3.internal.connection.Transmitter.newExchange$okhttp(Transmitter.kt:162)
10-12 10:30:59.346  2699  4618 W System.err: 	at okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.kt:35)
10-12 10:30:59.346  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)
10-12 10:30:59.346  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)
10-12 10:30:59.346  2699  4618 W System.err: 	at okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.kt:82)
10-12 10:30:59.346  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)
10-12 10:30:59.347  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)
10-12 10:30:59.348  2699  4618 W System.err: 	at okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.kt:84)
10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)
10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.kt:71)
10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)
10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)
10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.logging.HttpLoggingInterceptor.intercept(HttpLoggingInterceptor.kt:215)
10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:112)
10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:87)
10-12 10:30:59.349  2699  4618 W System.err: 	at okhttp3.RealCall.getResponseWithInterceptorChain(RealCall.kt:184)
10-12 10:30:59.350  2699  4618 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:136)
10-12 10:30:59.350  2699  4618 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)
10-12 10:30:59.350  2699  4618 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
10-12 10:30:59.351  2699  4618 W System.err: 	at java.lang.Thread.run(Thread.java:761)
10-12 10:30:59.351  2699  4618 D MainViewModel: paStartMic: aaaaaaaaaaaaaaaaaaaaaaaaaa---999999999999--
10-12 10:30:59.353  2699  4618 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] paStartMic() NoRouteToHostException - zone_ids=[1, 35002], e=No route to host
</code></pre><p><a href="./file/wzs2_station_bro_master_pa1eth1_20221012_1123.pcap">主机pa1eth1.pcap</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_base.utils</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">enum</span> <span style="color:#069;font-weight:bold">class</span> <span style="color:#0a8;font-weight:bold">HttpManager</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    INSTANCE<span style="color:#555">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> val retrofit<span style="color:#555">:</span> Retrofit
</span></span><span style="display:flex;"><span>    val mApi<span style="color:#555">:</span> PaApiService
</span></span><span style="display:flex;"><span>    <span style="color:#069;font-weight:bold">private</span> val mMediaTypeJson<span style="color:#555">:</span> MediaType<span style="color:#555">?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    init <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        Log<span style="color:#555">.</span><span style="color:#309">d</span><span style="color:#555">(</span><span style="color:#c30">&#34;HttpManager.kt&#34;</span><span style="color:#555">,</span> <span style="color:#c30">&#34;get paAddress: PA_ADDRESS=${Config.PA_PATH_PREFIX.plus(Config.PA_ADDRESS).plus(&#34;</span><span style="color:#555">:</span><span style="color:#c30">&#34;).plus(Config.PA_PORT).plus(File.separator)}&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>        retrofit <span style="color:#555">=</span> Retrofit<span style="color:#555">.</span><span style="color:#309">Builder</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#09f;font-style:italic">//.baseUrl(Config.PA_PATH_PREFIX.plus(Config.PA_ADDRESS).plus(&#34;:&#34;).plus(Config.PA_PORT).plus(File.separator))
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>            <span style="color:#555">.</span><span style="color:#309">baseUrl</span><span style="color:#555">(</span><span style="color:#c30">&#34;http://192.168.42.55:8086/&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">.</span><span style="color:#309">client</span><span style="color:#555">(</span>initOkhttpClient<span style="color:#555">())</span>
</span></span><span style="display:flex;"><span>            <span style="color:#09f;font-style:italic">//.addConverterFactory(GsonConverterFactory.create())
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>            <span style="color:#555">.</span><span style="color:#309">addConverterFactory</span><span style="color:#555">(</span>HttpManagerDecodeConverterFactory<span style="color:#555">.</span><span style="color:#309">create</span><span style="color:#555">())</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">.</span><span style="color:#309">build</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>        mApi <span style="color:#555">=</span> retrofit<span style="color:#555">.</span><span style="color:#309">create</span><span style="color:#555">(</span>PaApiService<span style="color:#555">::</span>class<span style="color:#555">.</span><span style="color:#309">java</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>        mMediaTypeJson <span style="color:#555">=</span> <span style="color:#c30">&#34;application/json; charset=utf-8&#34;</span><span style="color:#555">.</span><span style="color:#309">toMediaTypeOrNull</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">.......</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><p>V1.1.4：版本有问题，地址写死了。
11：28，出V1.1.5，发产品四群里：修改了<code>baseUrl(&quot;http://192.168.42.55:8086/&quot;)</code>为APP正常代码<code>.baseUrl(Config.PA_PATH_PREFIX.plus(Config.PA_ADDRESS).plus(&quot;:&quot;).plus(Config.PA_PORT).plus(File.separator))</code>。</p>
<h4 id="552广播区域id问题">5.5.2.广播区域ID问题</h4>
<p><a href="./file/wzs2_station_bro_app_pa4_20221012_1143.log">终端pa4.log</a></p>
<p>查看日志可以看到，<code>groupID=6027353</code>有两条信息，一个区域ID是1，一个区域ID是35001，另一个下行也有两条记录。</p>
<p><img loading="lazy" src="./images/wzs2_staton_bro_brd_zone_error_2022-10-12_113928.png" srcset="./images/wzs2_staton_bro_brd_zone_error_2022-10-12_113928.png, ./images/wzs2_staton_bro_brd_zone_error_2022-10-12_113928.png 1.5x, ./images/wzs2_staton_bro_brd_zone_error_2022-10-12_113928.png 2x" sizes="auto" data-title="./images/wzs2_staton_bro_brd_zone_error_2022-10-12_113928.png" data-alt="./images/wzs2_staton_bro_brd_zone_error_2022-10-12_113928.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>日志片段：</p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-12 11:33:37.209  7494  7494 D MainActivity: init: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-----get zone bro list=[]
10-12 11:33:37.209  7494  7494 D MainActivity: init: paStartMic: aaaaaaaaaaaaaaaaaaaaaa-----get zone bro list2=[StationBrdZone(zoneID=1, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=2, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35001, zoneName=海城站下行站台广播组, groupID=6027353), StationBrdZone(zoneID=35002, zoneName=海城站上行站台广播组, groupID=6027333), StationBrdZone(zoneID=35003, zoneName=海城站动态重组组, groupID=6027514)]
</code></pre><p><a href="./file/wzs2_station_bro_master_pa4eth1_20221012_1135.pcap">主机pa4eth1.pcap 下载</a></p>
<p>下面是抓包截图：</p>
<p>发起start_mic的参数</p>
<p><img loading="lazy" src="./images/wzs2_staton_bro_brd_zone_error2_2022-10-12_114101.png" srcset="./images/wzs2_staton_bro_brd_zone_error2_2022-10-12_114101.png, ./images/wzs2_staton_bro_brd_zone_error2_2022-10-12_114101.png 1.5x, ./images/wzs2_staton_bro_brd_zone_error2_2022-10-12_114101.png 2x" sizes="auto" data-title="发起start_mic的参数" data-alt="发起start_mic的参数" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>获取start_mic的响应</p>
<p><img loading="lazy" src="./images/wzs2_staton_bro_brd_zone_error3_2022-10-12_114123.png" srcset="./images/wzs2_staton_bro_brd_zone_error3_2022-10-12_114123.png, ./images/wzs2_staton_bro_brd_zone_error3_2022-10-12_114123.png 1.5x, ./images/wzs2_staton_bro_brd_zone_error3_2022-10-12_114123.png 2x" sizes="auto" data-title="获取start_mic的响应" data-alt="获取start_mic的响应" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>在代码里</p>
<p><a href="./file/wzs2_station_bro_app_log_pa6_202211012.log">终端pa6.log</a></p>
<h4 id="553没有stopmic问题">5.5.3.没有stopMic问题</h4>
<p>说没有stop广播，下面是抓取的终端pa7.log]日志</p>
<p><a href="./file/wzs2_station_bro_app_log_pa7_20221012.log">终端pa7.log</a></p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-12 14:08:52.318  6346  8007 I Retrofit_network: --&gt; DELETE http://192.168.42.131:10000/api/pa/stop_mic
10-12 14:08:52.319  6346  8007 D TAG     : 111111--convert: log: message=--&gt; DELETE http://192.168.42.131:10000/api/pa/stop_mic
10-12 14:08:52.319  6346  8007 I Retrofit_network: --&gt; END DELETE
10-12 14:08:52.319  6346  8007 D TAG     : 111111--convert: log: message=--&gt; END DELETE

......

10-12 14:08:52.331  6346  8007 I Retrofit_network: &lt;-- 404 Not Found http://192.168.42.131:10000/api/pa/stop_mic (12ms)
10-12 14:08:52.331  6346  8007 D TAG     : 111111--convert: log: message=&lt;-- 404 Not Found http://192.168.42.131:10000/api/pa/stop_mic (12ms)
10-12 14:08:52.331  6346  8007 I Retrofit_network: Content-Length: 0
10-12 14:08:52.331  6346  8007 D TAG     : 111111--convert: log: message=Content-Length: 0
10-12 14:08:52.331  6346  8007 I Retrofit_network: Keep-Alive: timeout=5, max=5
10-12 14:08:52.331  6346  8007 D TAG     : 111111--convert: log: message=Keep-Alive: timeout=5, max=5
10-12 14:08:52.331  6346  8007 I Retrofit_network: &lt;-- END HTTP (0-byte body)
10-12 14:08:52.331  6346  8007 D TAG     : 111111--convert: log: message=&lt;-- END HTTP (0-byte body)
10-12 14:08:52.335  6346  7913 W System.err: retrofit2.HttpException: HTTP 404 Not Found
10-12 14:08:52.335  6346  7913 W System.err: 	at retrofit2.KotlinExtensions$await$2$2.onResponse(KotlinExtensions.kt:53)
10-12 14:08:52.335  6346  7913 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:161)
10-12 14:08:52.335  6346  7913 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)
10-12 14:08:52.335  6346  7913 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)
10-12 14:08:52.335  6346  7913 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
10-12 14:08:52.335  6346  7913 W System.err: 	at java.lang.Thread.run(Thread.java:761)
10-12 14:08:52.336  6346  7913 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] stopMic() Exception - e=HTTP 404 Not Found
</code></pre><p>[主机pa7eth.pcap]</p>
<h4 id="554广播区域列表错误">5.5.4.广播区域列表错误</h4>
<p>修改从DIS获取的广播列表错误问题</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_base.dao</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#99f">@Dao</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">interface</span> <span style="color:#0a8;font-weight:bold">StationBrdZoneDao</span> <span style="color:#555">:</span> BaseDao<span style="color:#555">&lt;</span>StationBrdZone<span style="color:#555">&gt;</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     * 根据组获取某一条数据
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     * @date 2022/10/12 13:55
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     */</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    <span style="color:#99f">@Query</span><span style="color:#555">(</span><span style="color:#c30">&#34;SELECT * FROM metro_station_brd_zone WHERE group_id = :groupId&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    fun <span style="color:#c0f">getStationBrdZoneByGroupId</span><span style="color:#555">(</span>groupId<span style="color:#555">:</span> String<span style="color:#555">):</span> StationBrdZone<span style="color:#555">?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     * 温州S2现场呼叫组号：866027333
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     * 从DIS拿到的广播组列表组号：6027333
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     * @date 2022/10/12 13:55
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">+     */</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    <span style="color:#99f">@Query</span><span style="color:#555">(</span><span style="color:#c30">&#34;DELETE FROM metro_station_brd_zone WHERE group_id = :groupId&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    fun <span style="color:#c0f">deleteStationBrdZone</span><span style="color:#555">(</span>groupId<span style="color:#555">:</span> String<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><h4 id="555广播停止不了继续">5.5.5.广播停止不了继续</h4>
<p>广播停止不了</p>
<p>14：47，停止stop_mic添加参数</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_base.service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 站选区广播接口
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2022/07/28 14:28
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">interface</span> <span style="color:#0a8;font-weight:bold">PaApiService</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 撤销呼叫站广播
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @date 2022/07/28 17:14
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#99f">@DELETE</span><span style="color:#555">(</span><span style="color:#c30">&#34;/api/pa/stop_mic&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>    suspend fun <span style="color:#c0f">stopMic</span><span style="color:#555">():</span> ApiResp<span style="color:#555">&lt;</span>StopMicRespData<span style="color:#555">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    suspend fun <span style="color:#c0f">stopMic</span><span style="color:#555">(</span><span style="color:#99f">@Body</span> body<span style="color:#555">:</span> RequestBody<span style="color:#555">):</span> StopMicRespData
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><p>14：54，调用停止广播stopMic的时候随便传递一个参数。</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_stop_mic_failure_2022-10-12_145519.png" srcset="./images/wzs2_station_bro_stop_mic_failure_2022-10-12_145519.png, ./images/wzs2_station_bro_stop_mic_failure_2022-10-12_145519.png 1.5x, ./images/wzs2_station_bro_stop_mic_failure_2022-10-12_145519.png 2x" sizes="auto" data-title="./images/wzs2_station_bro_stop_mic_failure_2022-10-12_145519.png" data-alt="./images/wzs2_station_bro_stop_mic_failure_2022-10-12_145519.png" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_main.mvvm.viewmodel</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">class</span> <span style="color:#c0f">MainViewModel</span><span style="color:#555">(</span>application<span style="color:#555">:</span> Application<span style="color:#555">)</span> <span style="color:#555">:</span> BaseViewModel<span style="color:#555">(</span>application<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 撤销呼叫站广播
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @date 2022/07/28 17:18
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    fun <span style="color:#c0f">paStopMic</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        viewModelScope<span style="color:#555">.</span><span style="color:#309">launch</span><span style="color:#555">(</span>Dispatchers<span style="color:#555">.</span><span style="color:#309">IO</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            val appIDDeferred <span style="color:#555">=</span> async <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                PaRepository<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">getAppID</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            appIDDeferred<span style="color:#555">.</span><span style="color:#309">await</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            val appTokenDeferred <span style="color:#555">=</span> async <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                PaRepository<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">getToken</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            appTokenDeferred<span style="color:#555">.</span><span style="color:#309">await</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            val stopMicDeferred <span style="color:#555">=</span> async <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>                    <span style="color:#09f;font-style:italic">// 随便传递一个参数                    
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">+</span>                    var mZoneIDs <span style="color:#555">=</span> mutableListOf<span style="color:#555">&lt;</span>Int<span style="color:#555">&gt;()</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>                    val param <span style="color:#555">=</span> HttpManager<span style="color:#555">.</span><span style="color:#309">INSTANCE</span><span style="color:#555">.</span><span style="color:#309">getJsonBody</span><span style="color:#555">(</span>mapOf<span style="color:#555">(</span><span style="color:#c30">&#34;zone_ids&#34;</span> to mZoneIDs<span style="color:#555">))</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                    val result <span style="color:#555">=</span> HttpManager<span style="color:#555">.</span><span style="color:#309">INSTANCE</span><span style="color:#555">.</span><span style="color:#309">mApi</span><span style="color:#555">.</span><span style="color:#309">stopMic</span><span style="color:#555">().</span><span style="color:#309">result</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>                    val result <span style="color:#555">=</span> HttpManager<span style="color:#555">.</span><span style="color:#309">INSTANCE</span><span style="color:#555">.</span><span style="color:#309">mApi</span><span style="color:#555">.</span><span style="color:#309">stopMic</span><span style="color:#555">(</span>param<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>result<span style="color:#555">!!.</span><span style="color:#309">result</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#09f;font-style:italic">// 如果为true，则撤销成功
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                        LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">i</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;stopMic() success - result=$result&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#09f;font-style:italic">// 撤销失败
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                        LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">e</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;stopMic() failure - reason=${result.reason}&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>e<span style="color:#555">:</span> NoRouteToHostException<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    e<span style="color:#555">.</span><span style="color:#309">printStackTrace</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>                    LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#555">.</span><span style="color:#309">e</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;stopMic() NoRouteToHostException - e=${e.message}&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>e<span style="color:#555">:</span> Exception<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    e<span style="color:#555">.</span><span style="color:#309">printStackTrace</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>                    LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">e</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;stopMic() Exception - e=${e.message}&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">finally</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    Common<span style="color:#555">.</span><span style="color:#309">prepareBroadcastCallStop</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            stopMicDeferred<span style="color:#555">.</span><span style="color:#309">await</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><p>发版本到产品四部群里FX400-APK-3.0.1-V1.1.9&ndash;release-20221012.apk</p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-12 15:34:41.522 10359 10456 W System.err: java.lang.IllegalArgumentException: Non-body HTTP method cannot contain @Body.
10-12 15:34:41.522 10359 10456 W System.err:     for method PaApiService.stopMic
10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.Utils.methodError(Utils.java:54)
10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.Utils.methodError(Utils.java:43)
10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.RequestFactory$Builder.build(RequestFactory.java:213)
10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.RequestFactory.parseAnnotations(RequestFactory.java:67)
10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.ServiceMethod.parseAnnotations(ServiceMethod.java:26)
10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.Retrofit.loadServiceMethod(Retrofit.java:202)
10-12 15:34:41.523 10359 10456 W System.err: 	at retrofit2.Retrofit$1.invoke(Retrofit.java:160)
10-12 15:34:41.523 10359 10456 W System.err: 	at java.lang.reflect.Proxy.invoke(Proxy.java:813)
10-12 15:34:41.523 10359 10456 W System.err: 	at $Proxy2.stopMic(Unknown Source)
10-12 15:34:41.523 10359 10456 W System.err: 	at com.gbcom.library_main.mvvm.viewmodel.MainViewModel$paStopMic$1$stopMicDeferred$1.invokeSuspend(MainViewModel.kt:604)
10-12 15:34:41.523 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=31
10-12 15:34:41.523 10359 10456 W System.err: 	at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)
10-12 15:34:41.523 10359 10456 W System.err: 	at kotlinx.coroutines.DispatchedTask.run(DispatchedTask.kt:106)
10-12 15:34:41.523 10359 10456 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:571)
10-12 15:34:41.523 10359 10456 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.executeTask(CoroutineScheduler.kt:750)
10-12 15:34:41.523 10359 10456 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.runWorker(CoroutineScheduler.kt:678)
10-12 15:34:41.523 10359 10456 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:665)
10-12 15:34:41.524 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-12, LogWriteUtil.logPathDir=/custom/metro/log
10-12 15:34:41.524 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12
10-12 15:34:41.524 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12
10-12 15:34:41.524 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: 3getCurrentFileName: logFileName=app31.log
10-12 15:34:41.525 10359 10380 D LogWriteUtil.class=LogFileHandlerThread.class: 1getCurrentFileName: LogWriteUtil.logfile=app.log
10-12 15:34:41.525 10359 10456 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] stopMic() Exception - e=Non-body HTTP method cannot contain @Body.
10-12 15:34:41.525 10359 10456 E APP_LogUtils.kt:     for method PaApiService.stopMic
</code></pre><p>16:19,终端<a href="./file/wzs2_station_bro_app_log_stopmic_param_errro_pa10_20221012.log">PA10.log</a></p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-12 15:56:43.784 11295 11383 W System.err: java.lang.IllegalArgumentException: Non-body HTTP method cannot contain @Body.
10-12 15:56:43.784 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12
10-12 15:56:43.784 11295 11383 W System.err:     for method PaApiService.stopMic
10-12 15:56:43.784 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12
10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.Utils.methodError(Utils.java:54)
10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.Utils.methodError(Utils.java:43)
10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.RequestFactory$Builder.build(RequestFactory.java:213)
10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.RequestFactory.parseAnnotations(RequestFactory.java:67)
10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.ServiceMethod.parseAnnotations(ServiceMethod.java:26)
10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.Retrofit.loadServiceMethod(Retrofit.java:202)
10-12 15:56:43.784 11295 11383 W System.err: 	at retrofit2.Retrofit$1.invoke(Retrofit.java:160)
10-12 15:56:43.784 11295 11383 W System.err: 	at java.lang.reflect.Proxy.invoke(Proxy.java:813)
10-12 15:56:43.784 11295 11383 W System.err: 	at $Proxy2.stopMic(Unknown Source)
10-12 15:56:43.784 11295 11383 W System.err: 	at com.gbcom.library_main.mvvm.viewmodel.MainViewModel$paStopMic$1$stopMicDeferred$1.invokeSuspend(MainViewModel.kt:605)
10-12 15:56:43.784 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: 2getCurrentFileName: index=3, LogWriteUtil.logfile=app.log, getFileNameSuffix=33
10-12 15:56:43.784 11295 11383 W System.err: 	at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)
10-12 15:56:43.784 11295 11383 W System.err: 	at kotlinx.coroutines.DispatchedTask.run(DispatchedTask.kt:106)
10-12 15:56:43.785 11295 11383 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:571)
10-12 15:56:43.785 11295 11383 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.executeTask(CoroutineScheduler.kt:750)
10-12 15:56:43.785 11295 11383 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.runWorker(CoroutineScheduler.kt:678)
10-12 15:56:43.785 11295 11383 W System.err: 	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:665)
10-12 15:56:43.785 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: 1getFilePath: logFormat=2022-10-12, LogWriteUtil.logPathDir=/custom/metro/log
10-12 15:56:43.785 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: 2getFilePath: filePath=/custom/metro/log/2022-10-12
10-12 15:56:43.785 11295 11317 D LogWriteUtil.class=LogFileHandlerThread.class: getFileNameSuffix: file=/custom/metro/log/2022-10-12
10-12 15:56:43.785 11295 11383 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] stopMic() Exception - e=Non-body HTTP method cannot contain @Body.
10-12 15:56:43.785 11295 11383 E APP_LogUtils.kt:     for method PaApiService.stopMic
</code></pre><p>修改DELETE请求代码</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_base.service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 站选区广播接口
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2022/07/28 14:28
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">interface</span> <span style="color:#0a8;font-weight:bold">PaApiService</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 撤销呼叫站广播
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @date 2022/07/28 17:14
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>    <span style="color:#99f">@DELETE</span><span style="color:#555">(</span><span style="color:#c30">&#34;/api/pa/stop_mic&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    <span style="color:#99f">@HTTP</span><span style="color:#555">(</span>method <span style="color:#555">=</span> <span style="color:#c30">&#34;DELETE&#34;</span><span style="color:#555">,</span> path <span style="color:#555">=</span> <span style="color:#c30">&#34;/api/pa/stop_mic&#34;</span><span style="color:#555">,</span> hasBody <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">true</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>    suspend fun <span style="color:#c0f">stopMic</span><span style="color:#555">(</span><span style="color:#99f">@Body</span> body<span style="color:#555">:</span> RequestBody<span style="color:#555">):</span> StopMicRespData
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><p><a href="./file/wzs2_station_bro_stop_mic_have_param_404_pa11_20221012_1639.log">stopmic时携带参数还是404，终端pa11.log</a></p>
<pre tabindex="0"><code class="language-log" data-lang="log">10-12 16:28:31.730 12868 12889 D LogWriteUtil.class=LogFileHandlerThread.class: 8,initFile: logFile=/custom/metro/log/2022-10-12/app35.log, logFile.length=0
10-12 16:28:31.732 12868 12994 I Retrofit_network: --&gt; POST http://192.168.42.131:10000/api/system/gettoken
10-12 16:28:31.732 12868 12994 D TAG     : 111111--convert: log: message=--&gt; POST http://192.168.42.131:10000/api/system/gettoken
10-12 16:28:31.732 12868 12994 I Retrofit_network: Content-Type: application/json; charset=utf-8
10-12 16:28:31.733 12868 12994 D TAG     : 111111--convert: log: message=Content-Type: application/json; charset=utf-8
10-12 16:28:31.733 12868 12994 I Retrofit_network: Content-Length: 65
10-12 16:28:31.733 12868 12994 D TAG     : 111111--convert: log: message=Content-Length: 65
10-12 16:28:31.733 12868 12994 I Retrofit_network: 
10-12 16:28:31.733 12868 12994 D TAG     : 111111--convert: log: message=
10-12 16:28:31.733 12868 12994 I Retrofit_network: {&#34;appid&#34;:&#34;ef08e274512c41d885a755edc7870e9d&#34;,&#34;timeKey&#34;:1665563311}
10-12 16:28:31.733 12868 12994 D TAG     : 111111--convert: log: message={&#34;appid&#34;:&#34;ef08e274512c41d885a755edc7870e9d&#34;,&#34;timeKey&#34;:1665563311}
10-12 16:28:31.733 12868 12994 I Retrofit_network: --&gt; END POST (65-byte body)
10-12 16:28:31.733 12868 12994 D TAG     : 111111--convert: log: message=--&gt; END POST (65-byte body)
10-12 16:28:31.736   613 13093 D soundtrigger: audio_extn_sound_trigger_update_stream_status: uc_id 16 of type 1 for Event 2, with Raise=0
10-12 16:28:31.736   613 13093 D hardware_info: hw_info_append_hw_type : device_name = headset-mic
10-12 16:28:31.736   613 13093 D audio_hw_primary: disable_snd_device: snd_device(63: headset-mic)
10-12 16:28:31.736   613 13093 D msm8916_platform: platform_can_split_snd_device: snd_device(63) num devices(0) new_snd_devices(0)
10-12 16:28:31.742 12868 12868 D train_jni_log: jni---setGpioStatus----devpath:/sys/class/gpio/gpio2/value, status:1, iRet:0, cmdStr:echo 1 &gt; /sys/class/gpio/gpio2/value.
10-12 16:28:31.743 12868 12868 D AudioManagerUtils: setSpeakerStatus: aaaaaaaaaa
10-12 16:28:31.744   613   613 D AudioPolicyManagerCustom: setForceUse() usage 0, config 1, mPhoneState 3
10-12 16:28:31.746 12868 12994 D TAG     : intercept: startmic: tokentoken=ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzI0OQ==
10-12 16:28:31.755   613 13093 I soundtrigger: audio_extn_sound_trigger_update_device_status: device 0x3f of type 1 for Event 0, with Raise=1
10-12 16:28:31.755   613  1053 D audio_hw_primary: out_set_parameters: enter: usecase(0: deep-buffer-playback) kvpairs: routing=2
10-12 16:28:31.755   613 13093 D sound_trigger_platform: platform_stdev_check_and_update_concurrency: concurrency active 0, tx 0, rx 0, concurrency session_allowed 1
10-12 16:28:31.756 12868 12994 I Retrofit_network: &lt;-- 200 OK http://192.168.42.131:10000/api/system/gettoken (22ms)
10-12 16:28:31.756 12868 12994 D TAG     : 111111--convert: log: message=&lt;-- 200 OK http://192.168.42.131:10000/api/system/gettoken (22ms)
10-12 16:28:31.756 12868 12994 I Retrofit_network: Content-Length: 117
10-12 16:28:31.756 12868 12994 D TAG     : 111111--convert: log: message=Content-Length: 117
10-12 16:28:31.756 12868 12994 I Retrofit_network: Content-Type: text/plain
10-12 16:28:31.757 12868 12994 D TAG     : 111111--convert: log: message=Content-Type: text/plain
10-12 16:28:31.757 12868 12994 I Retrofit_network: Keep-Alive: timeout=5, max=5
10-12 16:28:31.757 12868 12994 D TAG     : 111111--convert: log: message=Keep-Alive: timeout=5, max=5
10-12 16:28:31.758 12868 12994 I Retrofit_network: 
10-12 16:28:31.758 12868 12994 D TAG     : 111111--convert: log: message=
10-12 16:28:31.758 12868 12994 I Retrofit_network: {&#34;code&#34;:200,&#34;message&#34;:&#34;成功&#34;,&#34;success&#34;:true,&#34;token&#34;:&#34;ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==&#34;}
10-12 16:28:31.758 12868 12994 D TAG     : 111111--convert: log: message={&#34;code&#34;:200,&#34;message&#34;:&#34;成功&#34;,&#34;success&#34;:true,&#34;token&#34;:&#34;ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==&#34;}
10-12 16:28:31.759 12868 12994 I Retrofit_network: &lt;-- END HTTP (117-byte body)
10-12 16:28:31.759 12868 12994 D TAG     : 111111--convert: log: message=&lt;-- END HTTP (117-byte body)
10-12 16:28:31.760 12868 12994 D TAG     : 22222222222222222222convert: response={&#34;code&#34;:200,&#34;message&#34;:&#34;成功&#34;,&#34;success&#34;:true,&#34;token&#34;:&#34;ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==&#34;}
10-12 16:28:31.761 12868 12994 D TAG     : 122222222222222222222convert: response={&#34;code&#34;:200,&#34;message&#34;:&#34;成功&#34;,&#34;success&#34;:true,&#34;token&#34;:&#34;ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==&#34;}
10-12 16:28:31.762 12868 12994 D TAG     : 322222222222222222222convert:  jsonReader=JsonReader at line 1 column 1 path $, PaTokenRespData(success=true, code=200, message=成功, token=ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==)
10-12 16:28:31.763 12868 12994 W System.err: java.lang.IllegalStateException: closed
10-12 16:28:31.763 12868 12994 W System.err: 	at okio.RealBufferedSource.select(RealBufferedSource.kt:83)
10-12 16:28:31.763 12868 12994 W System.err: 	at okhttp3.internal.Util.readBomAsCharset(Util.kt:256)
10-12 16:28:31.763 12868 12994 W System.err: 	at okhttp3.ResponseBody.string(ResponseBody.kt:187)
10-12 16:28:31.763 12868 12994 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:53)
10-12 16:28:31.763 12868 12994 W System.err: 	at com.gbcom.library_base.utils.HttpManagerDecodeRequestBodyConverter.convert(HttpManagerDecodeRequestBodyConverter.kt:16)
10-12 16:28:31.763 12868 12994 W System.err: 	at retrofit2.OkHttpCall.parseResponse(OkHttpCall.java:243)
10-12 16:28:31.763 12868 12994 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:153)
10-12 16:28:31.763 12868 12994 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)
10-12 16:28:31.763 12868 12994 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)
10-12 16:28:31.763 12868 12994 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
10-12 16:28:31.763 12868 12994 W System.err: 	at java.lang.Thread.run(Thread.java:761)
10-12 16:28:31.767 12868 12963 D TAG     : getJsonBody: data={zone_ids=[1]}
10-12 16:28:31.775   613  1049 D audio_hw_primary: out_set_parameters: enter: usecase(12: audio-ull-playback) kvpairs: routing=2
10-12 16:28:31.775 12868 12994 I Retrofit_network: --&gt; DELETE http://192.168.42.131:10000/api/pa/stop_mic
10-12 16:28:31.775 12868 12994 D TAG     : 111111--convert: log: message=--&gt; DELETE http://192.168.42.131:10000/api/pa/stop_mic
10-12 16:28:31.775 12868 12994 I Retrofit_network: Content-Type: application/json; charset=utf-8
10-12 16:28:31.775 12868 12994 D TAG     : 111111--convert: log: message=Content-Type: application/json; charset=utf-8
10-12 16:28:31.775 12868 12994 I Retrofit_network: Content-Length: 16
10-12 16:28:31.775 12868 12994 D TAG     : 111111--convert: log: message=Content-Length: 16
10-12 16:28:31.776 12868 12994 I Retrofit_network: 
10-12 16:28:31.776 12868 12994 D TAG     : 111111--convert: log: message=
10-12 16:28:31.776 12868 12994 I Retrofit_network: {&#34;zone_ids&#34;:[1]}
10-12 16:28:31.776 12868 12994 D TAG     : 111111--convert: log: message={&#34;zone_ids&#34;:[1]}
10-12 16:28:31.776 12868 12994 I Retrofit_network: --&gt; END DELETE (16-byte body)
10-12 16:28:31.776 12868 12994 D TAG     : 111111--convert: log: message=--&gt; END DELETE (16-byte body)
10-12 16:28:31.784 12868 12994 D TAG     : intercept: startmic: tokentoken=ZWYwOGUyNzQ1MTJjNDFkODg1YTc1NWVkYzc4NzBlOWRAMTY2NTU2MzMxMQ==
10-12 16:28:31.792 12868 12994 I Retrofit_network: &lt;-- 404 Not Found http://192.168.42.131:10000/api/pa/stop_mic (15ms)
10-12 16:28:31.792 12868 12994 D TAG     : 111111--convert: log: message=&lt;-- 404 Not Found http://192.168.42.131:10000/api/pa/stop_mic (15ms)
10-12 16:28:31.793 12868 12994 I Retrofit_network: Content-Length: 0
10-12 16:28:31.793 12868 12994 D TAG     : 111111--convert: log: message=Content-Length: 0
10-12 16:28:31.793 12868 12994 I Retrofit_network: Keep-Alive: timeout=5, max=5
10-12 16:28:31.793 12868 12994 D TAG     : 111111--convert: log: message=Keep-Alive: timeout=5, max=5
10-12 16:28:31.793 12868 12994 I Retrofit_network: &lt;-- END HTTP (0-byte body)
10-12 16:28:31.793 12868 12994 D TAG     : 111111--convert: log: message=&lt;-- END HTTP (0-byte body)
10-12 16:28:31.794 12868 12963 W System.err: retrofit2.HttpException: HTTP 404 Not Found
10-12 16:28:31.795 12868 12963 W System.err: 	at retrofit2.KotlinExtensions$await$2$2.onResponse(KotlinExtensions.kt:53)
10-12 16:28:31.795 12868 12963 W System.err: 	at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:161)
10-12 16:28:31.795 12868 12963 W System.err: 	at okhttp3.RealCall$AsyncCall.run(RealCall.kt:138)
10-12 16:28:31.795 12868 12963 W System.err: 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1133)
10-12 16:28:31.795 12868 12963 W System.err: 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:607)
10-12 16:28:31.795 12868 12963 W System.err: 	at java.lang.Thread.run(Thread.java:761)
10-12 16:28:31.783 12889 12889 I LogFile : type=1400 audit(0.0:358): avc: denied { getattr } for path=&#34;/custom/metro/log/2022-10-12&#34; dev=&#34;mmcblk0p51&#34; ino=82019 scontext=u:r:system_app:s0 tcontext=u:object_r:unlabeled:s0 tclass=dir permissive=1
10-12 16:28:31.783 12889 12889 I LogFile : type=1400 audit(0.0:359): avc: denied { read } for name=&#34;2022-10-12&#34; dev=&#34;mmcblk0p51&#34; ino=82019 scontext=u:r:system_app:s0 tcontext=u:object_r:unlabeled:s0 tclass=dir permissive=1
10-12 16:28:31.783 12889 12889 I LogFile : type=1400 audit(0.0:360): avc: denied { open } for path=&#34;/custom/metro/log/2022-10-12&#34; dev=&#34;mmcblk0p51&#34; ino=82019 scontext=u:r:system_app:s0 tcontext=u:object_r:unlabeled:s0 tclass=dir permissive=1
10-12 16:28:31.795 12868 12963 E APP_LogUtils.kt: [(LogUtils.kt:54).e()] [MainViewModel] stopMic() Exception - e=HTTP 404 Not Found
</code></pre><p>16：35，stopmic时携带参数还是404，<a href="./file/wzs2_station_bro_stopmic_have_param_error_master_pa11eth1_20221012_1632.pcap">wzs2_station_bro_stopmic_have_param_error_master_pa11eth1_20221012_1632.pcap</a></p>
<p><img loading="lazy" src="./images/wzs2_staton_bro_stop_mic_have_param_404_2022-10-12_163416.png" srcset="./images/wzs2_staton_bro_stop_mic_have_param_404_2022-10-12_163416.png, ./images/wzs2_staton_bro_stop_mic_have_param_404_2022-10-12_163416.png 1.5x, ./images/wzs2_staton_bro_stop_mic_have_param_404_2022-10-12_163416.png 2x" sizes="auto" data-title="stopmic时携带参数还是404" data-alt="stopmic时携带参数还是404" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>16:45，stopmic时携带参数也报404，对方微信说用的是post，要改成delete</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_stopmic_have_param_404_2022-10-12_164407.png" srcset="./images/wzs2_station_bro_stopmic_have_param_404_2022-10-12_164407.png, ./images/wzs2_station_bro_stopmic_have_param_404_2022-10-12_164407.png 1.5x, ./images/wzs2_station_bro_stopmic_have_param_404_2022-10-12_164407.png 2x" sizes="auto" data-title="stopmic时携带参数也报404，对方微信说用的是post，要改成delete" data-alt="stopmic时携带参数也报404，对方微信说用的是post，要改成delete" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>对方说不用传参，那么APP中的stopMic方法还需要恢复到之前，同时对方研发还说广播接口服务器用错了方法，应该用DELETE方法。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_base.service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * 站选区广播接口
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> * @date 2022/07/28 14:28
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">interface</span> <span style="color:#0a8;font-weight:bold">PaApiService</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 撤销呼叫站广播
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @date 2022/07/28 17:14
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    <span style="color:#99f">@DELETE</span><span style="color:#555">(</span><span style="color:#c30">&#34;/api/pa/stop_mic&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>    <span style="color:#99f">@HTTP</span><span style="color:#555">(</span>method <span style="color:#555">=</span> <span style="color:#c30">&#34;DELETE&#34;</span><span style="color:#555">,</span> path <span style="color:#555">=</span> <span style="color:#c30">&#34;/api/pa/stop_mic&#34;</span><span style="color:#555">,</span> hasBody <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">true</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>    suspend fun <span style="color:#c0f">stopMic</span><span style="color:#555">(</span><span style="color:#99f">@Body</span> body<span style="color:#555">:</span> RequestBody<span style="color:#555">):</span> StopMicRespData
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>    suspend fun <span style="color:#c0f">stopMic</span><span style="color:#555">():</span> StopMicRespData
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">package</span> <span style="color:#0cf;font-weight:bold">com.gbcom.library_main.mvvm.viewmodel</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">class</span> <span style="color:#c0f">MainViewModel</span><span style="color:#555">(</span>application<span style="color:#555">:</span> Application<span style="color:#555">)</span> <span style="color:#555">:</span> BaseViewModel<span style="color:#555">(</span>application<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">......</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#09f;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * 撤销呼叫站广播
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @author daizelai@gbcom.com.cn
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     * @date 2022/07/28 17:18
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    fun <span style="color:#c0f">paStopMic</span><span style="color:#555">()</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>        viewModelScope<span style="color:#555">.</span><span style="color:#309">launch</span><span style="color:#555">(</span>Dispatchers<span style="color:#555">.</span><span style="color:#309">IO</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>            val appIDDeferred <span style="color:#555">=</span> async <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                PaRepository<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">getAppID</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            appIDDeferred<span style="color:#555">.</span><span style="color:#309">await</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            val appTokenDeferred <span style="color:#555">=</span> async <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                PaRepository<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">getToken</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            appTokenDeferred<span style="color:#555">.</span><span style="color:#309">await</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            val stopMicDeferred <span style="color:#555">=</span> async <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#069;font-weight:bold">try</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                    <span style="color:#09f;font-style:italic">// 随便传递一个参数
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span><span style="color:#555">-</span>                    var mZoneIDs <span style="color:#555">=</span> mutableListOf<span style="color:#555">&lt;</span>Int<span style="color:#555">&gt;()</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                    mZoneIDs<span style="color:#555">.</span><span style="color:#309">add</span><span style="color:#555">(</span><span style="color:#f60">1</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                    val param <span style="color:#555">=</span> HttpManager<span style="color:#555">.</span><span style="color:#309">INSTANCE</span><span style="color:#555">.</span><span style="color:#309">getJsonBody</span><span style="color:#555">(</span>mapOf<span style="color:#555">(</span><span style="color:#c30">&#34;zone_ids&#34;</span> to mZoneIDs<span style="color:#555">))</span>
</span></span><span style="display:flex;"><span><span style="color:#555">-</span>                    val result <span style="color:#555">=</span> HttpManager<span style="color:#555">.</span><span style="color:#309">INSTANCE</span><span style="color:#555">.</span><span style="color:#309">mApi</span><span style="color:#555">.</span><span style="color:#309">stopMic</span><span style="color:#555">(</span>param<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span><span style="color:#555">+</span>                    val result <span style="color:#555">=</span> HttpManager<span style="color:#555">.</span><span style="color:#309">INSTANCE</span><span style="color:#555">.</span><span style="color:#309">mApi</span><span style="color:#555">.</span><span style="color:#309">stopMic</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#069;font-weight:bold">if</span> <span style="color:#555">(</span>result<span style="color:#555">!!.</span><span style="color:#309">result</span><span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#09f;font-style:italic">// 如果为true，则撤销成功
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                        LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">i</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;stopMic() success - result=$result&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#09f;font-style:italic">// 撤销失败
</span></span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"></span>                        LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">e</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;stopMic() failure - reason=${result.reason}&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>e<span style="color:#555">:</span> NoRouteToHostException<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    e<span style="color:#555">.</span><span style="color:#309">printStackTrace</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>                    LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#555">.</span><span style="color:#309">e</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;stopMic() NoRouteToHostException - e=${e.message}&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">catch</span> <span style="color:#555">(</span>e<span style="color:#555">:</span> Exception<span style="color:#555">)</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    e<span style="color:#555">.</span><span style="color:#309">printStackTrace</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>                    LogUtils<span style="color:#555">.</span><span style="color:#309">getInstance</span><span style="color:#555">().</span><span style="color:#309">e</span><span style="color:#555">(</span>TAG<span style="color:#555">,</span> <span style="color:#c30">&#34;stopMic() Exception - e=${e.message}&#34;</span><span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">finally</span> <span style="color:#555">{</span>
</span></span><span style="display:flex;"><span>                    Common<span style="color:#555">.</span><span style="color:#309">prepareBroadcastCallStop</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>            stopMicDeferred<span style="color:#555">.</span><span style="color:#309">await</span><span style="color:#555">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#555">}</span>
</span></span><span style="display:flex;"><span><span style="color:#555">}</span>
</span></span></code></pre></div><h4 id="556广播发起和结束正常">5.5.6.广播发起和结束正常</h4>
<p>17：09，发起广播和停止广播都正常了</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_stopmic_success_2022-10-12_170856.png" srcset="./images/wzs2_station_bro_stopmic_success_2022-10-12_170856.png, ./images/wzs2_station_bro_stopmic_success_2022-10-12_170856.png 1.5x, ./images/wzs2_station_bro_stopmic_success_2022-10-12_170856.png 2x" sizes="auto" data-title="17：09，发起广播和停止广播都正常了" data-alt="17：09，发起广播和停止广播都正常了" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
<p>发起广播和停止广播都正常了</p>
<p><a href="./file/wzs2_station_bro_start_stop_mic_success_master_pa12eth1_20221012_1711.pcap">主机pa12eth1(1).pcap</a></p>
<p>17:15，温州S2号线v1.2.3版本，发起广播的区域不是写死的1了，发产品四部群里了。</p>
<p>17：19，下面是本次的测试结果，测试站区广播功能OK，包括发起广播时的区域ID也是动态从DIS获取的，传给广播服务器也是正常的。</p>
<p><a href="./file/wzs2_station_bro_zone_ok_master_pa13eth1_20221012_1719.pcap">主机区域pa13eth1.pcap</a></p>
<p><a href="./file/wzs2_station_bro_zone_ok_app_pa13_20221012_1721.log">终端pa13.log</a></p>
<h3 id="56温州s2号线车站站选区广播20221013对接调试">5.6.温州S2号线车站站选区广播20221013对接调试</h3>
<p>今天温州现场蒋富强说，温州现场测试站选区广播功能正常</p>
<p><img loading="lazy" src="./images/wzs2_station_bro_success_2022-10-13_133730.png" srcset="./images/wzs2_station_bro_success_2022-10-13_133730.png, ./images/wzs2_station_bro_success_2022-10-13_133730.png 1.5x, ./images/wzs2_station_bro_success_2022-10-13_133730.png 2x" sizes="auto" data-title="测试站选区广播功能正常" data-alt="测试站选区广播功能正常" style="background: url(/svg/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;this.alt=this.dataset.alt;for(const a of ['style','data-title','data-alt','onerror','onload']){this.removeAttribute(a);}"/></p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2022-10-10 18:27:00">更新于 2022-10-10&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"></div>
      <div class="post-info-share">
        <span></span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/tags/pa/' class="post-tag">PA</a><a href='/tags/%E5%9B%BA%E5%AE%9A%E5%8F%B0/' class="post-tag">固定台</a><a href='/tags/%E7%AB%99%E9%80%89%E5%8C%BA%E5%B9%BF%E6%92%AD/' class="post-tag">站选区广播</a><a href='/tags/%E6%B8%A9%E5%B7%9Es2%E5%8F%B7%E7%BA%BF/' class="post-tag">温州S2号线</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/wzs2/20221011_1049%E4%B8%AD%E5%85%B4sdk%E5%A4%9A%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/" class="post-nav-item" rel="prev" title="中兴SDK多端口配置的使用记录"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>中兴SDK多端口配置的使用记录</a>
      <a href="/posts/linux/20221016_1619ssh%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95/" class="post-nav-item" rel="next" title="ssh免密码登录">ssh免密码登录<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line custom">学习数理化，走遍天下都不怕</div><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.114.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.2.18"><img class="fixit-icon" src="/fixit.min.svg" alt="FixIt logo" />&nbsp;FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2013 - 2023</span><span class="author" itemprop="copyrightHolder">
              <a href="/"></a></span></div><div class="footer-line statistics"></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/lunr/lunr.min.js" defer></script><script src="/lib/lunr/lunr.stemmer.support.min.js" defer></script><script src="/lib/lunr/lunr.zh.min.js" defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":10},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":30,"type":"lunr"}};</script><script src="/js/theme.min.js" defer></script></body>
</html>
